근무 중인 온라인 판매점이 곧 새로운 지리적 영역으로 확장할 계획입니다. 이 이동으로 고객 기반 및 트랜잭션 볼륨이 증가합니다. 필요할 때마다 확장을 처리할 데이터베이스가 준비되어 있는지 확인해야 합니다.

파티션 전략을 사용하면 데이터베이스를 확장해야 할 때 쉽게 확장할 수 있고 효율적인 쿼리와 트랜잭션을 계속 수행할 수 있습니다.

## <a name="what-is-a-partition-strategy"></a>파티션 전략이란?

단일 서버 또는 단일 파티션에 새 데이터를 계속 추가하면 결국 공간이 부족합니다. 이에 대비하려면 강화보다는 **규모 확장** 분할 전략이 필요합니다. 규모 확장은 수평적 크기 조정이라고도 하고 이를 사용하면 응용 프로그램에 필요할 때 데이터베이스에 더 많은 파티션을 추가할 수 있습니다.

Azure Cosmos DB의 파티션 및 규모 확장 전략은 컬렉션을 만들 때 설정된 값인 파티션 키를 기반으로 합니다. 파티션 키가 설정되면 컬렉션을 다시 만들어야 파티션 키를 변경할 수 있으므로, 올바른 파티션 키를 선택하는 것은 개발 프로세스 초기에 결정할 중요한 내용입니다.  

이 단원에서는 시나리오에 적합한 파티션 키를 선택하는 방법을 알아보고 Azure Cosmos DB에서 수행되는 자동 크기 조정을 활용합니다.

## <a name="what-is-a-partition-key"></a>파티션 키란?

파티션 키는 Azure에서 데이터가 논리적 부분으로 구성되는 값입니다. 온라인 소매점 시나리오에서 `userID` 또는 `productId` 값을 파티션 키로 사용하는 것이 좋습니다. 이 값은 고유하고 레코드를 조회하는 데 사용할 수 있기 때문입니다. `userID`를 선택하는 이유는 응용 프로그램에서 사용자의 개인 설정, 쇼핑 카트, 주문 기록 및 프로필 정보 등을 자주 검색해야 하기 때문입니다. `productId`도 선택하는 이유는 응용 프로그램에서 재고 수준, 배송 비용, 색상 옵션, 창고 위치 등을 쿼리해야 하기 때문입니다.

파티션 키는 데이터베이스 전체에 작업을 배포하는 데 사용됩니다. 핫 파티션을 방지하기 위해 요청을 배포하려고 합니다. 핫 파티션은 다른 파티션보다 많은 요청을 수신하는 단일 파티션으로, 처리량 병목 상태를 일으킬 수 있습니다. 예를 들어 전자상거래 응용 프로그램의 경우 현재 시간은 파티션 키의 잘못된 선택입니다. 들어오는 모든 데이터가 단일 파티션 키로 이동하기 때문입니다. `userID` 또는 `productId`를 사용하는 것이 좋습니다. 사이트의 모든 사용자가 거의 동일한 빈도로 쇼핑 카트나 프로필 정보를 추가하고 업데이트할 수 있으므로 모든 사용자 및 제품 파티션에 읽기 및 쓰기가 분산되기 때문입니다.

각 파티션 키와 연결된 데이터의 저장 공간은 Azure Cosmos DB에서 물리적 파티션 하나의 크기인 10GB를 초과할 수 없습니다. 따라서 단일 `userID` 또는 `productId` 레코드가 10GB보다 커지면 각 레코드가 더 작아지도록 복합 키를 사용하는 것이 좋습니다. 복합 키의 예는 `userID-date`이며 **CustomerName-08072018**과 같습니다. 이 복합 키 방법을 사용하면 사용자가 사이트를 방문한 날마다 새 파티션을 만들 수 있습니다.

## <a name="best-practices"></a>모범 사례

올바른 파티션 키를 결정하려 하는데 솔루션이 분명하지 않은 경우에는 다음과 같은 몇 가지 팁을 고려하세요.

- 값이 많은 파티션 키를 선택하는 것을 두려워하지 마십시오. 파티션 키의 값이 많을수록 확장성이 커집니다.
- 읽기 작업이 많은 워크로드에 가장 적합한 파티션 키를 결정하려면 사용하려는 상위 3-5개 쿼리를 검토합니다. WHERE 절에 가장 자주 포함되는 값은 파티션 키의 좋은 후보입니다.
- 쓰기 작업이 많은 워크로드의 경우 파티션 키가 다중 문서 트랜잭션의 범위이므로 워크로드의 트랜잭션 요구 사항을 이해해야 합니다.
