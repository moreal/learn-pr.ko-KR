Azure를 사용하여 온-프레미스 환경에 통합하려면 암호화된 연결을 만드는 기능이 필요합니다. 인터넷을 통해 또는 전용된 링크를 통해 연결할 수 있습니다. 여기에서 온-프레미스 환경에서 들어오는 연결에 대 한 끝점을 제공 하는 Azure VPN Gateway를 살펴보겠습니다.

프로젝트 관리자는 Azure virtual network를 설정 하 고이 정보를 Azure에서 사이트에 전송 된 모든 데이터 및 Azure 간에 가상 네트워크는 암호화 되도록 해야 합니다. 지역과 구독 간에 가상 네트워크를 연결하는 방법도 알아야 합니다.

## <a name="what-is-a-vpn-gateway"></a>VPN gateway 란?

Azure VPN gateway를 인터넷을 통해 Azure에 온-프레미스 위치에서 암호화 된 들어오는 연결에 대 한 끝점을 제공합니다. 보낼 수도 있습니다 Microsoft의 전용된 네트워크를 통해 Azure 가상 네트워크 간에 암호화 된 트래픽을 Azure 데이터 센터를 연결 하는 다른 지역에 있습니다. 이 구성을 사용하면 다른 지역에 있는 가상 머신 및 서비스를 안전하게 연결할 수 있습니다.

각 가상 네트워크에는 하나의 VPN Gateway만이 포함될 수 있습니다. 해당 VPN Gateway에 대한 모든 연결은 사용 가능한 네트워크 대역폭을 공유합니다.

각 가상 네트워크 게이트웨이 내에서 두 개 이상의 Vm (가상 머신) 있습니다. 이러한 VM은 _게이트웨이 서브넷_이라는 지정된 특별한 서브넷에 배포되었습니다. 특정 게이트웨이 서비스와 함께 다른 네트워크에 대한 연결의 라우팅 테이블이 포함됩니다. 이러한 VM 및 게이트웨이 서브넷은 강화된 네트워크 장치와 비슷합니다. 이러한 VM을 직접 구성할 필요가 없으며 게이트웨이 서브넷에 추가 리소스를 배포하지 않아야 합니다.

가상 네트워크 게이트웨이 생성을 완료하는 데 시간이 걸릴 수 있으므로 적절하게 계획해야 합니다. 가상 네트워크 게이트웨이를 만들 때 프로비전 프로세스는 게이트웨이 VM을 생성하고 게이트웨이 서브넷에 배포합니다. 이러한 VM에는 게이트웨이를 구성하는 설정이 있습니다.

키 설정은 **_게이트웨이 형식_** 이며 VPN Gateway의 경우 "vpn" 형식입니다. VPN Gateway에 대한 옵션은 다음과 같습니다.

- IPsec/IKE VPN 터널링 하 고, 다른 VPN gateway에 대 한 VPN gateway 연결을 통해 네트워크에 연결 합니다.

- 교차 프레미스 IPsec/IKE VPN 터널링은 사이트 간 연결을 만드는 전용 VPN 장치를 통해 온-프레미스 네트워크를 Azure에 연결합니다.

- Azure의 리소스에 클라이언트 컴퓨터를 연결할 (ikev2 또는 SSTP를 통한 지점-사이트 간 연결입니다.

이제 VPN Gateway를 계획하는 데 고려해야 할 요인을 살펴보겠습니다.

## <a name="plan-a-vpn-gateway"></a>VPN gateway 계획

VPN 게이트웨이 계획할 때 고려해 야 할 세 가지 아키텍처가 있습니다.

- 인터넷을 통한 지점 및 사이트 간 연결
- 인터넷을 통한 사이트 간 연결
- Azure ExpressRoute와 같은 전용 네트워크를 통한 사이트 간 연결

### <a name="planning-factors"></a>계획 요소

계획 프로세스 중에 처리해야 하는 요소는 다음과 같습니다.

- 처리량 - Mbps 또는 Gbps
- 백본 - 인터넷 또는 개인?
- 공용(정적) IP 주소의 가용성
- VPN 장치 호환성
- 여러 클라이언트 연결 또는 사이트 간 연결?
- VPN Gateway 형식
- Azure VPN Gateway SKU

다음 표에서는 이러한 계획 문제 중 일부를 요약합니다. 나머지는 나중에 설명되어 있습니다.

|                           |  지점 및 사이트 간            | 사이트 간 통신                          |  ExpressRoute                 |
| -------------             | -------------             | -------------                         | ---------                     |
| Azure 지원 서비스  | Cloud Services 및 VM    | Cloud Services 및 VM                | 지원되는 모든 서비스        |
| 일반적인 대역폭         | VPN 게이트웨이 SKU에 따라 달라 집니다.    | 집계를 사용하여 최대 1Gbps         | 50Mbps에서 10Gbps 사이       |
| 지원되는 프로토콜       | SSTP 및 IPsec            | IPsec                                 | 직접 연결, VLAN      |
| 라우팅                   | RouteBased(동적)      | PolicyBased (정적) 및 RouteBased   | BGP                           |
| 연결 복원력     | 활성-수동            | 액티브-패시브 또는 액티브-액티브       | 활성-활성                 |
| 사용 사례                  | 테스트 및 프로토타입   | 개발, 테스트 및 소규모 프로덕션  | 엔터프라이즈/업무에 중요 한   |

### <a name="gateway-skus"></a>게이트웨이 SKU

Azure는 게이트웨이 서비스에 대해 다음과 같은 SKU를 제공합니다.

| SKU              |  S2S /-네트워크 터널 | P2S 연결  |  집계 처리량 벤치 마크   | 용도                         |
| -------------    | -------------             | -------------    | ---------                         | ---------                       |
| 기본            | 최댓값 10                    | 최댓값 128          | 100Mbps                          | 개발/테스트/POC                    |
| VpnGw1           | 최댓값 30                    | 최댓값 128          | 650Mbps                          | 프로덕션/중요 한 워크 로드   |
| VpnGw2           | 최댓값 30                    | 최댓값 128          | 1Gbps                            | 프로덕션/중요 한 워크 로드   |
| VpnGw3           | 최댓값 30                    | 최댓값 128          | 1.25Gbps                          | 프로덕션/중요 한 워크 로드   |

> [!Note]
> 올바른 SKU를 선택 하는 것입니다. 잘못 된 것을 사용 하 여 VPN gateway를 설정한 경우 중지 하 고 시간이 오래 걸릴 수 있는 게이트웨이 다시 작성 해야 합니다.

## <a name="workflow"></a>워크플로

Azure에서 가상 사설망을 사용하여 클라우드 연결 전략을 설계할 때 다음과 같은 워크플로를 적용해야 합니다.

1. 연결 토폴로지를 디자인하면서 연결된 모든 네트워크의 주소 공간을 나열합니다.

1. Azure Virtual Network를 만듭니다.

1. 가상 네트워크의 VPN Gateway를 만듭니다.

1. 필요에 따라 온-프레미스 네트워크 또는 기타 가상 네트워크에 대한 연결을 만들고 구성합니다.

1. 필요한 경우 만들고 Azure VPN gateway에 대 한 지점-사이트 간 연결을 구성 합니다.

### <a name="design-considerations"></a>디자인 고려 사항

가상 네트워크를 연결하도록 VPN Gateway를 디자인할 때 다음과 같은 요인을 고려해야 합니다.

- 서브넷 겹칠 수 없습니다.

    것이 중요 한 위치에서 서브넷에 다른 위치와 같이 동일한 주소 공간이 없습니다.

- IP 주소는 고유 해야 합니다.

    이러한 두 호스트 간에 트래픽을 라우팅할 수 됩니다와 네트워크에 연결 하지 못합니다 다른 위치에 동일한 IP 주소를 사용 하 여 두 호스트 수는 없습니다.

- VPN gateway 이라는 게이트웨이 서브넷을 필요한 **GatewaySubnet**

    게이트웨이가 작동 하는 데이 이름을 할당 해야 및 다른 리소스에 포함 되어서는 안 됩니다.

### <a name="create-an-azure-virtual-network"></a>Azure 가상 네트워크 만들기

VPN gateway를 만들기 전에 Azure virtual network 만들기 해야 합니다.

### <a name="create-a-vpn-gateway"></a>VPN 게이트웨이 만들기

만든 VPN Gateway 형식은 아키텍처에 따라 달라집니다. 옵션은 다음과 같습니다.

- 경로 기반

    경로 기반 VPN 장치 any-임의의 (와일드 카드) 트래픽 선택기를 사용 하 여 및 서로 다른 IPsec 터널 트래픽을 라우팅/전달 테이블이 있습니다. 경로 기반 연결은 일반적으로 각 IPsec 터널이 네트워크 인터페이스 또는 VTI(가상 터널 인터페이스)로 모델링되는 라우터 플랫폼에 빌드됩니다.

- PolicyBased

    정책 기반 VPN 장치 트래픽을 IPsec 터널을 통해 암호화/해독 하는 방법을 정의 하려면 두 네트워크의 접두사 조합을 사용 하 여 합니다. 정책 기반 연결은 일반적으로 패킷 필터링을 수행하는 방화벽 장치에 빌드됩니다. IPsec 터널 암호화 및 암호 해독이 패킷 필터링 및 처리 엔진에 추가됩니다.

## <a name="set-up-a-vpn-gateway"></a>VPN gateway 설정

수행해야 하는 단계는 설치하는 VPN Gateway의 형식에 따라 다릅니다. 예를 들어, Azure portal을 사용 하 여 지점-사이트 간 VPN gateway를 만들려면 다음 단계 수행는 있습니다.

1. 가상 네트워크 만들기

2. 게이트웨이 서브넷 추가

3. DNS 서버 지정(선택 사항)

4. 가상 네트워크 게이트웨이 만들기

5. 인증서 생성

6. 클라이언트 주소 풀 추가

7. 터널 종류 구성

8. 인증 유형 구성

9. 루트 인증서 공용 인증서 데이터 업로드

10. 내보낸 클라이언트 인증서 설치

11. VPN 클라이언트 구성 패키지 생성 및 설치

12. Azure에 연결

여러 옵션을 사용 하 여 각 Azure VPN gateway 사용 하 여 여러 구성 경로이 과정에서 모든 설치를 포함 하는 것이 불가능 합니다. 자세한 내용은 추가 리소스 섹션을 참조하세요.

## <a name="configure-the-gateway"></a>게이트웨이 구성

게이트웨이가 만들어지면 구성해야 합니다.  여러 구성 설정은 이름, 위치, DNS 서버 등과 같은 제공 해야 합니다. 자세한 내용은 연습에서 알아봅니다.

## <a name="summary"></a>요약

Azure VPN gateway는 구성 요소 사이트 간, 지점 및 사이트를 사용 하도록 설정 된 Azure 가상 네트워크 또는 네트워크에 연결 합니다. Azure VPN gateway는 Azure 리소스에 연결, Azure로 온-프레미스 네트워크를 확장 또는 다른 지역의 가상 네트워크 및 구독 간의 연결을 용이 하 게 개별 클라이언트 컴퓨터를 설정 합니다.
