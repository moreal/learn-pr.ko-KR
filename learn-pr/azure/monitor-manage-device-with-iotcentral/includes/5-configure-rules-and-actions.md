<span data-ttu-id="dc292-101">데이터를 교환하여 커피 머신을 관리하고 모니터링할 수 있도록 커피 머신을 Azure IoT Central 응용 프로그램에 연결했습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="dc292-102">이 모듈에서는 커피 머신 물 온도가 정상 범위를 벗어나는 경우 작업을 트리거하는 규칙을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-102">In this module, you create rules that trigger actions when the water temperature of the coffee machine is out of the normal range.</span></span> <span data-ttu-id="dc292-103">머신의 보증 기간이 남아 있는지 여부에 따라 이메일 또는 모바일 알림이 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="dc292-104">Microsoft Flow를 작업으로 추가하려면 Azure 구독이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="dc292-105">Azure 구독이 없다면 필요에 따라 Microsoft Flow를 작업으로 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="dc292-106">이메일을 보내는 작업을 추가하여 IoT Central에서 규칙 만들기</span><span class="sxs-lookup"><span data-stu-id="dc292-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="dc292-107">Azure IoT Central에는 알림을 전송하기 위한 기본적인 이메일 기능이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="dc292-108">이 시나리오에서는 최적 온도 범위를 벗어나는 커피 머신이 보증을 통해 보호되지 않는 경우 IoT Central에서 고객의 유지 관리 부서로 이메일이 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="dc292-109">보증이 만료된 커피 머신의 물 온도가 최적 범위를 벗어나는 경우 다음의 두 규칙을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-109">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="dc292-110">작업을 완료하면 **저장**을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-110">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="dc292-111">조건 적용 시에는 모든 문이 참이어야 규칙이 실행됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-111">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="dc292-112">이 시나리오에서와 같이 조건이 “또는” 문인 경우(예: 최적 온도가 섭씨 90도 미만 또는 98도 초과인 동시에 보증이 만료됨) 여기에 나와 있는 것처럼 문을 규칙 두 개로 분할합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-112">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less than 90 Celsius or greater than 98 Celsius while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="dc292-113">규칙 이름을 ‘커피 메이커 물 온도가 너무 낮음(만료)’으로 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-113">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="dc292-114">다음 조건을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-114">Add the conditions:</span></span>      
    * <span data-ttu-id="dc292-115">장치 보증 만료 = 1</span><span class="sxs-lookup"><span data-stu-id="dc292-115">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="dc292-116">물 온도가 커피 메이커 최소 온도보다 낮음 ![규칙 사용](../images/5-flow-g.png)</span><span class="sxs-lookup"><span data-stu-id="dc292-116">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-g.png)</span></span>

1. <span data-ttu-id="dc292-117">규칙 이름을 커피 메이커 물 온도가 너무 높음(만료)으로 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-117">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="dc292-118">다음 조건을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-118">Add the conditions:</span></span>      
    * <span data-ttu-id="dc292-119">장치 보증 만료 = 1</span><span class="sxs-lookup"><span data-stu-id="dc292-119">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="dc292-120">물 온도가 커피 메이커 최대 온도보다 높음 ![규칙 사용](../images/5-flow-k.png)</span><span class="sxs-lookup"><span data-stu-id="dc292-120">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-k.png)</span></span>     

1. <span data-ttu-id="dc292-121">**작업**을 추가하려면 원격 분석 규칙 구성 패널에서 아래로 스크롤하여 작업 옆의 +를 선택한 다음, **이메일**을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-121">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose the + next to Actions, then choose **Email**</span></span>

1. <span data-ttu-id="dc292-122">작업을 정의하려면 IoT Central 응용 프로그램에 로그인하는 데 사용한 이메일 주소를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-122">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="dc292-123">물 온도가 너무 높을 때의 알림 메시지인 “커피 메이커 물이 너무 뜨겁습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-123">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="dc292-124">유지 관리 작업이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-124">Maintenance is required.</span></span>  <span data-ttu-id="dc292-125">보증이 만료되었습니다."를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-125">Warranty has expired."</span></span> <span data-ttu-id="dc292-126">물 온도가 너무 낮을 때의 알림 메시지에 대해서도 같은 단계를 반복합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-126">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="dc292-127">이 경우에는 메시지로 “커피 메이커 물이 너무 차갑습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-127">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="dc292-128">유지 관리 작업이 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-128">Maintenance is required.</span></span>  <span data-ttu-id="dc292-129">보증이 만료되었습니다."를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-129">Warranty has expired."</span></span>

1. <span data-ttu-id="dc292-130">**저장**을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-130">Choose **Save**.</span></span> <span data-ttu-id="dc292-131">규칙 페이지에 규칙이 나열됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-131">Your rule is listed on the Rules page:</span></span>

1. <span data-ttu-id="dc292-132">규칙을 트리거하려는 경우 온도가 범위를 벗어날 때까지 기다리거나, 온도가 설정의 최적 범위를 벗어나도록 의도적으로 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-132">To trigger the rule, you can wait for the temperature to go out of the range or you can purposely set the temperature out of the optimal range in settings.</span></span> <span data-ttu-id="dc292-133">이메일 알림 수신이 시작되면 Azure IoT Central에서 전송하는 이메일이 받은 편지함에 너무 많이 수신되지 않도록 규칙을 사용하지 않도록 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-133">Once you begin to receive email notification, remember to disable the rule to avoid flooding your Inbox with emails from Azure IoT Central.</span></span> 

> [!NOTE]
> <span data-ttu-id="dc292-134">유효성 검사를 완료한 후에는 받은 편지함에 이메일이 너무 많이 수신되지 않도록 규칙을 해제합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-134">Turn off the rules once you are done with validation to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="dc292-135">Microsoft Flow를 작업으로 추가하여 IoT Central에서 규칙 만들기</span><span class="sxs-lookup"><span data-stu-id="dc292-135">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="dc292-136">여러 응용 프로그램에서 워크플로를 자동화하는 Microsoft Flow는</span><span class="sxs-lookup"><span data-stu-id="dc292-136">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="dc292-137">IoT Central에서 규칙이 실행될 때 트리거할 수 있는 작업 중 하나입니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-137">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="dc292-138">이 시나리오에서는 보증 기간이 남아 있는 커피 머신이 특정 온도 임계값에 도달하면 Microsoft Flow가 해당 지역의 서비스 기사에게 모바일 알림을 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-138">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="dc292-139">**규칙**으로 이동하여 조건을 구성하고 규칙 발생 시의 작업으로 Microsoft Flow 를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-139">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="dc292-140">Azure 구독이 없다면 필요에 따라 이 연습을 진행하여 Microsoft Flow를 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-140">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>

<span data-ttu-id="dc292-141">커피 머신 보증 기간이 남아 있는 경우 다음 규칙을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-141">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="dc292-142">규칙 이름을 커피 메이커 물 온도가 너무 낮음(보증)으로 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-142">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="dc292-143">다음 조건을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-143">Add the conditions:</span></span>      
    * <span data-ttu-id="dc292-144">장치 보증 만료 = 0</span><span class="sxs-lookup"><span data-stu-id="dc292-144">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="dc292-145">물 온도가 커피 메이커 최소 온도보다 낮음 ![규칙 사용](../images/5-flow-l.png)</span><span class="sxs-lookup"><span data-stu-id="dc292-145">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-l.png)</span></span>

1. <span data-ttu-id="dc292-146">규칙 이름을 커피 메이커 물 온도가 너무 높음(보증)으로 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-146">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="dc292-147">다음 조건을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-147">Add the conditions:</span></span>      
    * <span data-ttu-id="dc292-148">장치 보증 만료 = 0</span><span class="sxs-lookup"><span data-stu-id="dc292-148">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="dc292-149">물 온도가 커피 메이커 최대 온도보다 높음 ![규칙 사용](../images/5-flow-h.png)</span><span class="sxs-lookup"><span data-stu-id="dc292-149">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-h.png)</span></span>

1. <span data-ttu-id="dc292-150">규칙 조건을 저장한 후 커피 메이커 보증 기간이 남아 있을 때 수행할 새 작업으로 Microsoft Flow를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-150">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="dc292-151">브라우저에서 새 탭이나 창이 열려 Microsoft Flow가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-151">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="dc292-152">그리고 사용자 지정 작업에 연결하는 IoT Central 커넥터를 보여주는 개요 페이지로 연결됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-152">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="dc292-153">**계속**을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-153">Choose **Continue**.</span></span> 

    <span data-ttu-id="dc292-154">워크플로를 구축하는 Microsoft Flow 디자이너로 이동됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-154">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="dc292-155">워크플로에는 응용 프로그램 및 규칙이 이미 채워져 있는 IoT Central 트리거가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-155">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="dc292-156">이 시점에서 워크플로에 원하는 모든 작업을 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-156">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="dc292-157">예를 들어 모바일 알림을 전송해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-157">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="dc292-158">알림을 검색하고 알림 - 모바일 알림 보내기를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-158">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="dc292-159">작업에서 알림에서 알리려는 내용으로 텍스트 필드를 채웁니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-159">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="dc292-160">IoT Central 규칙에서 동적 콘텐츠를 포함하면 알림에 장치 ID 및 이름과 같은 중요한 정보를 전달할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-160">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    <span data-ttu-id="dc292-161">![작업으로 Microsoft Flow 사용](../images/5-flow-f.png)</span><span class="sxs-lookup"><span data-stu-id="dc292-161">![Using Microsoft Flow as an action](../images/5-flow-f.png)</span></span>

1. <span data-ttu-id="dc292-162">Microsoft Flow에서 워크플로를 설정한 후에는 Microsoft Store에서 모바일 장치에 [Flow 앱](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab)을 다운로드합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-162">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="dc292-163">Flow 웹앱에서 워크플로를 설정하는 데 사용했던 것과 같은 계정을 사용하여 로그인합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-163">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="dc292-164">테스트 시에는 규칙을 트리거하기 위해 최적 온도가 범위를 벗어나도록 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-164">For testing purpose, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="dc292-165">장치 속성: 장치 보증 만료(장치 코드에서 보증이 만료된 경우 1, 보증 기간이 남은 경우 0 설정)는 장치에서 무작위로 생성된 후 장치에서 Azure IoT Central 응용 프로그램으로 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-165">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="dc292-166">테스트 시에는 장치 보증 만료(1 또는 0)를 제어하려는 경우 테스트 중인 작업을 트리거하는 데 적합한 보증 상태가 수신될 때까지 시뮬레이터를 다시 부팅합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-166">For testing purpose, if you'd like to control Device Warranty Expired (1 or 0), reboot your simulator until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="dc292-167">모바일 알림을 받으려면 콘솔 로그에 장치 보증 만료가 0으로 표시될 때까지 시뮬레이터를 다시 부팅합니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-167">To receive a mobile notification, reboot your simulator until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="dc292-168">몇 분이 지나면 Flow 모바일 앱에 알림이 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-168">After several minutes, notification appears in the Flow mobile app.</span></span>

    ![작업으로 Microsoft Flow 사용](../images/5-flow-a.png)

## <a name="summary"></a><span data-ttu-id="dc292-170">요약</span><span class="sxs-lookup"><span data-stu-id="dc292-170">Summary</span></span>
<span data-ttu-id="dc292-171">IoT Central에서 규칙을 만들고, 해당 규칙이 실행될 때 Microsoft Flow를 통해 이메일 또는 모바일 알림과 같은 작업을 트리거하는 방법을 배웠습니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-171">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="dc292-172">여기서는 커피 머신의 물 온도가 최적 범위를 벗어나면 보증 상태에 따라 수리 기사나 고객에게 알림이 전송됩니다.</span><span class="sxs-lookup"><span data-stu-id="dc292-172">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the state of the warranty.</span></span> 


