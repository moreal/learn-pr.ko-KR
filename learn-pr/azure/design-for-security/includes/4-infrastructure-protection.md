최근에 Lamna Healthcare는 고객 연결 웹 응용 프로그램이 중단되는 심각한 문제를 겪었습니다. 프로덕션 웹 응용 프로그램을 포함하고 있는 리소스 그룹에 대한 전체 액세스 권한이 한 엔지니어에게 부여되었습니다. 이 엔지니어가 실수로 라이브 고객 데이터를 호스팅하는 데이터베이스를 포함하여 리소스 그룹과 모든 자식 리소스를 삭제했습니다. 

다행히 응용 프로그램 소스 코드 및 리소스를 소스 제어에서 사용할 수 있었으며 일정에 따라 주기적 데이터베이스 백업이 자동으로 실행되었습니다. 덕분에 서비스를 비교적 쉽게 복원할 수 있었습니다. 여기서는 인프라에 대한 액세스를 보호하는 Azure의 기능을 활용하여 운영 중단을 피할 수 있었던 비결을 설명하겠습니다.

## <a name="criticality-of-infrastructure"></a>인프라의 중요성

클라우드 인프라는 여러 비즈니스에서 그 중요성이 점차 부각되고 있습니다. 사람과 프로세스가 각자 맡은 작업을 완료하는 데 필요한 권한만 부여하는 것이 중요합니다. 잘못된 액세스 권한을 할당하면 데이터 손실, 데이터 유출이 발생하거나 서비스가 중단될 수 있습니다. 

시스템 관리자는 수많은 사용자, 시스템 및 사용 권한 집합을 관리해야 합니다. 따라서 적절한 액세스 권한을 신속하게 부여하기가 어려워서 '획일적 방식'으로 이어질 수 있습니다. 이 방식은 관리의 복잡성을 줄일 수 있지만, 필요 이상으로 많은 권한을 의도치 않게 부여할 가능성이 훨씬 높습니다.

## <a name="role-based-access-control"></a>역할 기반 액세스 제어

RBAC(역할 기반 액세스 제어)는 약간 다른 방법을 제공합니다. 역할은 액세스 권한 컬렉션으로 정의됩니다. 보안 주체는 역할에 직접 매핑되거나 그룹 멤버 자격을 통해 매핑됩니다. 보안 주체, 액세스 권한 및 리소스를 분리하면 액세스 관리가 간소화되고 세밀한 제어가 가능합니다.

Azure에서는 사용자, 그룹, 역할이 모두 Azure AD(Azure Active Directory)에 저장됩니다. Azure Resource Manager API는 역할 기반 액세스 제어를 사용하여 Azure 내의 모든 리소스 액세스 관리를 보호합니다.

![ACL 기반 액세스](../media-draft/ACL_Based_Access.png)

<!-- ![Role-based access control](../media-draft/Role_Based_Access.png)
 -->

### <a name="roles--management-groups"></a>역할 및 관리 그룹

역할은 "읽기 전용" 또는 "기여자"처럼 사용자에게 Azure 서비스 인스턴스 액세스를 부여할 수 있는 권한 집합입니다. 역할은 개별 서비스 인스턴스 수준에서 부여할 수 있지만 Azure Resource manager 계층 구조를 따라 아래로 흐르기도 합니다. 전체 구독 같은 더 높은 범위에서 할당된 역할은 서비스 인스턴스 같은 자식 범위에 의해 상속됩니다. 

관리 그룹은 최근에 RBAC 모델에 도입된 추가 계층 수준입니다. 관리 그룹은 구독을 그룹화하고 훨씬 높은 수준에서 정책을 적용하는 기능을 추가합니다.

또한 임의로 정의된 구독 계층을 통해 역할을 흘려보내는 기능을 통해 관리자는 인증된 사용자에게 전체 환경에 대한 임시 액세스 권한을 부여할 수 있습니다. 예를 들어 감사자는 모든 구독에 대한 임시 읽기 전용 액세스가 필요할 수 있습니다.

![관리 그룹](../media-draft/management_groups.png)

### <a name="privileged-identity-management"></a>Privileged Identity Management

RBAC를 사용하여 Azure 리소스 액세스를 관리하는 것 외에도, 인프라 보호에 대한 포괄적인 접근 방식에서는 조직의 변화와 발전에 따라 역할 멤버를 지속적으로 감사하는 방안을 고려해야 합니다. Azure AD PIM(Privileged Identity Management)은 역할 할당, 셀프 서비스 및 Just-In-Time 역할 활성화를 감독하고 Azure AD 및 Azure 리소스 액세스를 검토할 수 있는 추가 유료 제품입니다.

![Privileged Identity Management](../media-draft/PIM_Dashboard.PNG)

## <a name="providing-identities-to-services"></a>서비스에 ID 제공

서비스에 ID가 있는 것이 좋을 때가 종종 있습니다. 때때로 모범 사례에 반해, 자격 증명 정보가 구성 파일에 포함됩니다. 이러한 구성 파일과 관련된 보안이 전혀 없기 때문에 시스템 또는 리포지토리에 대한 액세스 권한을 가진 사람이라면 누구든지 자격 증명에 액세스할 수 있게 되어 위험에 노출됩니다.

Azure AD는 서비스 주체 및 관리 서비스 ID의 두 가지 방법을 통해 이 문제를 해결합니다.

### <a name="service-principals"></a>서비스 주체

서비스 주체를 이해하려면 먼저 ID 관리에 사용되는 **ID**라는 단어와 **주체**라는 단어를 이해해야 합니다.

**ID**는 인증 가능한 것을 의미합니다. 당연히 여기에는 사용자 이름 및 암호를 사용하는 사용자가 포함되지만, 비밀 키 또는 인증서를 사용하여 인증되는 응용 프로그램 또는 다른 서비스도 포함될 수도 있습니다. 추가 정의로, **계정**은 ID와 연결되는 데이터를 말합니다.

**주체**는 특정 역할 또는 클레임을 사용하여 작동하는 ID입니다. ID와 주체를 별개의 것으로 생각하는 것이 도움이 되지 않는 경우도 가끔 있지만, bash 프롬프트에서 'sudo'를 사용하거나 Windows에서 "관리자 권한으로 실행"을 사용하는 경우를 생각해 봅시다. 두 경우 모두 이전과 같은 ID로 계속 로그인되지만, 실행하는 역할은 바뀌었습니다.

이러한 이유로 **서비스 주체**라는 이름이 붙었습니다. 서비스 주체는 서비스 또는 응용 프로그램에서 사용하는 ID를 말합니다. 다른 ID와 마찬가지로 할당된 역할일 수 있습니다. 

예를 들어 Lamna Healthcare는 서비스 주체로 인증되는 역할을 실행하도록 배포 스크립트를 할당할 수 있습니다. 해당 ID가 파괴적 작업을 수행할 권한이 있는 유일한 ID인 경우 Lamna가 실수로 리소스를 삭제하는 일이 없도록 방지하는 데 많은 도움이 될 것입니다.

### <a name="managed-service-identities"></a>관리되는 서비스 ID

서비스 주체 만들기는 지루한 과정일 수 있으며 수많은 터치 지점이 있어서 유지 관리가 어려울 수 있습니다. MSI(관리 서비스 ID)는 훨씬 간단하며 대부분의 작업을 자동으로 처리합니다. 

MSI는 지원하는 모든 Azure 서비스에 대해 즉시 만들 수 있습니다(계속해서 지원 목록에 추가 중). 서비스에 대한 MSI를 만들면 Azure Active Directory 테넌트에 계정이 만들어집니다. Azure 인프라는 서비스를 인증하고 계정을 관리하는 작업을 자동으로 처리합니다. 그러면 인증된 서비스가 다른 Azure 리소스에 액세스하도록 안전하게 허용하는 것을 포함하여 해당 계정을 다른 AD 계정처럼 사용할 수 있습니다.

Lamna Healthcare는 ID 관리를 한 단계 발전시켰으며 인프라 관리 및 배포를 수행하는 기능이 필요한 모든 지원되는 서비스에 MSI를 사용합니다.

## <a name="infrastructure-protection-at-lamna-healthcare"></a>Lamna Healthcare의 인프라 보호

인프라가 실수로 삭제된 문제를 Lamna Healthcare가 어떻게 해결했는지 살펴보았습니다. Lamna Healthcare는 역할 기반 액세스 제어를 사용하여 인프라 보안을 보다 효율적으로 관리했으며, 관리되는 서비스 ID를 사용하여 자격 증명에서 코드 작성을 없애고 서비스에 필요한 ID 관리를 간소화했습니다.

## <a name="summary"></a>요약

인프라의 가용성 및 무결성을 보장하려면 인프라를 적절하게 보호해야 합니다. RBAC 및 관리되는 서비스 ID 같은 기능을 적절하게 사용하면 무단 액세스 또는 의도하지 않은 액세스로부터 Azure 환경을 보호하는 데 도움이 되며, 아키텍처의 ID 보안 기능이 향상됩니다.