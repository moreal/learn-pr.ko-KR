데이터는 조직의 가장 중요하고 대체할 수 없는 자산이고, 암호화는 계층화된 보안 전략에서 가장 강력한 최후의 방어선 역할을 합니다. 의료 서비스 공급자인 Lamna Healthcare는 대량의 중요한 데이터를 저장합니다. 최근에 암호화되지 않은 중요한 환자 데이터가 노출되는 보안 위반이 발생했으며, 이로 인해 데이터 보호 능력이 부족하다는 사실을 완전히 인지하고 있습니다. Lamna Healthcare는 암호화를 보다 잘 사용하여 이러한 사고로부터 회사와 환자를 보호하는 방법을 알고 싶어 합니다. 여기서는 암호화가 무엇인지, 데이터 암호화에 어떻게 접근할 것인지, Azure에서 어떤 암호화 기능을 제공하는지 알아보도록 하겠습니다.

## <a name="what-is-encryption"></a>암호화란?

암호화는 데이터를 읽을 수 없고 사용할 수 없게 만드는 프로세스입니다. 암호화된 데이터를 사용하거나 읽으려면 비밀 키를 사용하여 *암호를 해독*해야 합니다. 최상위 수준의 두 가지 암호화 유형으로 **대칭** 및 **비대칭**이 있습니다.

대칭 암호화는 데이터 암호화 및 암호 해독에 동일한 키를 사용합니다. 데스크톱 암호 관리자 응용 프로그램을 생각해 보세요. 사용자가 암호를 입력하면 사용자의 고유한 개인 키를 사용하여 암호가 암호화됩니다(키는 종종 마스터 암호에서 파생됨). 데이터를 검색해야 하는 경우 동일한 키를 사용하여 데이터가 암호 해독됩니다.

비대칭 암호화는 공개 키와 개인 키 쌍을 사용합니다. 두 키 중 하나는 암호화할 수 있지만 자체 암호화된 데이터는 암호 해독을 할 수 없습니다. 암호를 해독하려면 쌍으로 연결된 키가 필요합니다. 비대칭 암호화는 TLS(https에서 사용됨), 데이터 서명 등의 용도로 사용됩니다.

대칭 및 비대칭 암호화 둘 다 데이터를 적절하게 보호합니다. 

암호화는 일반적으로 미사용 암호화 및 전송 중 암호화의 두 가지 방법으로 접근합니다.

### <a name="encryption-at-rest"></a>미사용 암호화

미사용 데이터는 물리적 매체에 저장된 데이터입니다. 서버 디스크에 저장된 데이터, 데이터베이스에 저장된 데이터 또는 저장소 계정에 저장된 데이터가 여기에 속합니다. 저장소 메커니즘에 관계없이 미사용 데이터를 암호화하면, 암호 해독에 필요한 키와 비밀이 없이는 저장된 데이터를 읽을 수 없습니다. 공격자가 암호화된 데이터가 든 하드 드라이브를 손에 넣더라도 암호화 키에 액세스할 수 없으면 데이터가 쉽게 손상되지 않습니다. 이러한 시나리오에서 공격자는 하드 드라이브에서 암호화되지 않은 데이터에 액세스하는 것보다 훨씬 더 복잡하고 리소스를 많이 소비하는 암호화된 데이터에 대해 공격을 시도해야 합니다.

암호화된 실제 데이터의 콘텐츠, 사용량 및 조직에서 갖는 중요성은 다를 수 있습니다. 비즈니스에 중요한 재무 정보일 수도 있고, 회사에서 개발한 지적 재산권일 수도 있고, 회사에서 고객 또는 직원에 대해 저장한 개인 데이터일 수도 있고, 데이터 자체의 암호화에 사용되는 키 및 비밀일 수도 있습니다.

![미사용 암호화](../media-draft/encryption-at-rest.png)

### <a name="encryption-in-transit"></a>전송 중 암호화

전송 중인 데이터는 인터넷을 통해 또는 사설 네트워크를 통해 한 위치에서 다른 위치로 능동적으로 이동하는 데이터입니다. 네트워크를 통해 데이터를 보내기 전에 암호화하여 또는 두 시스템 간에 암호화되지 않은 데이터를 전송하는 보안 채널을 설정하여 데이터를 안전하게 전송할 수 있습니다. 전송 중인 데이터 암호화하면 외부 관찰자로부터 데이터를 보호할 수 있으며, 노출 위험을 제한하면서 데이터를 전송하는 메커니즘이 제공됩니다. 

![전송 중 암호화](../media-draft/encryption-in-transit.png)

## <a name="identify-and-classify-data"></a>데이터 식별 및 분류

Lamna Healthcare에서 해결하려는 문제를 다시 보겠습니다. Lamna Healthcare는 중요한 데이터가 노출되는 문제를 겪었으며, Lamna Healthcare에서 암호화하는 대상과 암호화해야 하는 대상 사이에 차이가 있습니다. 우선 Lamna Healthcare는 저장하는 데이터 종류를 식별 및 분류하고, 데이터 저장과 관련된 비즈니스 및 규정 요구 사항과 일치시켜야 합니다. 데이터 노출이 조직, 고객 또는 파트너에게 미치는 영향과 관련이 있기 때문에 이 데이터를 분류하면 유용합니다. 다음은 분류의 예입니다.

|데이터 분류|설명|
|---|---|
|제한|제한으로 분류되는 데이터가 노출, 변경 또는 삭제되면 심각한 위험이 발생합니다. 이 데이터에는 강력한 수준의 보호가 필요합니다. |
|개인| 개인으로 분류되는 데이터가 노출, 변경 또는 삭제되면 보통 수준의 위험이 발생합니다. 이 데이터에는 합리적 수준의 보호가 필요합니다. 제한 또는 공용으로 분류되지 않은 데이터는 개인으로 분류됩니다.  |
|공용| 공용으로 분류되는 데이터가 노출, 변경 또는 삭제되어도 위험이 발생하지 않습니다. 이 데이터는 보호할 필요가 없습니다. |

저장되는 데이터 종류의 인벤토리를 조사하면 중요한 데이터를 어디에 저장할 것인지, 기존 암호화가 어디에서 발생하는지 또는 발생하지 않는지 보다 정확한 그림을 얻을 수 있습니다.

조직에서 저장하는 데이터에 적용되는 규정 및 비즈니스 요구 사항을 철저하게 이해하는 것도 중요합니다. 조직에서 준수해야 하는 규정 요구 사항이 데이터 암호화 요구 사항 중 큰 부분을 차지하는 경우가 종종 있습니다. Lamna Healthcare에서 저장하는 중요한 데이터에는 환자 데이터의 취급 및 저장 방법에 대한 요구 사항이 포함된 HIPAA(Health Insurance Portability and Accountability Act)가 적용됩니다. 다른 업계에는 다른 규정 요구 사항이 적용될 수 있습니다. 금융 기관에서 저장하는 계좌 정보에는 PCI(Payment Card Industry) 표준이 적용될 수 있습니다. EU에서 사업을 하는 조직은 EU 내 개인 데이터의 취급 방법을 정의하는 GDPR(일반 데이터 보호 규정)을 따라야 합니다. 또한 경쟁 정보를 포함하고 있어서 조직을 금융 위험에 빠뜨릴 수 있는 모든 데이터를 암호화하도록 비즈니스 요구 사항에서 지시할 수 있습니다.

데이터를 분류하고 요구 사항을 정의한 후에는 다양한 도구와 기술을 활용하여 아키텍처에서 암호화를 구현하고 적용할 수 있습니다.

## <a name="encryption-on-azure"></a>Azure의 암호화

Azure가 여러 서비스에서 데이터를 암호화하는 몇 가지 방법을 살펴보겠습니다.

### <a name="encrypting-raw-storage"></a>원시 저장소 암호화

미사용 데이터에 Azure Storage 서비스 암호화를 사용하면 조직의 보안 및 규정 준수 약정에 맞게 데이터를 보호할 수 있습니다. 이 기능을 사용하면 Azure 저장소 플랫폼은 자동으로 데이터를 암호화한 후 Azure Managed Disks, Azure Blob 저장소, Azure Files 또는 Azure Queue 저장소에 보관하고, 데이터를 암호 해독한 후 검색합니다. 저장소 서비스 암호화의 암호화, 미사용 데이터의 암호화, 암호 해독, 키 관리는 서비스를 사용하여 응용 프로그램에 투명하게 처리됩니다.

Lamna Healthcare의 경우 저장소 서비스 암호화를 지원하는 서비스를 사용할 때마다 데이터가 실제 저장 매체에 암호화됩니다. 실제 디스크에 대한 액세스 권한을 획득할 가능성이 별로 없는 이벤트에서는 데이터를 실제 디스크에 쓸 때 데이터가 암호화되므로 데이터를 읽을 수 없습니다.

### <a name="encrypting-virtual-machines"></a>가상 머신 암호화

저장소 서비스 암호화는 실제 디스크에 기록된 데이터에 하위 수준 암호화 보호를 제공하지만, 가상 머신의 VHD(가상 하드 디스크)는 어떻게 보호해야 할까요? 악의적인 공격자가 Azure 구독에 대한 액세스 권한을 얻어서 가상 머신의 VHD를 탈취할 경우 공격자가 VHD에 저장된 데이터에 액세스할 수 없게 하려면 어떻게 해야 할까요?

ADE(Azure Disk Encryption)는 Windows 및 Linux IaaS 가상 머신 디스크를 암호화하도록 해주는 기능입니다. ADE는 Windows의 업계 표준 BitLocker 기능과 Linux의 DM-Crypt 기능을 활용하여 OS 및 데이터 디스크에 볼륨 암호화를 제공합니다. 이 솔루션은 고객이 디스크 암호화 키 및 비밀을 제어 및 관리할 수 있도록(그리고 관리 서비스 ID를 사용하여 키 자격 증명 모음에 액세스할 수 있도록) Azure Key Vault와 통합됩니다.

 Lamna Healthcare는 가상 머신에 ADE를 적용하여 VHD에 저장된 모든 데이터가 조직 및 규정 요구 사항을 준수하도록 보장할 수 있습니다. 부팅 디스크도 암호화되므로 사용을 제어하고 감사할 수 있습니다.

### <a name="encrypting-databases"></a>데이터베이스 암호화

Lamna Healthcare는 추가 보호가 필요한 데이터를 저장하는 데이터베이스를 여러 개 배포했습니다. Lamna Healthcare는 여러 데이터베이스를 Azure SQL Database로 이동했으며 데이터가 데이터베이스 내에서 암호화되도록 보장하기를 원합니다. 데이터 파일, 로그 파일 또는 백업 파일이 도난되더라도 암호화 키에 액세스하지 않고는 파일을 읽을 수 없도록 만들기를 원합니다.

TDE(투명한 데이터 암호화)는 악의적인 활동의 위협으로부터 Azure SQL Database 및 Azure Data Warehouse를 보호하는 데 도움이 됩니다. 응용 프로그램에 대한 변경 없이 미사용 데이터베이스, 연결된 백업 및 트랜잭션 로그 파일의 실시간 암호화 및 암호 해독을 수행합니다. 기본적으로 TDE는 새로 배포된 모든 Azure SQL Database에 대해 활성화됩니다.

TDE는 데이터베이스 암호화 키라는 대칭 키를 사용하여 전체 데이터베이스의 저장소를 암호화합니다. 기본적으로 Azure는 논리적 SQL 서버마다 고유한 암호화 키를 제공하고 모든 세부 정보를 처리합니다. Azure Key Vault에 저장된 키를 통해 Bring-your-own-key도 지원됩니다.

기본적으로 TDE가 사용되므로 Lamna Healthcare는 데이터베이스에 저장된 데이터가 적절하게 보호된다고 확신할 수 있습니다.

### <a name="encrypting-secrets"></a>비밀 암호화

모든 암호화 서비스는 키를 사용하여 데이터를 암호화하고 해독합니다. 그렇다면 키 자체의 안전은 어떻게 보장할 수 있을까요? Lamna Healthcare에는 안전하게 저장해야 하는 암호, 연결 문자열 또는 기타 중요한 정보가 있을 수도 있습니다.

Azure Key Vault는 보안 비밀 저장소 역할을 하는 클라우드 서비스입니다. Key Vault를 사용하면 자격 증명 모음이라는 보안 컨테이너를 여러 개 만들 수 있습니다. 이러한 자격 증명 모음은 HSM(하드웨어 보안 모듈)에 의해 백업됩니다. 자격 증명 모음은 응용 프로그램 비밀을 중앙 집중식으로 저장하여 보안 정보의 우발적인 손실 가능성을 줄이는 데 도움이 됩니다. 또한 Key Vault는 저장된 모든 것에 대한 액세스를 제어하고 기록합니다. Azure Key Vault는 TLS(전송 계층 보안) 인증서의 요청 및 갱신을 처리할 수 있으므로, 강력한 인증서 수명 주기 관리 솔루션에 필요한 기능을 제공합니다. Key Vault는 모든 종류의 비밀을 지원하도록 설계되었습니다. 이러한 비밀은 암호일 수도 있고, 데이터베이스 자격 증명일 수도 있고, API 키일 수도 있고, 인증서일 수도 있습니다.

Azure AD ID에 Azure Key Vault 비밀 사용 권한을 부여할 수 있으므로 MSI가 활성화된 응용 프로그램은 필요한 비밀을 자동으로, 매끄럽게 획득할 수 있습니다.

Lamna Healthcare는 시스템 간의 통신을 보호하는 데 사용되는 TLS 인증서를 포함하여 중요한 응용 프로그램 정보를 저장하는 데 Key Vault를 사용할 수 있습니다.

## <a name="encryption-at-lamna-healthcare"></a>Lamna Healthcare의 암호화

Lamna Healthcare는 저장하는 모든 데이터의 식별 및 분류 프로세스를 완료했습니다. 규제 및 비즈니스 요구 사항에 맞게 데이터를 분류했으며, 훨씬 많은 데이터를 암호화해야 한다는 사실을 인식했습니다. 중요한 데이터를 저장하는 모든 가상 머신을 암호화했으며, Blob 저장소에 저장하는 모든 중요한 환자 정보를 암호화하고 있습니다. TDE를 모든 데이터베이스에서 사용할 수 있기 때문에 관계형 데이터베이스는 분류에 관계없이 암호화 요구 사항을 충족합니다. 또한 조직 전체에 걸쳐 Key Vault를 사용하여 응용 프로그램이 작동하는 데 필요한 모든 인증서와 자격 증명 정보를 저장합니다.

## <a name="summary"></a>요약

암호화는 종종 공격자의 공격을 방어하는 마지막 방어 레이어이며, 아키텍처를 보호하는 계층화 접근 방식에서 중요한 부분입니다. Azure는 의도하지 않은 노출로부터 데이터를 보호하는 기본 기능 및 서비스를 제공합니다. Azure 서비스에 저장된 고객 데이터의 보호는 Microsoft에 매우 중요하며 모든 아키텍처 설계에 포함되어야 합니다. Azure Storage, Azure Virtual Machines, Azure SQL Database 및 Azure Key Vault 같은 기본 서비스는 암호화를 통해 환경을 보호하는 데 도움을 줍니다.