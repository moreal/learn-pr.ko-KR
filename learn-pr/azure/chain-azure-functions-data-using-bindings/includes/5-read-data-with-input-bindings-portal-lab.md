간단한 책갈피 조회 서비스를 만들려고 한다고 가정합니다. 서비스는 기본적으로 읽기 전용입니다. 사용자가 항목을 찾으려는 경우 항목의 ID를 통해 요청을 보내고 URL을 반환합니다. 다음 순서도는 이 흐름을 설명합니다.

![Cosmos DB 백 엔드에서 책갈피를 찾는 프로세스를 보여 주는 흐름 다이어그램입니다. Azure 함수는 책갈피 ID가 있는 요청을 받을 때 오류 응답이 생성되지 않으면 먼저 요청이 유효한지 확인합니다. 유효한 요청의 경우 함수는 책갈피 ID가 Cosmos DB에 있는지 확인하고, 없으면 오류 응답이 생성됩니다. 책갈피 ID가 있으면 성공 응답이 생성됩니다.](../media/5-find-bookmark-flow-small.png)

사용자가 어떤 텍스트를 통해 요청을 보내면 백 엔드 데이터베이스에서 이 텍스트가 키나 ID로 포함된 항목을 찾습니다. 항목을 찾았는지 여부를 표시하는 결과를 반환합니다.

특정 위치에 데이터를 저장해야 합니다. 이 순서도에서 데이터 저장소는 Azure Cosmos DB 인스턴스입니다. 하지만 어떻게 함수에서 해당 데이터베이스에 연결하고 데이터를 읽나요? 함수 부분에서는 해당 작업을 위해 *입력 바인딩*을 구성합니다.  Azure Portal을 통해 간단하게 바인딩을 구성합니다. 앞으로 살펴보겠지만 저장소 연결 열기 같은 작업에 코드를 작성할 필요가 없습니다. Azure Functions 런타임 및 바인딩이 이러한 작업을 담당합니다.

## <a name="create-an-azure-cosmos-db-account"></a>Azure Cosmos DB 계정 만들기

> [!NOTE]
> 이 단원은 Azure Cosmos DB의 자습서로 사용되지 않습니다. 이 모듈을 완료한 후 더 배우고자 한다면 Cosmos DB에 관한 전체 학습 경로가 있습니다.

### <a name="create-a-database-account"></a>데이터베이스 계정 만들기

데이터베이스 계정은 하나 이상의 데이터베이스를 관리하기 위한 컨테이너입니다. 데이터베이스를 만들려면 먼저 데이터베이스 계정을 만들어야 합니다.

1. 샌드박스를 활성화한 동일한 계정을 사용하여 [Azure Portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)에 로그인했는지 확인합니다.

1. Azure Portal의 왼쪽 위 모서리에서 **리소스 만들기** 단추를 선택한 다음, **데이터베이스** > **Azure Cosmos DB**를 선택합니다.

1. **새 계정** 페이지에서 새 Azure Cosmos DB 계정에 대한 설정을 입력합니다.

    | 설정 | 값 | 설명 |
    |---------|-------|-------------|
    | ID |*고유한 이름 입력*|이 Azure Cosmos DB 계정을 식별하는 고유한 이름을 입력합니다. URI를 만들기 위해 제공하는 ID에 `documents.azure.com`이 추가되므로 식별할 수 있는 고유한 ID를 사용합니다.<br><br>ID는 소문자, 숫자 및 하이픈(-) 문자만 포함할 수 있으며, 3-50자로 돼 있어야 합니다. |
    | API |SQL|API는 만들 계정의 형식을 결정합니다. Azure Cosmos DB는 응용 프로그램의 요구 사항을 충족하기 위해 SQL(문서 데이터베이스), Gremlin(그래프 데이터베이스), MongoDB(문서 데이터베이스), Azure Table 및 Cassandra라는 다섯 가지 API를 제공합니다. 각 API에는 현재 별도의 계정이 필요합니다. <br><br>**SQL**을 선택합니다. 이때 Azure Cosmos DB 트리거, 입력 바인딩 및 출력 바인딩은 SQL API 및 Graph API 계정에서만 작동합니다. |
    | 구독 | 컨시어지 구독 | 이 Azure Cosmos DB 계정에 사용하려는 Azure 구독을 선택합니다. |
    리소스 그룹|기존 항목 사용<br><br>그런 다음, **<rgn>[샌드박스 리소스 그룹 이름]</rgn>** 을 선택합니다. | 이 모듈을 위해 만든 모든 리소스를 무료 샌드박스 리소스 그룹으로 그룹화하기 때문에 **기존 항목 사용**을 선택하겠습니다. |
    | 위치 | **기존 항목 사용**을 설정한 후에 자동으로 채워집니다. | Azure Cosmos DB 계정을 호스트할 지리적 위치를 선택합니다. 데이터에 가장 빨리 액세스할 수 있도록 사용자와 가장 가까운 위치를 사용합니다. 이 실습에서는 위치가 기존 리소스 그룹에 대해 설정된 위치로 미리 결정되었습니다.|

    **새 계정** 블레이드의 모든 다른 필드는 이 모듈에서 사용하므로 기본값 상태로 유지합니다.  여기에는 **지리적 중복 사용**, **다중 마스터 사용**, **가상 네트워크**가 해당합니다.

1. **만들기**를 선택하여 데이터베이스 계정을 프로비전하고 배포합니다.

1. 배포에 다소 시간이 걸릴 수 있습니다. 따라서 알림 허브에 **배포 성공** 메시지가 표시되기를 기다렸다가 진행합니다.

    ![데이터베이스 계정 배포가 완료되었다는 알림](../media/5-db-deploy-success.PNG)

1. **리소스로 이동**을 선택하여 포털에서 데이터베이스 계정으로 이동합니다. 그런 다음, 컬렉션을 데이터베이스에 추가하겠습니다.

### <a name="add-a-collection"></a>컬렉션 추가

Cosmos DB에서는 *컨테이너*가 임의의 사용자가 생성한 엔터티를 보유합니다. SQL 및 MongoDB API 계정의 경우 컨테이너는 *컬렉션*에 매핑됩니다. 컬렉션 내부에 문서를 저장합니다.

이제 Azure Portal에서 데이터 탐색기 도구를 사용하여 데이터베이스 및 컬렉션을 만들어 보겠습니다.

1. **데이터 탐색기** > **새 컬렉션**을 선택합니다.

2. **컬렉션 추가**에서 새 컬렉션에 대한 설정을 입력합니다.

    >[!TIP]
    >**컬렉션 추가** 영역이 맨 오른쪽에 표시됩니다. 이 영역을 보려면 오른쪽으로 스크롤해야 할 수 있습니다.

    |설정|제안 값|설명
    |---|---|---|
    |데이터베이스 ID|[!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]| 데이터베이스 이름은 1-255자여야 하며, /, \\, #,? 또는 후행 공백은 포함할 수 없습니다.<br><br>여기에 원하는 대로 입력할 수 있으나 새 데이터베이스 이름은 [!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]를 추천합니다. 이것을 이 단위에서 참조할 것입니다. |
    |컬렉션 ID|[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]|새 컬렉션의 이름으로 [!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]를 입력입니다. 컬렉션 ID에는 데이터베이스 이름과 동일한 문자 요구 사항이 적용됩니다.|
    |Storage 용량| 고정(10GB)|기본값인 **고정(10GB)** 을 사용합니다. 이 값은 데이터베이스의 저장소 용량입니다.|
    |처리량|1000RU|처리량을 1000RU/s(초당 요청 단위)로 변경합니다. 처리량을 400RU/s로 설정하려면 저장소 용량을 **고정(10GB)** 으로 설정해야 합니다. 대기 시간을 줄이면 나중에 성능을 확장할 수 있습니다.|

3. **확인**을 클릭합니다. 데이터 탐색기는 새 데이터베이스 및 컬렉션을 표시합니다. 이제 데이터베이스가 생겼습니다. 데이터베이스 내부에서 컬렉션을 정의 했습니다. 이제 문서라고도 하는 일부 데이터를 추가해 보겠습니다.

### <a name="add-test-data"></a>테스트 데이터 추가

[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]라는 데이터베이스에서 컬렉션을 정의했습니다. 웹 페이지 책갈피 목록처럼 각 문서에 URL과 ID를 저장하고자 합니다.

데이터 탐색기를 사용하여 새 컬렉션에 데이터를 추가할 것입니다.

1. 데이터 탐색기에서 새 데이터베이스가 컬렉션 창에 나타납니다. [!INCLUDE [cosmos-db-name](./cosmos-db-name.md)] 데이터베이스를 확장하고 [!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)] 컬렉션을 확장하고 **문서**를 선택한 다음, **새 문서**를 선택합니다.

2. 새 문서의 기본 콘텐츠를 다음 JSON으로 바꿉니다.

     ```json
     {
         "id": "docs",
         "URL": "https://docs.microsoft.com/azure"
     }
     ```

3. **문서** 탭에 JSON을 추가한 후 **저장**을 선택합니다.

    추가한 것보다 더 많은 속성이 있음을 확인합니다. 이들은 모두 밑줄(_rid, _self, _etag, _attachments, _ts)로 시작합니다. 이러한 속성은 문서 관리를 지원하기 위해 시스템에서 생성합니다.

    |속성  |설명  |
    |---------|---------|
    | `_rid`     |     리소스 ID는 고유 식별자로서 리소스 모델의 리소스 스택에 따라 계층적입니다. 문서 리소스의 배치와 탐색을 위해 내부적으로 사용됩니다.    |
    | `_self`     |   리소스에 대한 고유의 주소 지정 가능 URI입니다.      |
    | `_etag`     |   낙관적 동시성 제어에 필요합니다.     |
    | `_attachments`     |  첨부 파일 리소스에 대한 주소 지정 가능 경로입니다.       |
    | `_ts`     |    이 리소스의 마지막 업데이트 타임 스탬프입니다.    |

4. 컬렉션에 몇 가지 문서를 더 추가해 보겠습니다. 다음과 같은 콘텐츠로 4개 문서를 더 만듭니다. 작업을 저장해야 합니다.

    ```json
    {
        "id": "portal",
        "URL": "https://portal.azure.com"
    }
    ```

    ```json
    {
        "id": "learn",
        "URL": "https://docs.microsoft.com/learn"
    }
    ```

    ```json
    {
        "id": "marketplace",
        "URL": "https://azuremarketplace.microsoft.com/marketplace/apps"
    }
    ```

    ```json
    {
        "id": "blog",
        "URL": "https://azure.microsoft.com/blog"
    }
    ```

1. 완료한 후 컬렉션이 다음과 유사해야 합니다.

    ![책갈피 컬렉션에 추가한 항목의 목록을 표시하는 포털의 SQL API UI](../media/5-db-bookmark-coll.PNG)

이제 책갈피 컬렉션에 몇 개 항목이 있습니다. 이 시나리오는 다음과 같이 작동합니다. 예를 들어"id=docs"와 함께 요청이 도착하면 책갈피 컬렉션에서 해당 ID를 조회하고 `https://docs.microsoft.com/azure` URL을 반환합니다. 이 컬렉션의 값을 조회하는 Azure 함수를 만들어 보겠습니다.

## <a name="create-your-function"></a>함수 만들기

1. 앞 단원에서 만든 함수 앱으로 이동합니다.

1. 함수 앱을 확장하여 함수 컬렉션 위를 마우스로 가리킨 다음, **Functions** 옆에 있는 **추가**(**+**) 단추를 선택합니다.
   이 작업은 함수 만들기 프로세스를 시작합니다. 다음 애니메이션에서는 다음과 같은 동작을 보여 줍니다.

   ![사용자가 함수 메뉴 항목을 마우스로 가리키면 표시되는 더하기 기호의 애니메이션](../media/3-func-app-plus-hover-small.gif)

   페이지에는 지원되는 트리거의 전체 집합이 표시됩니다.

1. 다음 스크린샷의 첫 번째 항목인 **HTTP 트리거**를 선택합니다.

    ![이미지의 왼쪽 위에 HTTP 트리거가 먼저 표시된 트리거 템플릿 선택 UI 일부의 스크린샷입니다.](../media/5-trigger-templates-small.png)

1. 다음 값을 사용하여 오른쪽에 표시되는 **새 함수** 대화 상자를 작성합니다.

    | 필드 | 값 |
    |----------|--------|
    | 언어 | **JavaScript** |
    | 이름     | [!INCLUDE [func-name-find](./func-name-find.md)] |
    | 권한 부여 수준 | **Function** |

1. **만들기**를 선택하여 사용자의 함수를 만듭니다.
    이 작업은 코드 편집기에서 *index.js* 파일을 열고 HTTP 트리거 함수의 기본 구현을 표시합니다.

### <a name="verify-the-function"></a>함수 확인

다음과 같이 새 함수를 테스트하여 지금까지 수행한 것을 확인할 수 있습니다.

1. 새 함수에서 오른쪽 맨 위에 있는 **함수 URL 가져오기**를 클릭하고 **기본값(함수 키)** 를 선택한 다음, **복사**를 클릭합니다.

1. 복사한 함수 URL을 브라우저의 주소 표시줄에 붙여넣습니다. 이 URL의 끝에 `&name=<yourname>` 쿼리 문자열 값을 추가하고, **Enter** 키를 눌러 요청을 실행합니다. 브라우저의 Azure Function에서 제대로 응답을 받아야 합니다.

이제 핵심 함수가 작동하므로 Azure Cosmos DB에서 데이터 읽기 또는 이 시나리오에서는 [!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)] 컬렉션을 살펴보겠습니다.

## <a name="add-an-azure-cosmos-db-input-binding"></a>Azure Cosmos DB 입력 바인딩 추가

데이터베이스에서 데이터를 읽으려면 입력 바인딩을 정의해야 합니다. 이제 살펴볼 것처럼 간단히 몇 단계로 데이터베이스와 통신할 수 있는 바인딩을 구성할 수 있습니다.

1. 왼쪽 창에서 **통합**을 선택하여 통합 탭을 엽니다. HTTP 트리거와 HTTP 출력 바인딩을 만드는 데 사용한 템플릿입니다. 이제 새 Azure Cosmos DB 입력 바인딩을 추가합니다.

2. **입력** 열에서 **새 입력**을 선택합니다.
   가능한 모든 입력 바인딩 형식 목록이 표시됩니다.

3. 목록에서 **Azure Cosmos DB**를 선택한 후, **선택**을 선택합니다.
   그러면 Azure Cosmos DB 입력 구성 페이지가 열립니다. 다음으로, 데이터베이스에 연결을 설정하겠습니다.

4. **Azure Cosmos DB 계정 연결** 상자 옆에 있는 **새로 만들기**를 선택합니다.
   그러면 이미 **Azure Cosmos DB 계정**과 Azure 구독이 선택되어 있는 **연결** 창이 열립니다. 마지막으로 데이터베이스 계정 ID를 선택하기만 하면 됩니다.

5. “데이터베이스 계정 만들기” 섹션에서 ID 값을 제공해야 했습니다. **데이터베이스 계정** 드롭다운 목록에서 해당 값을 찾은 다음, **선택**을 클릭합니다.

6. 데이터베이스에 대한 새 연결이 구성되고 **Azure Cosmos DB 계정 연결** 필드에 표시됩니다. 실제로 이 추상 이름 뒤에 무엇이 있는지 궁금하면 *값 표시*를 클릭하여 연결 문자열을 표시합니다.

특정 ID로 책갈피를 조회하려 하므로 받은 ID를 바인딩에 연결하겠습니다.

7. **문서 ID(선택 사항)** 필드에 `{id}`를 입력합니다. 이 구문을 *바인딩 식*이라고 합니다. 함수는 조회할 ID를 지정하기 위해 쿼리 문자열을 사용하는 HTTP 요청에 의해 트리거됩니다. ID는 컬렉션에서 고유하므로 바인딩은 0(없음) 또는 1(있음) 문서를 반환합니다.

8. 다음 표의 값을 사용하여 이 페이지의 나머지 필드를 조심스럽게 입력합니다. 언제든 각 필드 이름 오른쪽의 정보 아이콘을 클릭하여 각 필드의 용도를 확인할 수 있습니다.

    |설정  |값  |설명  |
    |---------|---------|---------|
    |문서 매개 변수 이름     |  **책갈피**       |  코드에서 이 바인딩을 식별하기 위해 사용하는 이름입니다.      |
    |데이터베이스 이름     |  [!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]       | 작업할 데이터베이스입니다. 이 값은 이 단원의 앞부분에서 설정한 데이터베이스 이름입니다.        |
    |컬렉션 이름     |  [!INCLUDE [cosmos-db-name](./cosmos-coll-name.md)]        | 데이터를 읽어오는 컬렉션입니다. 이 설정은 이 단원의 앞부분에서 정의되었습니다. |
    |SQL 쿼리(선택 사항)    |   비워 둠       |   ID를 기준으로 한 번에 한 문서만 검색합니다. 따라서 이 인스턴스에서 SQL 쿼리를 사용하는 것보다 문서 ID 필드를 통해 필터링하는 게 낫습니다. 한 항목(`SELECT * from b where b.ID = {id}`)을 반환하는 SQL 쿼리를 만들 수 있습니다. 이 쿼리는 실제로 문서를 반환하지만 문서 컬렉션 안에서 반환합니다. 코드가 불필요하게 컬렉션을 조작해야 합니다. 여러 문서를 가져오려면 SQL 쿼리 방법을 사용합니다.   |
    |파티션 키(선택 사항)     |   비워 둠      |  여기서 기본 값을 적용할 수 있습니다.       |

9. **저장**을 선택하여 이 바인딩 구성에 대한 모든 변경 내용을 저장합니다.

이제 바인딩을 정의했으므로 함수에서 바인딩을 사용할 시점입니다.

## <a name="update-function-implementation"></a>업데이트 함수 구현

1. [!INCLUDE [func-name-find](./func-name-find.md)] 함수를 선택하여 코드 편집기에서 *index.js*를 엽니다. 데이터베이스에서 읽기 위한 입력 바인딩을 추가했으므로 이 바인딩을 사용하도록 논리를 업데이트합니다.

2. *index.js*의 모든 코드를 다음 코드 조각의 코드로 바꾸고 **저장**을 누릅니다.

   [!code-javascript[](../code/find-bookmark-single.js)]

들어오는 HTTP 요청은 함수를 트리거하고 `id` 쿼리 매개 변수는 Cosmos DB 입력 바인딩으로 전달됩니다. 데이터베이스가 이 ID와 일치하는 문서를 찾은 경우 `bookmark` 매개 변수가 찾은 문서로 설정됩니다. 이 경우 책갈피가 지정된 문서에 있는 URL 값을 포함하는 응답을 생성합니다. 이 키와 일치하는 문서가 없으면 이 상황을 사용자에게 알리는 페이로드와 상태 코드로 응답합니다.

## <a name="try-it-out"></a>사용해 보기

1. 오른쪽 맨 위에서 **함수 URL 가져오기**를 선택하고 **기본값(함수 키)** 을 선택한 다음, **복사**를 선택하여 함수의 URL을 복사합니다.

2. 복사한 함수 URL을 브라우저의 주소 표시줄에 붙여넣습니다. 이 URL의 끝에 `&id=docs` 쿼리 문자열 값을 추가하고, 키보드에서 `Enter` 키를 눌러 요청을 실행합니다. 해당 리소스에 대한 URL이 포함된 응답이 표시돼야 합니다.

3. `&id=docs`를 `&id=missing`으로 바꾸고 응답을 관찰합니다.

4. 이전 쿼리 문자열을 `&id=`로 바꾸고 응답을 관찰합니다.

    >[!TIP]
    >함수 포털 UI의 **테스트** 탭을 사용해서 함수를 테스트할 수도 있습니다. 쿼리 매개 변수를 추가하거나 요청 본문을 제공하여 이전 단계에서 설명한 것과 같은 결과를 가져올 수 있습니다.

이 단원에서는 Azure Cosmos DB 데이터베이스에서 읽기 위해 수동으로 첫 번째 입력 바인딩을 만들었습니다. 데이터베이스에서 검색하고 데이터를 읽기 위해 작성한 코드 크기가 바인딩 덕분에 최소화되었습니다. 바인딩 구성 작업은 대부분 선언적으로 이루어지며 플랫폼이 나머지를 처리합니다.

다음 단원에서는 Azure Cosmos DB 출력 바인딩을 통해 책갈피 컬렉션에 더 많은 데이터를 추가합니다.