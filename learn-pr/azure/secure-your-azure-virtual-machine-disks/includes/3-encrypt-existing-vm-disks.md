<span data-ttu-id="b164d-101">회사에서 모든 VM에 ADE(Azure Disk Encryption)를 구현하기로 결정했다고 가정해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-101">Suppose your company has decided to implement Azure Disk Encryption (ADE) across all VMs.</span></span> <span data-ttu-id="b164d-102">이 결정에 따라 기존 VM 볼륨에 암호화 기능을 제공할 방법을 평가해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-102">You need to evaluate how to roll out encryption to existing VM volumes.</span></span>

<span data-ttu-id="b164d-103">여기서는 ADE의 요구 사항과 기존 Windows VM의 디스크를 암호화하기 위한 단계를 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-103">Here, we'll look at the requirements for ADE, and the steps involved in encrypting disks on existing Windows VMs.</span></span>

## <a name="azure-disk-encryption-prerequisites"></a><span data-ttu-id="b164d-104">Azure Disk Encryption 필수 구성 요소</span><span class="sxs-lookup"><span data-stu-id="b164d-104">Azure Disk Encryption Prerequisites</span></span>

<span data-ttu-id="b164d-105">첫 번째 VM 디스크를 암호화하려면 먼저 다음을 수행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-105">Before you can encrypt your first VM disk, you need to</span></span>

1. <span data-ttu-id="b164d-106">Key Vault 만들기</span><span class="sxs-lookup"><span data-stu-id="b164d-106">Create a key vault</span></span>
1. <span data-ttu-id="b164d-107">Azure AD 응용 프로그램 및 서비스 사용자 설정</span><span class="sxs-lookup"><span data-stu-id="b164d-107">Set up an Azure AD application and service principal</span></span>
1. <span data-ttu-id="b164d-108">Azure AD 앱용 Key Vault 액세스 정책 설정</span><span class="sxs-lookup"><span data-stu-id="b164d-108">Set the key vault access policy for the Azure AD app</span></span>
1. <span data-ttu-id="b164d-109">Key Vault 고급 액세스 정책 설정</span><span class="sxs-lookup"><span data-stu-id="b164d-109">Set key vault advanced access policies</span></span>

### <a name="azure-key-vault"></a><span data-ttu-id="b164d-110">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="b164d-110">Azure Key Vault</span></span>

<span data-ttu-id="b164d-111">ADE에 사용되는 암호화 키를 Azure Key Vault에 저장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-111">The encryption keys used by ADE can be stored in an Azure Key Vault.</span></span> <span data-ttu-id="b164d-112">Azure Key Vault는 비밀을 안전하게 저장하고 액세스하기 위한 도구입니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-112">Azure Key Vault is a tool for securely storing and accessing secrets.</span></span> <span data-ttu-id="b164d-113">비밀은 API 키, 암호 또는 인증서 등에 대한 액세스를 엄격하게 제어하려는 항목입니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-113">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="b164d-114">비밀을 활용하는 경우 FIPS(Federal Information Processing Standard) 140-2 수준 2 유효성이 검사된 HSM(하드웨어 보안 모듈)에서 가용성과 확장성이 뛰어난 보안 저장소가 제공됩니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-114">This provides highly available and scalable secure storage in Federal Information Processing Standards (FIPS) 140-2 Level 2 validated Hardware Security Modules (HSMs).</span></span> <span data-ttu-id="b164d-115">Key Vault를 사용하면 데이터를 암호화하는 데 사용되는 키를 완벽하게 제어할 수 있으며 키 사용을 관리 및 감사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-115">Using Key Vault, you keep full control of the keys used to encrypt your data, and you can manage and audit your key usage.</span></span> <span data-ttu-id="b164d-116">Azure Portal, Azure PowerShell 및 Azure CLI를 사용하여 Key Vault를 구성하고 관리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-116">You can configure and manage your key vault using the Azure portal, Azure PowerShell, and Azure CLI.</span></span>

>[!NOTE]
> <span data-ttu-id="b164d-117">Azure Disk Encryption을 사용하려면 Key Vault와 VM이 같은 Azure 지역에 있어야 합니다. 그래야 암호화 비밀이 다른 지역에 노출되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-117">Azure Disk Encryption requires that your Key Vault and your VMs are in the same Azure region; this ensures that encryption secrets do not cross regional boundaries.</span></span>

### <a name="azure-ad-application-and-service-principal"></a><span data-ttu-id="b164d-118">Azure AD 응용 프로그램 및 서비스 사용자</span><span class="sxs-lookup"><span data-stu-id="b164d-118">Azure AD application and service principal</span></span>

<span data-ttu-id="b164d-119">스크립트나 코드를 사용하여 VM의 암호화 구성과 같은 리소스에 액세스하거나 리소스를 수정하려는 경우 먼저 **Azure AD(Active Directory) 응용 프로그램**합을 설정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-119">To access or modify resources, such as the encryption configuration for a VM with scripts or code, you must first set up an **Azure Active Directory (AD) application**.</span></span> <span data-ttu-id="b164d-120">Azure AD(Azure Active Directory)는 다중 테넌트, 클라우드 기반 디렉터리 및 ID 관리 서비스로, 핵심 디렉터리 서비스, 응용 프로그램 액세스 관리 및 ID 보호를 단일 솔루션에 결합합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-120">Azure Active Directory (Azure AD) is a multi-tenant, cloud-based directory, and identity management service that combines core directory services, application access management, and identity protection into a single solution.</span></span>

<span data-ttu-id="b164d-121">또한 Azure **서비스 사용자**도 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-121">You'll also need an Azure **service principal**.</span></span> <span data-ttu-id="b164d-122">스크립트나 코드를 실행하는 데 사용하는 서비스 계정인 서비스 사용자가 있으면 특정 Azure 리소스에 대해 작업을 실행하는 데 필요한 특정 권한과 범위를 할당할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-122">Service principals are the service accounts you use to run the script or code, and allow you to assign the specific permissions and scope that are needed to run the task against a particular Azure resource.</span></span>

<span data-ttu-id="b164d-123">Azure AD에는 두 가지 요소가 있습니다. 응용 프로그램 개체는 응용 프로그램의 **_정의_**(응용 프로그램이 수행하는 작업)이고, 서비스 사용자는 응용 프로그램의 **_특정 인스턴스_** 입니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-123">There are two elements in Azure AD; the application object is the **_definition_** of the application (what it does), and the service principal is the **_specific instance_** of the application.</span></span>

<span data-ttu-id="b164d-124">이러한 방식은 앱이 작업을 수행하려면 필요한 최소한의 권한만이 앱에 할당되는 **최소 권한** 원칙과 일치합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-124">This approach aligns with the principle of **least privilege**, where the permissions assigned to the app are restricted to the bare minimum required to enable the app to perform its tasks.</span></span>

<span data-ttu-id="b164d-125">Azure Portal, Azure PowerShell 및 Azure CLI를 사용하여 Azure AD 응용 프로그램 및 서비스 사용자를 구성하고 관리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-125">You can configure and manage Azure AD applications and service principals using the Azure portal, Azure PowerShell, and Azure CLI.</span></span>

### <a name="key-vault-access-policies"></a><span data-ttu-id="b164d-126">Key Vault 액세스 정책</span><span class="sxs-lookup"><span data-stu-id="b164d-126">Key vault access policies</span></span>

<span data-ttu-id="b164d-127">Key Vault에 암호화 키를 저장하려면 Key Vault에 쓸 수 있는 Azure Active Directory 응용 프로그램의 **클라이언트 ID** 및 **클라이언트 비밀** 관련 세부 정보를 ADE에 제공해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-127">Before you can store encryption keys in a Key Vault, ADE requires details on the **Client ID** and the **Client Secret** of the Azure Active Directory application that is permitted to write to the Key Vault.</span></span>

<span data-ttu-id="b164d-128">또한 Key Vault의 암호화 키 액세스 권한을 Azure에 제공해야 합니다. 그래야 VM이 볼륨 부팅 및 암호 해독용으로 해당 암호화 키를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-128">You'll also need to provide Azure access to the encryption keys in your key vault, so they are made available to the VM for booting and decrypting the volumes.</span></span>

## <a name="set-key-vault-advanced-access-policies"></a><span data-ttu-id="b164d-129">Key Vault 고급 액세스 정책 설정</span><span class="sxs-lookup"><span data-stu-id="b164d-129">Set key vault advanced access policies</span></span>

<span data-ttu-id="b164d-130">**고급 액세스 정책**을 설정하면 Key Vault에서 디스크 암호화를 사용할 수 있습니다. 이러한 정책이 없으면 암호화 배포가 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-130">**Advanced access policies** enable disk encryption on the key vault, and without them, encryption deployments will fail.</span></span> 

<span data-ttu-id="b164d-131">사용하도록 설정해야 하는 정책은 다음의 세 가지입니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-131">There are three policies that need to be enabled:</span></span>

- <span data-ttu-id="b164d-132">**디스크 암호화용 Key Vault** Azure Disk Encryption용 필수 정책입니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-132">**Key Vault for disk encryption** Required for Azure Disk encryption.</span></span>
- <span data-ttu-id="b164d-133">**배포용 Key Vault** Microsoft.Compute 리소스 공급자가 Key Vault에서 비밀을 검색할 수 있도록 합니다. 이 정책은 VM을 만들 때 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-133">**Key Vault for deployment** Enables the Microsoft.Compute resource provider to retrieve secrets from the key vault; this policy is needed when creating a VM.</span></span>
- <span data-ttu-id="b164d-134">**템플릿 배포용 Key Vault(필요한 경우)** Azure Resource Manager가 Key Vault에서 비밀을 가져올 수 있도록 합니다. 이 정책은 VM 배포에 ARM 템플릿을 사용할 때 필요합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-134">**Key Vault for template deployment, if needed** Enables Azure Resource Manager to get secrets from the key vault; this policy is required when using ARM templates for VM deployment.</span></span>

<span data-ttu-id="b164d-135">Azure Portal, Azure PowerShell 또는 Azure CLI를 사용하여 Key Vault 액세스 정책을 구성하고 관리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-135">Key vault access policies can be configured and managed using the Azure portal, Azure PowerShell, or the Azure CLI.</span></span>

### <a name="what-is-the-azure-disk-encryption-prerequisites-configuration-script"></a><span data-ttu-id="b164d-136">Azure Disk Encryption 필수 구성 요소 구성 스크립트</span><span class="sxs-lookup"><span data-stu-id="b164d-136">What is the Azure Disk Encryption Prerequisites Configuration Script</span></span>

<span data-ttu-id="b164d-137">**Azure Disk Encryption 필수 구성 요소 구성 스크립트**를 사용하면 암호화 필수 구성 요소를 모두 설치하거나 원하는 수만큼 설치할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-137">The **Azure Disk Encryption Prerequisites Configuration Script** sets up all (or as many as you want) of the encryption prerequisites.</span></span> <span data-ttu-id="b164d-138">또한 암호화하려는 VM과 Key Vault가 같은 지역에 있는지도 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-138">The script also ensures that your Key Vault is in the same region as the VM you are going to encrypt.</span></span> <span data-ttu-id="b164d-139">이 스크립트는 리소스 그룹과 Key Vault를 만들고 Key Vault 액세스 정책을 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-139">It will create a resource group, a key vault, and set the key vault access policy.</span></span> <span data-ttu-id="b164d-140">또한 스크립트는 실수로 삭제되지 않도록 키 자격 증명 모음에 리소스 잠금을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-140">The script also creates a resource lock on the key vault to help protect it from accidental deletion.</span></span>

## <a name="encrypting-an-existing-vm-disk"></a><span data-ttu-id="b164d-141">기존 VM 디스크 암호화</span><span class="sxs-lookup"><span data-stu-id="b164d-141">Encrypting an existing VM disk</span></span>

<span data-ttu-id="b164d-142">**Azure Disk Encryption 필수 구성 요소 구성 스크립트**를 사용할 때는 다음의 두 단계를 수행하여 기존 VM 디스크를 암호화합니다.</span><span class="sxs-lookup"><span data-stu-id="b164d-142">There are two steps for encrypting an existing VM disk, when using the **Azure Disk Encryption Prerequisites Configuration Script**:</span></span>

1. <span data-ttu-id="b164d-143">Azure Disk Encryption 필수 구성 요소 구성 스크립트 실행</span><span class="sxs-lookup"><span data-stu-id="b164d-143">Run the Azure disk encryption prerequisites configuration script.</span></span>
1. <span data-ttu-id="b164d-144">PowerShell에서 Azure Virtual Machine 암호화</span><span class="sxs-lookup"><span data-stu-id="b164d-144">Encrypt the Azure virtual machine in PowerShell</span></span>
