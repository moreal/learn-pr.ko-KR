최종 사용자는 응용 프로그램에서 더 많은 기능을 기대합니다. 뛰어난 사용자 환경에서 작업하고 성능 문제의 영향을 받지 않기 원합니다. 성능 병목 상태 확인 기능을 아키텍처에 통합하려면 어떻게 해야 할까요? 이 단원에서는 응용 프로그램이 잘 작동되도록 하고 성능이 좋지 않을 때 이유를 추적하는 데 도움이 되는 프로세스와 도구를 살펴봅니다.

## <a name="importance-of-requirements"></a>요구 사항의 중요성

성과를 논의하기 전에 요구 사항을 파악하는 것이 중요합니다. 이론상으로는 확장성과 성능을 계속해서 끝없이 향상할 수 있습니다. 그러나 특정 시점이 되면 추가적인 향상이 너무 어려워지고, 비용이 많이 초래되며, 가치 있는 비즈니스 영향력도 줄어듭니다. 

Microsoft의 **NFR(비기능적 요구 사항)** 은 이러한 시점을 파악하는 데 도움이 됩니다. 이러한 특정 요구 사항은 앱이 ‘수행’해야 하는 작업을 알려주지 않습니다. 대신, 충족해야 하는 품질 수준을 알려줍니다. 예를 들어 이러한 NFR이 다음과 같은 내용을 제공하도록 정의할 수 있습니다. 

- 트랜잭션이 지정된 부하에서 결과를 반환해야 하는 속도.
- 오류를 반환하기 전까지 지원해야 하는 동시 연결 수.
- 서버 실패 시, 백업이 온라인 상태가 되기 전에 응용 프로그램 작동 중지가 허용되는 최대 시간.

솔루션 빌드 전에 이러한 요구 사항을 정의하는 것은 응용 프로그램이 기대 수준을 충족하면서도 필요한 것보다 더 큰 노력이 필요하거나 더 큰 비용을 투입하지 않도록 하는 데 중요합니다. 또한 이러한 비기능적 요구 사항에 대한 모니터링 및 운영 규칙을 계획할 수도 있습니다. 

이해 관계자 또는 고객과 함께 요구 사항에 대해 논의하고, 문서로 기록한 후, 널리 알려서 모든 사람이 “적절한 성능”의 의미에 동의할 수 있도록 합니다.

## <a name="devops-and-application-performance"></a>DevOps 및 응용 프로그램 성능

DevOps 개발 이면에는 Microsoft 조직에 개발 및 인프라 사일로(silo)가 없다는 개념이 자리하고 있습니다. 대신, 효율적인 프로세스에서 앱을 효과적으로 빌드, 배포, 모니터링 및 유지 관리하기 위해 노력합니다.

계획, 개발, 테스트 및 모니터링은 반복적인 접근 방식으로 수행됩니다. 응용 프로그램의 성능 및 품질은 라이브 환경에 배포하는 경우처럼 나중에 고려하는 부분이라기보다, 소프트웨어 개발 수명 주기의 일부가 되고 있습니다.

![DevOps 주기](../media/devops-cycle.png)

이 접근 방식은 “shifting left”라고 하는 DevOps 개념과 일치합니다. 즉, 품질 제어 검사를 배포 및 릴리스 프로세스 초기에 실시하는 것을 의미합니다. 이렇게 하면 최종 사용자에게 영향을 미치는 문제를 프로세스 초기에 찾아낼 수 있습니다. 연속 주기로 작업할 때 수동 상호 작용의 양을 제한하고 최대한 자동화합니다. 

성능을 DevOps 프로세스의 일부로 만드는 한 가지 방법은 프로덕션 환경으로 배포하기 전에 성능 또는 부하 테스트를 수행하여 응용 프로그램이 비기능적 요구 사항을 충족하는지 유효성을 검사하는 것입니다.

실제 프로덕션 서버에 영향을 주지 않으면서 프로덕션 환경과 정확히 동일한 환경에서 성능 및 부하 테스트를 수행할 수 있으면 가장 좋습니다. 클라우드를 활용하는 경우 이 기능을 완전히 사용할 수 있습니다. 프로덕션 유사 환경 생성을 자동화하고, 테스트를 수행한 후, 해당 환경을 삭제하여 비용을 최소화할 수 있습니다. 이 자동화에 대한 접근 방법은 응용 프로그램이 사용자가 지금 요구하는 확장을 처리하고, 향후 성장에 대응할 수 있다는 확신을 줄 수 있습니다.

응용 프로그램 성능 모니터링은 이 기능의 핵심 부분이 됩니다. 응용 프로그램에 대해 성능 및 부하 테스트를 실행하고 있거나 프로덕션 성능을 계속 확인하려는 경우 비최적화 상태로 작동할 수 있는 응용 프로그램의 부분을 이해하려고 합니다. 이 작업을 수행하는 몇 가지 방법을 살펴보겠습니다.

## <a name="performance-monitoring-options-in-azure"></a>Azure의 성능 모니터링 옵션

모니터링은 비즈니스 응용 프로그램 및 관련 리소스의 성능, 상태 및 가용성을 결정하기 위해 데이터를 수집 및 분석하는 작업입니다.

응용 프로그램이 원활하게 실행되고 있다는 정보를 계속 제공받고 싶습니다. 자동 관리 알림을 사용하여 발생하는 중요한 문제에 대해 알림을 받을 수 있습니다. 고려할 모니터링 계층이 다양하며, 특히 인프라 계층과 응용 프로그램 계층에 유의해야 합니다.

### <a name="azure-monitor"></a>Azure Monitor

Azure Monitor는 인프라 수준 로그에 대한 단일 관리 지점과 대부분의 Azure 서비스에 대한 모니터링을 제공합니다. Azure Monitor는 메트릭, 활동 로그, 진단 로그 등을 수집합니다. Azure Monitor는 다음을 포함한 다양한 기능을 제공합니다.

- Azure는 발생하는 메트릭 또는 활동 위반을 사전에 알리거나 조치를 취하도록 경고합니다.
- Azure 대시보드를 사용하여 여러 모니터링 원본을 응용 프로그램의 단일 보기로 결합합니다.

Azure Monitor는 거의 실시간으로 모든 리소스 메트릭 인사이트를 확인하기에 적절한 시작점입니다. 많은 Azure 리소스가 배포 후에 자동으로 메트릭 출력을 시작합니다. 예를 들어, Azure 웹앱 인스턴스는 계산 및 응용 프로그램 요청 메트릭을 출력합니다. VM 호스트 진단 메트릭 외에 Application Insights의 메트릭도 여기에서 수집 및 분석됩니다. 옵트인(Opt-In)하면 VM 게스트 진단 메트릭도 표시됩니다.

### <a name="log-analytics"></a>Log Analytics

중앙 집중식 로깅은 추적하기 어려운 숨겨진 문제를 찾아내는 데 도움이 될 수 있습니다. Log Analytics를 사용하여 로그 간에 데이터를 쿼리하고 집계할 수 있습니다. 이러한 원본 간 상관 관계는 로그 또는 메트릭을 개별적으로 살펴볼 때 명확하지 않을 수 있는 문제 또는 성능 문제를 식별하는 데 도움이 될 수 있습니다.

![Log Analytics 원본](../media/log-analytics.png)

광범위한 데이터 원본, 보안 로그, Azure 활동 로그, 서버, 네트워크 및 응용 프로그램 로그를 수집 및 분석할 수 있습니다. 하이브리드 배포 시나리오에서 온-프레미스 System Center Operations Manager 데이터를 Log Analytics에 밀어넣고, 자세한 성능 모니터링을 위해 Azure SQL Database에서 Log Analytics로 직접 진단 정보를 보내도록 할 수도 있습니다.

중앙 집중식 로깅은 성능 문제를 비롯한 모든 유형의 시나리오를 해결하는 데 큰 도움이 될 수 있습니다. 모든 아키텍처에 적합한 모니터링 전략의 핵심 부분에 해당합니다.

## <a name="application-performance-management"></a>응용 프로그램 성능 관리

심층적인 응용 프로그램 문제는 종종 추적하기 어렵습니다. 이러한 경우 APM(응용 프로그램 성능 관리) 솔루션을 사용하여 원격 분석을 응용 프로그램으로 통합함으로써 하위 레벨 응용 프로그램 성능 및 동작을 추적하는 방식이 도움이 될 수 있습니다. 이 원격 분석에는 개별 페이지 요청 시간, 응용 프로그램 내의 예외 및 비즈니스 논리를 추적하기 위한 사용자 지정 메트릭도 포함될 수 있습니다. 이 원격 분석은 응용 프로그램 내에서 진행 중인 작업에 대한 풍부한 인사이트를 제공할 수 있습니다.

Azure에서 Application Insights는 이러한 심층 응용 프로그램 성능 관리를 제공하는 서비스입니다. 응용 프로그램에 작은 계측 패키지를 설치하고 Microsoft Azure Portal에서 Application Insights 리소스를 설정합니다. 이 계측 기능이 앱을 모니터링하여 포털에 원격 분석 데이터를 보냅니다.

호스트 환경(예: 성능 카운터, Azure 진단 및 Docker 로그)에서 원격 분석 데이터를 수집할 수 있습니다. 웹 서비스에 주기적으로 가상 요청을 보내는 웹 테스트를 설정할 수도 있습니다. 클라이언트 또는 서버 코드에 사용자가 직접 작성하는 사용자 지정 이벤트 및 메트릭을 전송하도록 응용 프로그램을 구성할 수도 있습니다. 판매된 아이템 또는 승리한 게임 같은 응용 프로그램 고유의 이벤트를 예로 들 수 있습니다.

Application Insights는 공통 리포지토리에 해당 데이터를 저장하며, 메트릭은 Azure Monitor와 공유됩니다. Log Analytics 쿼리 언어를 사용하여 경고, 대시보드 및 심층 분석과 같은 공유된 기능을 활용할 수 있습니다.

웹 응용 프로그램의 가용성을 확인하는 데 사용된 공통 패턴은 상태 엔드포인트 모니터링 패턴입니다. 이 패턴은 웹 응용 프로그램 및 연결된 백 엔드 서비스를 모니터링하여 사용 가능한지와 제대로 작동되는지를 확인하는 데 사용됩니다. 패턴은 특정 URI를 쿼리하여 구현됩니다. 엔드포인트는 프런트 엔드 자체의 가용성이 아닌 앱이 의존하는 백 엔드 서비스를 포함하는 많은 구성 요소의 상태를 확인합니다. 이 엔드포인트는 서비스의 전체 상태 표시를 반환하는 서비스 수준 상태 검사로 작동합니다.

Application Insights와 같은 응용 프로그램 성능 모니터링 솔루션을 사용하여 응용 프로그램을 깊이 있게 이해하고, 응용 프로그램 간 활동을 상호 연결합니다. 이렇게 하면 클라이언트 브라우저 및 서버에서 다운스트림 서비스까지 특정 작업이 작동하는 방식을 이해하는 데 도움이 됩니다. 또한 추세에 대한 인사이트를 제공하고, 문제가 있을 때 알리고, 사용자가 인식하기 전에 문제 발생 위치 및 해결 방법을 파악하는 데 도움이 됩니다.

## <a name="performance-monitoring-at-lamna-healthcare"></a>Lamna Healthcare의 성능 모니터링

Lamna Healthcare는 두 Azure 지역에서 가상 머신 및 Azure SQL 데이터베이스를 사용하여 웹 기반 환자 예약 시스템을 구현했습니다. VM 에이전트 및 Log Analytics를 사용하여 기본 프런트 엔드 가상 머신의 성능을 모니터링하기로 결정했습니다.

Azure Monitor를 사용하여 Azure SQL 데이터베이스의 성능을 이해하고, CPU % 및 교착 상태와 같은 주요 성능 메트릭을 캡처합니다.

Application Insights는 가용성 및 원격 분석 정보를 캡처하도록 구성되었습니다. 팀은 사용자 지정 이벤트 원격 분석을 Application Insights로 전송하도록 새 예약 기능을 변경했습니다. 이제 팀에서는 발생하는 비즈니스 관련 이벤트의 용량을 이해하는 방식을 갖추게 되었으며, 해당 응용 프로그램 내에서 진행되는 작업에 대해 더 나은 인사이트를 얻을 수 있습니다.

## <a name="summary"></a>요약

일부 프로세스, 도구 및 모범 사례를 검토하여 성능 문제를 추적하고 응용 프로그램이 최적 상태에서 작동하고 있는지 확인했습니다. 이 모듈 전체에서 학습한 내용을 마무리하겠습니다.
