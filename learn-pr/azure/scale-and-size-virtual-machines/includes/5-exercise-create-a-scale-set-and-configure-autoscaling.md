이 연습에서는 가상 머신 확장 집합 자동 크기 조정에 대 한 규칙을 만들려면 Azure portal을 사용 합니다.

## <a name="create-a-virtual-machine-scale-set"></a>가상 머신 확장 집합 만들기

1. Azure Portal에서 **리소스 만들기**를 클릭합니다.

1. 검색 상자에 입력 **확장 집합** ENTER 키를 누릅니다. 에 **결과** 블레이드에서 클릭 **가상 머신 확장 집합**, 및를 **가상 머신 확장 집합** 블레이드에서 클릭 **만들기**합니다.

1. 에 **가상 머신 확장 집합 만들기** 블레이드에서 다음 값을 입력 (대체 `<your initials>`를 `<date>`, 및 `<time>` 관련 데이터를 사용 하 여)를 클릭 하 고 **만들기**합니다.

    |설정|값|
    |---|---|
    |가상 머신 확장 집합 이름|WebServerSS|
    |리소스 그룹|-기존 항목 사용 <rgn>[샌드박스 리소스 그룹 이름]</rgn>|
    |사용자 이름|LocalAdmin|
    |암호와 암호 확인|Adm1nPa$$word|
    |인스턴트 수|2|
    |인스턴스 크기|D2s_v3|
    |부하 분산 옵션 선택|부하 분산 장치|
    |공용 IP 주소 이름|WebServerPubIP|
    |도메인 이름 레이블|`<your initials><date><time>` (예를 들어 ja0904181202)|

1. 확장 집합 생성 될 때까지 기다립니다.

1. 로 이동 합니다 **<rgn>[샌드박스 리소스 그룹 이름]</rgn>** 리소스 그룹입니다. 에 **<rgn>[샌드박스 리소스 그룹 이름]</rgn>** 블레이드에서 클릭 합니다 **WebServerSS** 개체 고를 **WebServerSS** 블레이드에서 클릭**인스턴스**합니다. 확장 집합 내에서 실행 되는 두 개의 가상 머신 인스턴스를 note 합니다.

## <a name="create-and-apply-autoscale-rules"></a>만들기 및 자동 크기 조정 규칙 적용

1. 에 **WebServerSS** 블레이드에서 클릭 **배율**합니다. 에 **WebServerSS-크기 조정** 블레이드에서 클릭 **자동 크기 조정 사용**합니다.

1. 에 **WebServerSS-크기 조정** 블레이드에서 클릭 **규칙을 추가**합니다.

1. 에 **크기 조정 규칙** 블레이드에서 평균 CPU 사용량이 5 분 기간 및 클릭을 통해 75% 이상 때 두 개의 추가 virtual machines를 확장 하는 규칙을 만들려면 다음 정보를 입력 **추가**합니다.

    |설정|값|
    |---|---|
    |시간 집계|평균|
    |메트릭 이름|백분율 CPU|
    |시간 조직 통계|평균|
    |연산자|초과|
    |임계값|75|
    |기간(분)|5|
    |작업|다음을 기준으로 개수 늘이기|
    |인스턴트 수|2|
    |정지(분)|5|

1. 에 **WebServerSS-크기 조정** 블레이드에서 클릭 **규칙을 추가**합니다.

1. 에 **크기 조정 규칙** 블레이드에서 때 평균 CPU 사용량이 30%, 5 분 동안 한 번에 하나의 서버에서 크기를 조정 하는 규칙을 만드는 데 필요한 다음 정보를 입력 하 고 클릭 **추가**합니다.

    |설정|값|
    |---|---|
    |시간 집계|평균|
    |메트릭 이름|백분율 CPU|
    |시간 조직 통계|평균|
    |연산자|다음보다 적음|
    |임계값|30|
    |기간(분)|5|
    |작업|다음을 기준으로 개수 줄이기|
    |인스턴트 수|1|
    |정지(분)|5|

1. 에 **WebServerSS-크기 조정** 블레이드는 **자동 크기 조정 설정 이름** 상자에 입력 **WebAutoscaleSetting**합니다. 옆에 **인스턴스 제한**에서 다음 값을 설정 하 고 클릭 **저장**합니다.

    |설정|값|
    |---|---|
    |최소|2|
    |최대|8|
    |기본값|2|

## <a name="generate-load-to-demonstrate-autoscaling"></a>자동 크기 조정을 보여 주기 위해 부하를 생성 합니다.

이제 CPUStress.exe 도구를 사용 하 여 생성 하는 확장 집합의 가상 컴퓨터에 로드 하 고 자동 확장을 보여 줍니다.

1. 에 연결할 공용 IP 주소를 확인 하려면로 이동 합니다 **ExerciseRG** 리소스 그룹입니다. 에 **ExerciseRG** 블레이드를 클릭 합니다 **WebServerSSlb** 개체입니다.

1. 에 **WebServerSSlb** 블레이드에서 클릭 **프런트 엔드 IP 구성** 표시 된 공용 IP 주소를 적어둡니다. 닫기 합니다 **LoadBalancerFrontEnd** 블레이드입니다.

1. 에 연결 하 여 포트 번호를 확인 하는 **WebServerSSlb** 블레이드에서 클릭 **인바운드 NAT 규칙**합니다. 각 가상 머신에 대 한 서비스 열에서 사용자 지정 포트 번호를 적어 note 합니다.

1. 로컬 컴퓨터에서 시작 합니다 **원격 데스크톱 연결**합니다. 에 **컴퓨터** 상자 뒤에 콜론, 부하 분산 장치의 공용 IP 주소를 입력 하 고 다음 포트 번호 값 예를 들어 0 (예를 들어 40.67.191.221:50000) 및 클릭 **Connect**합니다.

1. 에 **Windows 보안** 대화 상자에서 클릭 **더 많은 선택 사항**를 클릭 하 고 **다른 계정을 사용 하 여**. 에 **사용자 이름** 상자에 입력 **LocalAdmin**합니다. 에 **암호** 상자에 입력 **Adm1nPa$ $word**를 클릭 하 고 **확인**합니다.

1. 에 **원격 데스크톱 연결** 대화 상자, 클릭 **예**합니다.

1. 원격 데스크톱 가상 컴퓨터를 Internet Explorer를 열고에 **Internet Explorer 설정** 대화 상자, 클릭 **확인**합니다.

1. **Internet Explorer**, 주소 표시줄에 입력 **http://download.sysinternals.com/files/CPUSTRES.zip** ENTER 키를 누릅니다. 에 **Internet Explorer** 대화 상자, 클릭 **추가**합니다. 에 **신뢰할 수 있는 사이트** 대화 상자에서 클릭 **추가** 을 클릭 한 다음 **닫기**합니다.

1. 다운로드 메시지가 자동으로 표시 되지 않는 경우 URL을 다시 입력 하 고 enter 키를 해야 합니다. 에 **Internet Explorer** 대화 상자, 클릭 **저장**합니다. 다운로드가 완료 되 면 클릭 **폴더 열기**합니다.

1. 에 **다운로드** 폴더를 두 번 클릭 **CPUSTRES**, 두 번 클릭 합니다 **CPUSTRES** 응용 프로그램. 에 **압축 (zip) 폴더** 대화 상자, 클릭 **실행**합니다.

1. 에 **CPU 스트레스** 창 아래에 있는 **스레드 1**를 **활동** 드롭다운 목록에서 선택 **최대**합니다. 아래 **스레드 2**를 클릭 합니다 **Active** 확인란을 및를 **활동** 드롭다운 목록에서 선택 **최대**.

1. 시작 단추를 클릭 한 다음 클릭 **작업 관리자**합니다. 작업 관리자에서 클릭 **자세한 내용은**, CPU가 75% 개를 확인 합니다.

1. 설치 및 시작 반복 **CPUSTRES** 다른 가상 머신에서 확장에서을 설정 하 고 5 분 동안 기다립니다.

1. Azure portal에서로 이동 합니다 **ExerciseRG** 리소스 그룹입니다. 에 **ExerciseRG** 블레이드를 클릭 합니다 **WebServerSS** 개체입니다. 에 **WebServerSS** 블레이드에서 클릭 **인스턴스**합니다. Note 얼마나 많은 가상 머신 인스턴스 상태 및 확장 집합 내에 표시 됩니다.

여기에서 만든 두 virtual machines를 사용 하 여 설정 하는 가상 머신 확장 합니다. 다음 자동으로 확장 하 고 확장 집합의 크기 조정 규칙을 만들고 자동 크기 조정 프로필 규칙을 추가 합니다.