이 연습에서는 Azure Portal을 사용하여 자동 크기 조정 규칙이 포함된 가상 머신 확장 집합을 만듭니다.

## <a name="create-a-virtual-machine-scale-set"></a>가상 머신 확장 집합 만들기

1. Azure Portal에서 **리소스 만들기**를 클릭합니다.

1. 검색 상자에서 **확장 집합**을 입력하고 Enter 키를 누릅니다. **결과** 블레이드에서 **가상 머신 확장 집합**을 클릭하고, **가상 머신 확장 집합** 블레이드에서 **만들기**를 클릭합니다.

1. **가상 머신 확장 집합 만들기** 블레이드에서 다음 값을 입력하고, `<your initials>`, `<date>` 및 `<time>`을 관련 데이터로 바꾼 다음, **만들기**를 클릭합니다.

    |설정|값|
    |---|---|
    |가상 머신 확장 집합 이름|WebServerSS|
    |리소스 그룹|기존 항목 사용 - ExerciseRG|
    |사용자 이름|LocalAdmin|
    |암호 및 암호 확인|Adm1nPa$$word|
    |인스턴트 수|2|
    |인스턴스 크기|D2s_v3|
    |부하 분산 옵션 선택|부하 분산 장치|
    |공용 IP 주소 이름|WebServerPubIP|
    |도메인 이름 레이블|`<your initials><date><time>`(예: ja0904181202)|

1. 확장 집합이 만들어질 때까지 기다립니다.

1. **ExerciseRG** 리소스 그룹으로 이동합니다. **ExerciseRG** 블레이드에서 **WebServerSS** 개체를 클릭하고, **WebServerSS** 블레이드에서 **인스턴스**를 클릭합니다. 확장 집합 내에서 실행되는 두 개의 가상 머신 인스턴스에 유의하세요.

## <a name="create-and-apply-autoscale-rules"></a>자동 크기 조정 규칙 만들기 및 적용

1. **WebServerSS** 블레이드에서 **크기 조정**을 클릭합니다. **WebServerSS - 크기 조정** 블레이드에서 **자동 크기 조정 사용**을 클릭합니다.

1. **WebServerSS - 크기 조정** 블레이드에서 **규칙 추가**를 클릭합니다.

1. [크기 조정 규칙] 블레이드에서 다음 정보를 입력하여 평균 CPU 사용량이 5분 기간 동안 75%를 초과하면 두 개의 가상 머신을 추가로 확장하는 규칙을 만든 다음, **추가**를 클릭합니다.

    |설정|값|
    |---|---|
    |시간 집계|평균|
    |메트릭 이름|CPU 사용률|
    |시간 조직 통계|평균|
    |연산자|보다 큼|
    |임계값|75|
    |기간(분)|5|
    |작업|다음을 기준으로 개수 늘이기|
    |인스턴트 수|2|
    |정지 시간(분)|5|

1. **WebServerSS - 크기 조정** 블레이드에서 **규칙 추가**를 클릭합니다.

1. [크기 조정 규칙] 블레이드에 다음 정보를 입력하여 평균 CPU 사용량이 5분 기간 동안 30% 미만이면 하나의 서버를 축소하는 규칙을 만든 다음, **추가**를 클릭합니다.

    |설정|값|
    |---|---|
    |시간 집계|평균|
    |메트릭 이름|CPU 사용률|
    |시간 조직 통계|평균|
    |연산자|보다 작음|
    |임계값|30|
    |기간(분)|5|
    |작업|다음을 기준으로 개수 줄이기|
    |인스턴트 수|1|
    |정지 시간(분)|5|

1. **WebServerSS - 크기 조정** 블레이드의 **자동 크기 조정 설정 이름** 상자에서 **WebAutoscaleSetting**을 입력합니다. **인스턴스 제한** 옆에서 다음 값을 설정한 다음, **저장**을 클릭합니다.

    |설정|값|
    |---|---|
    |최소|2|
    |최대|8|
    |기본값|2|

## <a name="generate-load-to-demonstrate-autoscaling"></a>로드를 생성하여 자동 크기 조정 시연

이제 CPUStress.exe 도구를 사용하여 확장 집합의 가상 머신에서 로드를 생성하고 자동 크기 조정을 보여 줍니다.

1. 연결할 공용 IP 주소를 확인하려면 **ExerciseRG** 리소스 그룹으로 이동합니다. **ExerciseRG** 블레이드에서 **WebServerSSlb** 개체를 클릭합니다.

1. **WebServerSSlb** 블레이드에서 [프런트 엔드 IP 구성]을 클릭하고 표시된 공용 IP 주소를 적어 둡니다. **LoadBalancerFrontEnd** 블레이드를 닫습니다.

1. 연결할 포트 번호를 확인하려면 **WebServerSSlb** 블레이드에서 **인바운드 NAT 규칙**을 클릭합니다. 각 가상 머신에 대한 [서비스] 열의 사용자 지정 포트 번호를 적어 둡니다.

1. 로컬 컴퓨터에서 **원격 데스크톱 연결**을 시작합니다. **컴퓨터** 상자에서 부하 분산 장치의 공용 IP 주소, 콜론 및 인스턴스 0에 대한 포트 번호 값을 차례로 입력한 다음(예: 40.67.191.221:50000), [연결]을 클릭합니다.

1. **Windows 보안** 대화 상자에서 **기타 선택 사항**, **다른 계정 사용**을 차례로 클릭하고, **사용자 이름** 상자에서 **LocalAdmin**을 입력하고, **암호** 상자에서 **Adm1nPa$$word**를 입력한 다음, **확인**을 클릭합니다.

1. **원격 데스크톱 연결** 대화 상자에서 **예**를 클릭합니다.

1. 가상 머신 원격 데스크톱에서 Internet Explorer를 열고, **Internet Explorer 설정** 대화 상자에서 **확인**을 클릭합니다.

1. **Internet Explorer**의 주소 표시줄에서 **http://download.sysinternals.com/files/CPUSTRES.zip**을 입력하고 Enter 키를 누릅니다. **Internet Explorer** 대화 상자에서 **추가**를 클릭합니다. **신뢰할 수 있는 사이트** 대화 상자에서 **추가**를 클릭한 다음, **닫기**를 클릭합니다.

1. 다운로드 프롬프트가 자동으로 표시되지 않으면 URL을 다시 입력하고 ENTER 키를 눌러야 할 수도 있습니다. **Internet Explorer** 대화 상자에서 **저장**을 클릭합니다. 다운로드가 완료되면 **폴더 열기**를 클릭합니다.

1. **다운로드** 폴더에서 **CPUSTRES**를 두 번 클릭한 다음, **CPUSTRES** 응용 프로그램을 두 번 클릭합니다. **압축(ZIP) 폴더** 대화 상자에서 **실행**을 클릭합니다.

1. **CPU 스트레스** 창에 있는 **스레드 1** 아래의 **활동** 드롭다운에서 **최대**를 선택합니다. **스레드 2** 아래에서 **활동** 확인란을 클릭하고, **활동** 드롭다운에서 **최대**를 선택합니다.

1. [시작] 단추를 클릭한 다음, **작업 관리자**를 클릭합니다. [작업 관리자]에서 **자세한 내용**을 클릭하고, CPU가 75%를 초과하는지 확인합니다.

1. 설치를 반복하고, 확장 집합의 다른 가상 머신에서 **CPUSTRES**를 시작한 다음, 5분 동안 기다립니다.

1. Azure Portal에서 **ExerciseRG** 리소스 그룹으로 이동하고, **ExerciseRG** 블레이드에서 **WebServerSS** 개체를 클릭하고, **WebServerSS** 블레이드에서 **인스턴스**를 클릭합니다. 확장 집합 내에 표시되는 가상 머신 인스턴스의 수와 상태를 확인합니다.

여기서는 두 개의 가상 머신이 포함된 가상 머신 확장 집합을 만들었습니다. 그런 다음, 확장 집합의 크기를 자동으로 확장하고 축소하는 규칙을 만들고, 해당 규칙을 자동 크기 조정 프로필에 추가했습니다.