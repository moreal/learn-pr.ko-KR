리소스를 얻을 수는 Vm 간에 요청을 분산 부하 분산 장치를 사용 하 여 대규모 가상 머신 하나 또는 여러 작은 Vm 중 하나를 사용 하 여 해야 합니다.

VM 풀은 이점이 유용한는를 추가 하거나 수요가 변경 될 때 Vm을 신속 하 게 제거할 수 있습니다. 장난감 회사 시나리오에서는이 전략은 예기치 않은 갑작스러운 수요 증가 처리 하는 데 유용 것입니다. 수요 증가 하 고 필요 시 정상으로 반환 될 때 제거 하는 경우 풀에 Vm을 추가할 수 있습니다. 풀에서는 중복; 하나의 VM에 실패 하면 다른 서비스의 중단 없이 요청을 처리 하도록 계속 수 있습니다.

이 섹션에서는 확장 집합을 사용 하 여 여러 Vm을 프로 비전 하는 방법과 자동으로 추가 하 고 변경 요청에 대 한 응답에서 인스턴스를 제거 하는 방법을 표시 됩니다. 

## <a name="what-is-horizontal-scaling"></a>수평적 크기 조정 하는 것이 무엇입니까?

*수평적 크기 조정* 추가 또는 사용 가능한 리소스의 크기를 조정 하려면 풀에서 가상 머신을 제거 하는 프로세스입니다. 컴퓨터 추가 라고 _규모 확장_, 컴퓨터 제거 라고 _규모 감축은_. 부하 분산 장치 또는 게이트웨이 풀의 Vm 간에 요청을 분산 시킬를 수평적 확장을 사용 하는 솔루션에 포함 됩니다. 다음 그림에서는 가상 컴퓨터 인스턴스 수를 변경 하는 예를 보여 줍니다.

![요청 및 리소스의 크기 조정 비용을 줄이기 위해 처리 하는 리소스 확장을 보여 주는 예시입니다.](../media/4-ScaleInOut.png)

이 기술은 여러 동일한 서버에서 실행할 수 있는 응용 프로그램에 가장 적합 합니다. 예를 들어, 웹 서버 및 여러 Vm에서 웹 페이지를 복제할 수 있으며 요청을 수신 하는 서버에 관계 없이 동일한 응답을 모두 제공 합니다. 반면에 백 엔드 데이터베이스를 실행 하는 VM 아니므로 적합 한 후보가 복사본을 동기화 하려면 약간의 노력은 필요 데이터베이스의 여러 복사본을 실행 합니다.

## <a name="what-is-a-scale-set"></a>확장 설정 되어 있습니까?

A *확장 집합* 동일한 가상 머신, 부하 분산 장치 또는 요청을 배포 하는 게이트웨이 풀 이며 선택적 Vm 추가 하거나 풀에서 제거 시기를 제어 하는 규칙 집합입니다. 여기서 "동일" 있음을 나타내고 각 VM 집합에 동일한 이미지를 사용 하 여 만들어집니다 동일한 크기.

약간의 유연성이 필요한 소프트웨어를 사용 하 여 새 VM이 구성 하는 방법에 있습니다. 기본 OS에 대 한 미리 정의 된 이미지로 시작를 다음 스크립트를 사용 하 여 설치 하거나 운영 체제 설정 되 면 자동으로 파일을 복사 합니다. 또는 운영 체제와 이미 설치 된 응용 프로그램 소프트웨어를 사용 하 여 사용자 지정 가상 머신 이미지를 만들 수 있습니다.

## <a name="how-to-distribute-requests"></a>요청을 분산 하는 방법

확장 집합의 VM 인스턴스에 요청을 분산 하는 부하 분산 장치 또는 응용 프로그램 게이트웨이 사용할 수 있습니다.

Azure load balancer는 OSI 계층 4 (TCP 및 UDP)에서 작동 하 고 원본 IP 주소 및 대상 IP 주소와 포트 조합 된 포트에 따라 트래픽을 라우팅합니다. 선호도 경우 클라이언트 세션 간에 일관성을 제공 하려면 동일한 대상 서버에서 동일한 원본 IP 주소는 트래픽이 라우팅되는 위치를 제공할 수 있습니다. 부하 분산 장치에는 서버 인스턴스의 가용성을 결정 하는 상태 프로브 메커니즘을 있습니다. 가상 컴퓨터 상태 프로브에 응답 하지 않게 되 면 부하 분산 장치는 해당 컴퓨터에 대 한 새 연결을 라우팅 방지 됩니다.

Application gateway는 OSI 계층 7 (응용 프로그램 계층)에서 작동합니다. 예를 들어, Vm에 웹 서버를 실행 하는 경우 게이트웨이 라우팅을 수행 요청 된 URL을 사용할 수 있습니다. 즉, 사용 하 여 요청을 전달할 수 있습니다 `*/customers*` 하나의 풀 서버 및 사용 하 여 요청 URL에 `*/partners*` 다른 풀의 url입니다. 응용 프로그램 게이트웨이에 HTTP 및 HTTPS 간의 리디렉션으로, 암호화, 가상 머신 및 규칙을 사용 하 여 알려진된 웹을 검색 하는 웹 응용 프로그램 방화벽 (WAF)의 처리 요구 사항을 줄이기 위해 Secure Sockets Layer (SSL) 종료 제공할 수도 있습니다. 악용 하 고 이러한 요청 웹 서버에 도달 하지 않도록 설정 합니다.

## <a name="what-is-autoscaling"></a>자동 크기 조정 이란?

_자동 크기 조정_ 규칙 집합에 기반 하는 프로세스를 자동으로 확대 또는 축소 합니다. 컴퓨터 부하 또는 일정으로 규칙을 트리거할 수 있습니다. 다음 그림에서는 자동 크기 조정 기능 로드를 처리 하려면 인스턴스를 관리 하는 방법을 보여 줍니다.

![자동 크기 조정 가상 머신의 풀의 CPU 수준을 모니터링 하 고 CPU 사용률이 임계값을 초과 하는 경우 인스턴스를 추가 하는 방법을 보여 주는 예시입니다.](../media/4-autoscale.png)

확장 집합 자동 크기 조정을 사용할 수 있도록, 자동 크기 조정 프로필을 만들어야 합니다. 프로필 집합 및 크기 조정 규칙에 대 한 VM 인스턴스의 최소 및 최대 수를 정의합니다. 자동 크기 조정 규칙에는 다음 요소를 포함할:

* 메트릭 원본-정보 또는 자동 크기 조정 규칙을 트리거하는 데이터의 원본입니다. 디스크 유형에는 다음 네 가지 옵션이 있습니다.
  * *현재 확장 집합* 추가 에이전트가 필요 하지 않은 호스트 기반 메트릭을 제공 합니다.
  * *Storage 계정*. Azure 진단 확장을 Azure Storage 성능 메트릭을 씁니다. 이러한 메트릭은 자동 크기 조정 규칙 트리거 하는 데 사용 됩니다.
  * *Azure Service Bus 큐* 자동 크기 조정을 트리거하 기반 응용 프로그램 또는 기타 Azure Service Bus 메시지를 지정할 수 있습니다.
  * *Azure Application Insights* 확장 응용 프로그램에서 직접 스트림 메트릭 데이터 집합에서 실행 중인 응용 프로그램에서 설치 해야 하는 계측 패키지를 사용 합니다.
* 규칙 조건-이 파일은 자동 크기 조정 규칙을 트리거하는 데 사용할 특정 메트릭입니다. 호스트 기반 메트릭을 사용 하는 경우 CPU 사용량, 네트워크 트래픽 양, 디스크 작업 또는 CPU 크레딧 같은 측면에 포함할 수 있습니다. 예를 들어, 초당 디스크 쓰기 작업 임계값을 초과 하는 경우 규모 확장 하는 규칙을 구성할 수 있습니다. Application Insights를 Azure 진단 확장을 사용 하 여 규칙을 트리거하는 데 사용할 수 있는 모든 측정값을 사용할 수 있습니다 하지만 적절 한 에이전트를 구성 해야 합니다.
* 집계 유형-이 메트릭 데이터를 측정 하려는 방법을 지정 하 고 다음 옵션 중 하나:
  * 평균
  * 최소
  * 최대
  * 합계
  * 마지막
  * 개수
* 연산자-메트릭 규칙 작업 트리거를 정의 된 임계값을 달라 야 하는 방법을 나타냅니다. 이 규칙은 규모를 확장 하거나 인지를 식별 하는 경우에 특히 중요 합니다. 연산자를 사용할 수 있습니다.
  * 초과
  * 다음보다 크거나 같음
  * 다음보다 적음
  * 다음보다 작거나 같음
  * 다음과 같음
  * 다음과 같지 않음
* 작업-규칙이 트리거될 때 인스턴스 수 변화를 결정 합니다. 다음 작업을 사용할 수 있습니다.
  * *기준으로 개수 늘이기* 가상 컴퓨터의 고정된 된 수입니다.
  * *기준으로 백분율 늘이기* 기존 인스턴스의 백분율입니다.
  * *다음으로 개수 늘리기* 특정 가상 컴퓨터 수입니다.
  * *기준으로 개수 줄이기* 가상 컴퓨터의 고정된 된 수입니다.
  * *기준으로 백분율 줄이기* 기존 인스턴스의 백분율입니다.
  * *다음으로 개수 줄이기* 특정 가상 컴퓨터 수입니다.

또한 일정에 따라 트리거되는 자동 크기 조정 규칙을 만들 수 있습니다. 예를 들어, 수요를 높은 알고 있는 경우 아침에 확장 식당 수요가 일반적으로 감소 하면 규모 감축 하는 규칙을 정의할 수 있습니다.

## <a name="how-to-create-a-scale-set"></a>확장 집합을 만드는 방법

Azure portal, Azure PowerShell 또는 Azure CLI를 사용 하 여 설정 하는 확장을 만들 수 있습니다.

### <a name="portal"></a>포털

확장 집합을 만들려면 Azure portal을 사용 하는 경우에 가상 컴퓨터 시작 시 만들려는 VM 인스턴스의 수에 사용할 운영 체제 이미지를 지정 합니다. 또한 관리할 각 인스턴스에 대해 Azure load balancer를 사용할 것인지 또는 부하 분산을 위해 application gateway의 크기를 지정 합니다. 부하 분산 장치를 선택 하면 포털이 만들어집니다 기본 상태 프로브 포트 80에 대 한 합니다.

### <a name="powershell"></a>PowerShell

가상 머신 확장 집합을 만들어야 합니다 **New-azurermvmss** PowerShell cmdlet. 이 cmdlet은 새 확장 집합에 부하 분산 장치를 만들고 IP 주소 및 가상 네트워크 할당을 제어할 수 있습니다. Cmdlet에 설정 된 경우가 아니면 **New-azurermvmss** 다음 기본 설정을 사용 합니다.

* 두 개의 가상 머신 인스턴스 만들기
* Windows Server 2016 Datacenter 이미지를 사용 합니다.
* 표준 DS1_v2 가상 머신 크기를 사용 합니다.
* 부하 분산 장치 만들기
* Windows, Linux에 대 한 포트 22에 대 한 포트 3389 및 5985에 대해 부하 분산 장치 규칙 만들기

**새 AzureRmVmss** 부하 분산 장치의 상태 프로브를 만들지 않습니다. 사용 하 여이 만드는 것이 좋습니다 **Add-azurermloadbalancerprobeconfig** 확장 집합을 만든 후 합니다.

수평 확장 집합을 사용 하 여 여러 서버 응용 프로그램을 실행 하면 됩니다. 높은 처리 하는 여러 서버 수를 사용 하 여 로드 하 고 하면 서버가 충돌 하는 경우에 서비스를 계속 사용할 수 있습니다. 시스템이 예기치 않은 수요 변화에에서 자동으로 조정 하도록 자동 크기 조정에 확장 집합에 추가할 수 있습니다.