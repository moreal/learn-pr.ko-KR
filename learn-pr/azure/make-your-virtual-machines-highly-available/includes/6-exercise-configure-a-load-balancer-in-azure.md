온라인 뱅킹 아키텍처를 위한 주요 리소스를 만들었습니다. 이 연습에서는 부하 분산 규칙을 구성하여 설치를 완료합니다.

설정이 완료되면 풀에서 VM을 제거하고 이 VM에 클라이언트 요청이 더 이상 전송되지 않는지 확인하여 부하 분산 장치를 테스트합니다.

부하 분산 장치에서 백 엔드 풀을 정의하여 시작하겠습니다. 이렇게 하면 인바운드 요청을 라우팅하는 위치가 결정됩니다.

## <a name="create-a-backend-address-pool"></a>백 엔드 주소 풀 만들기

1. [Azure Portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)의 왼쪽 메뉴에서 **모든 리소스**를 선택합니다. 그런 다음, 리소스 목록에서 부하 분산 장치(**woodgrove-LB**)를 선택합니다.

1. **설정** > **백 엔드 풀**을 선택합니다. 아직 아무 것도 정의되어 있지 않습니다.

1. **추가**를 클릭하여 새 백 엔드 풀을 추가합니다.

    ![백 엔드 풀을 추가하는 방법을 보여주는 스크린샷입니다.](../media/6-backend-pools.png)

1. **백 엔드 풀 추가** 블레이드에서 다음 정보를 추가합니다.
    - 이름을 _woodgrove-BEP_로 지정합니다.
    - 풀을 **가용성 집합**에 연결했습니다.
    - 가용성 집합에서는 _woodgrove-AS_를 선택합니다.

1. **대상 네트워크 IP 구성 추가**를 클릭합니다.

1. **대상 가상 머신** 목록에서 _woodgrove-VM1_을 선택합니다.

1. VM에 대한 **네트워크 IP 구성** 목록에서 VM의 IP 주소 풀을 선택합니다.

1. 이러한 단계를 반복하여 _woodgrove-VM2_ 및 _woodgrove-VM3_를 백 엔드 풀에 추가합니다.

    ![선택한 세 가지 VM 모두를 사용하여 백 엔드 풀 추가 블레이드를 보여주는 스크린샷.](../media/6-add-backend-pool.png)

1. **확인**을 클릭하여 블레이드를 닫습니다.

부하 분산 장치 구성이 업데이트될 때까지 기다렸다가 연습을 진행합니다.

## <a name="create-a-health-probe-for-the-load-balancer"></a>부하 분산 장치에 대한 상태 프로브 만들기

다음으로, 포트 80을 통해 HTTP에 대한 상태 프로브를 추가합니다.

1. **woodgrove-LB** 블레이드의 **설정**에서 **상태 프로브**를 클릭합니다. 현재 비어있습니다.

1. 새 상태 프로브를 추가하려면 **추가**를 클릭합니다.

1. **상태 프로브 추가** 블레이드에서 다음 구성을 설정합니다.
    - **이름:** _woodgrove-HP_
    - **프로토콜:** _HTTP_
    - **포트:** _80_
    - **경로:** _/_
    - **간격:** _15_
    - **비정상 임계값:** _2_

1. **확인**을 클릭하여 변경 내용을 저장합니다.

부하 분산 장치 구성이 업데이트될 때까지 기다렸다가 연습을 진행합니다.

## <a name="create-a-load-balancer-rule"></a>부하 분산 장치 규칙 만들기

마지막으로 포트 80을 통해 백 엔드 풀을 상태 프로브와 연결하는 HTTP에 대한 부하 분산 규칙을 만듭니다.

1. **woodgrove-LB** 블레이드의 **설정**에서 **부하 분산 규칙**을 클릭합니다.

1. **추가**를 클릭하여 새 규칙을 추가합니다.

1. **부하 분산 규칙 추가** 블레이드에서 **이름**을 _woodgrove-HTTP-LBRule_로 설정합니다.

1. 다음 정보가 자동으로 입력되었는지 확인합니다.
    - IP 버전: **IPv4**
    - 프런트 엔드 IP 주소: **LoadBalancerFrontEnd**
    - 프로토콜: **TCP**
    - 포트: **80**
    - 백 엔드 포트: **80**
    - 백 엔드 풀: **woodgrove-BEP**
    - 상태 프로브: **woodgrove-HP**
    - 세션 지속성: **없음**
    - 유휴 제한 시간: **4분**
    - 부동 IP: **사용 안 함**

1. **확인**을 클릭하여 규칙을 저장합니다.

부하 분산 장치 구성이 업데이트될 때까지 기다렸다가 연습을 진행합니다.

## <a name="test-the-load-balancer"></a>부하 분산 장치 테스트

1. 부하 분산 장치의 **개요** 페이지로 다시 전환하고 해당 페이지에서 **공용 IP 주소** 링크를 클릭하여 할당된 IP 주소를 가져옵니다. 또는 **모든 리소스**를 사용한 다음, 리소스 목록에서 **woodgrove-LB-ip**를 선택할 수 있습니다.

1. **개요** 블레이드에서 **IP 주소**를 선택하고 그 옆에 있는 **복사** 단추를 클릭합니다. 이 IP 주소는 부하 분산 장치에 대한 _공용_ IP 주소입니다.

    ![공용 IP 주소 개요 패널을 보여주는 스크린샷](../media/6-public-ip.png)

1. 새 브라우저 탭을 열고 IP 주소를 브라우저의 주소 표시줄에 붙여넣습니다. 서버의 이름을 확인하고 이 탭을 열어 둡니다.

1. Azure Portal의 왼쪽 메뉴에서 **모든 리소스**를 클릭합니다. 그런 다음, 리소스 목록에서 위에서 확인한 서버를 클릭합니다.

1. **개요** 블레이드에서 **중지**을 클릭한 다음, **예**를 클릭합니다.

1. VM이 중지될 때까지 기다린 다음, 3단계에서 본 탭으로 전환합니다. 페이지를 새로 고칩니다.

1. 이제 부하 분산 장치가 HTTP 요청을 다른 VM 중 하나로 보냅니다.

이 연습에서는 백 엔드 VM과 부하 분산 장치의 배포를 완료했습니다.
