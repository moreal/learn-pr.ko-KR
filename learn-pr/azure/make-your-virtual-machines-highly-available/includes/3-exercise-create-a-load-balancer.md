Woodgrove Bank에서 근무하면서 온라인 뱅킹 서비스를 시작하려고 합니다. 이 부문은 경쟁이 치열하므로 99.99% 이상의 서비스 가용성을 보장해야 합니다. 세 개의 가상 머신으로 구성된 풀이 포함된 Azure Load Balancer를 통해 이 목표를 달성할 수 있다고 결정했습니다.

이 연습에서는 Azure Portal을 사용하여 부하 분산 장치 및 가상 네트워크를 만듭니다. 이들 중 하나만 필요하므로 포털을 통해 이를 쉽게 만들 수 있습니다.

[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="create-a-public-load-balancer"></a>공용 부하 분산 장치 만들기

1. 샌드박스를 활성화한 동일한 계정을 사용하여 [Azure Portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)에 로그인합니다.

1. 사이드바에서 **리소스 만들기**를 클릭합니다.

1. **네트워킹** 섹션을 클릭한 다음, **Load Balancer**를 클릭합니다. 해당 선택이 항목에 표시되지 않으면 검색 상자를 사용할 수 있습니다.

    ![선택된 네트워킹 섹션 및 강조 표시된 부하 분산 장치를 사용하여 Azure Marketplace를 보여 주는 스크린샷](../media/3-azure-marketplace.png)

1. **부하 분산 장치 만들기** 블레이드에서 다음 정보를 입력하거나 선택합니다.
    - **이름:** _woodgrove-LB_
    - **유형:** _공용_
    - **SKU:** _기본_
    - **공용 IP 주소:** **새로 만들기**를 선택합니다. 텍스트 상자에 _woodgrove-LB-ip_를 입력합니다. 할당을 _동적_으로 유지합니다.
    - **구독:** 선택된 _컨시어지 구독_이 이미 있어야 합니다.
    - **리소스 그룹:** **기존 리소스 그룹 사용**을 선택하고 _<rgn>[샌드박스 리소스 그룹 이름]</rgn>_ 을 선택합니다.
    - **위치:** 다음 목록에서 사용자에게 가까운 지역을 선택합니다.

    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

    ![새 Load Balancer 만들기 화면을 보여 주는 스크린샷](../media/3-create-load-balancer.png)

1. **만들기**를 클릭합니다.

부하 분산 장치 리소스를 만들고 배포하는 동안 백 엔드 서브넷에 사용할 Azure Virtual Network를 만들어보겠습니다.

## <a name="create-a-virtual-network"></a>가상 네트워크 만들기

1. 왼쪽 메뉴에서 **리소스 만들기**를 클릭합니다. **새로 만들기** 블레이드에서 **네트워킹** 및 **가상 네트워크**를 차례로 클릭합니다.

    ![선택된 네트워킹 섹션 및 강조 표시된 부하 분산 장치를 사용하여 Azure Marketplace를 보여 주는 스크린샷](../media/3-azure-marketplace-2.png)

1. **가상 네트워크 만들기** 블레이드에서 다음 정보를 입력하거나 선택합니다.
    - **이름:** _woodgrove-VNET_
    - **주소 공간:** _172.20.0.0/16_
    - **구독:** 선택된 _컨시어지 구독_이 이미 있어야 합니다.
    - **리소스 그룹:** 목록에서 기존 _<rgn>[리소스 그룹 이름]</rgn>_ 리소스 그룹을 선택합니다.
    - **서브넷 이름:** _backendSubnet_
    - **서브넷 주소 범위:** _172.20.0.0/24_
    - **DDoS 보호:** _기본_
    - **서비스 엔드포인트:** _사용 안 함_

    ![새 Load Balancer 만들기 화면을 보여 주는 스크린샷](../media/3-create-vnet.png)

1. **만들기**를 클릭합니다.

가상 네트워크를 배포하는 동안 네트워크 보안 그룹을 하나 더 만들어 보겠습니다.

## <a name="create-and-configure-a-network-security-group"></a>네트워크 보안 그룹 만들기 및 구성

1. **리소스 만들기** 클릭

1. **네트워킹** 그룹을 선택하고 **네트워크 보안 그룹** 항목을 클릭합니다.

    ![선택된 네트워킹 섹션 및 강조 표시된 네트워크 보안 그룹을 사용하여 Azure Marketplace를 보여 주는 스크린샷](../media/3-azure-marketplace-3.png)


1. 보안 그룹의 이름을 **woodgrove-NSG**로 지정하고 Azure 샌드박스 리소스 그룹에 넣습니다.

1. 보안 그룹이 Azure Load Balancer와 같은 위치에 있는지 확인합니다.

    ![네트워크 보안 그룹 만들기 화면을 보여 주는 스크린샷](../media/3-create-nsg.png)

1. **만들기**를 클릭합니다.

부하 분산 장치, 가상 네트워크 및 NSG이 배포될 때까지 대기합니다. 그러면 네트워크 보안을 구성할 수 있습니다.

## <a name="configure-the-network-security-group"></a>NSG(네트워크 보안 그룹) 구성

1. Azure Portal의 맨 위에 있는 검색 표시줄을 통해 또는 배포 알림에서 새 네트워크 보안 그룹을 선택합니다.

    ![알림 패널에서 배포 성공을 보여 주는 스크린샷](../media/3-deployment-success.png)

1. **설정** > **인바운드 보안 규칙** 섹션을 선택합니다. 항상 적용되는 세 개의 미리 정의된 규칙이 있습니다. 이러한 규칙은 다음과 같습니다.
    - **AllowVnetInbound** - 가상 네트워크에서 모든 내부 트래픽 흐름을 허용합니다. 이 규칙은 상호 통신을 위해 네트워크를 공유하는 VM을 허용합니다.
    - **AllowAzureLoadBalancerInBound** - 서비스가 활성화돼 있는지 여부를 확인하려면 부하 분산 장치가 네트워크에서 서비스를 "ping"하도록 허용합니다.
    - **DenyAllInbound** - 다른 모든 트래픽을 거부합니다.

    **DenyAllInbound** 규칙은 높은 우선 순위 규칙이 없는 모든 인바운드 트래픽이 차단되는지 확인하므로 특히 중요합니다. 그래서 웹 서버에 대한 HTTP(80) 트래픽을 허용하는 새 규칙을 추가해야 합니다.

    > [!NOTE]
    > NSG 규칙에서 우선 순위는 0 - 65500까지 이동하며 규칙은 순서대로 평가됩니다. 처음으로 일치하는 규칙이 의사 결정권자가 됩니다. 항상 규칙을 약 1000부터 시작하여 상당히 낮게 배치하려 하므로 해당 규칙은 미리 정의된 규칙에 대해 우선권이 있습니다.

1. **추가**를 클릭하여 새 규칙을 추가합니다.

    ![추가 단추가 강조 표시된 인바운드 네트워크 보안 규칙을 보여주는 스크린샷](../media/3-inbound-security-rules.png)

1. "기본" 보기로 전환하려면 맨 위의 **기본** 단추를 클릭합니다.

1. 새 규칙에 대한 세부 정보를 입력합니다.
    - **서비스**에 대한 _HTTP_를 설정합니다.
    - **우선 순위**를 _1000_으로 설정합니다.
    - 규칙의 이름을 지정합니다(또는 기본값을 그대로 둡니다).

    ![HTTP 세부 정보를 사용하여 입력된 인바운드 보안 규칙 추가 대화 상자를 보여 주는 스크린샷](../media/3-add-inbound-rule.png)

1. **추가**를 클릭하여 규칙을 추가합니다.

    ![NSG 규칙 목록에서 새로 추가된 HTTP 규칙을 보여 주는 스크린샷](../media/3-new-added-rule.png)

## <a name="apply-the-network-security-group-to-the-vnet"></a>네트워크 보안 그룹을 VNet에 적용

다음으로, 가상 네트워크에 이 NSG를 적용해 보겠습니다.

1. 가상 네트워크를 발견하면 맨 위의 검색 상자를 사용할 수 있습니다. 이 가상 네트워크는 **woodgrove-VNET**이라고 합니다.

1. **설정** > **서브넷**을 선택하여 정의된 서브넷으로 이동합니다.

1. **backendSubnet** 항목을 클릭하여 속성을 엽니다.

    ![서브넷의 서브넷 영역에서 backendSubnet 항목을 보여 주는 스크린샷](../media/3-subnets.png)

1. **네트워크 보안 그룹**에서 “없음” 항목을 클릭

    ![backendSubnet의 빈 네트워크 보안을 보여 주는 스크린샷](../media/3-add-network-security-group.png)

1. **woodgrove-NSG**를 선택하여 이 VNET에 추가합니다.

1. **저장** 을 클릭하여 변경 내용을 적용합니다.

이제 네트워크 준비됐으므로 이 네트워크에 위치할 일부 가상 머신을 만들어 보겠습니다.