온라인 bank 아키텍처에 대 한 주요 리소스를 이미 만들었습니다. 이 연습에서는 보안 설정을 구성, 백 엔드 주소 풀, 상태 프로브 규칙 및 부하 분산 규칙에서 설치를 완료 합니다. 설치가 완료 되 면 풀에서 VM을 제거 하 고 클라이언트 요청은이 VM에 더 이상 보냈음을 확인 하 여 부하 분산 장치를 테스트 합니다.

## <a name="inbound-rules"></a>인바운드 규칙

포트 80을 사용 하는 인바운드 HTTP 연결을 허용 하는 인바운드 보안 규칙을 만듭니다.

1. 에 [Azure portal](https://portal.azure.com/?azure-portal=true), 왼쪽된 메뉴에서 클릭 **모든 리소스**합니다. 리소스 목록에서 클릭 **woodgrove NSG**합니다.

1. 에 **woodgrove-NSG** 블레이드 아래에 있는 **설정**, 클릭 **인바운드 보안 규칙**를 클릭 하 고 **추가**합니다.

1. 에 **인바운드 보안 규칙 추가** 블레이드에서 다음 정보를 입력 합니다.
    - 원본: **서비스 태그**
    - 원본 서비스 태그: **인터넷**
    - 원본 포트 범위: **\***
    - 대상: **모든**
    - 대상 포트 범위: **80**
    - 프로토콜: **TCP**
    - 작업: **허용**
    - 우선 순위: **100**
    - 이름: **woodgrove HTTP 규칙**

1. **추가**를 클릭합니다.

포트 3389를 사용 하는 인바운드 RDP 연결을 허용 하는 인바운드 보안 규칙을 만듭니다.

1. 에 **woodgrove-NSG-인바운드 보안 규칙** 블레이드에서 클릭 **추가**합니다.

1. 에 **인바운드 보안 규칙 추가** 블레이드에서 다음 정보를 입력 합니다.
    - 원본: **서비스 태그**
    - 원본 서비스 태그: **인터넷**
    - 원본 포트 범위: **\***
    - 대상: **모든**
    - 대상 포트 범위: **3389**
    - 프로토콜: **TCP**
    - 작업: **허용**
    - 우선 순위: **200**
    - 이름: **woodgrove RDP 규칙**

1. **추가**를 클릭합니다.

## <a name="prepare-a-script-to-install-and-configure-iis-on-the-vms"></a>설치 하 고 Vm에 IIS를 구성 하는 스크립트를 준비 합니다.

1. 다음 PowerShell 명령을 텍스트 편집기에 복사 합니다.

    ```powershell
    # install IIS server role
    Install-WindowsFeature -name Web-Server -IncludeManagementTools

    # remove default htm file
    remove-item  C:\inetpub\wwwroot\iisstart.htm

    # Add a new htm file that displays server name
    Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Web page from <b>" + $env:computername + "</b>")
    ```

1. 파일을 로컬로 **ConfigureIIS.ps1**합니다.

### <a name="install-and-configure-iis-on-vms"></a>설치 하 고 Vm에서 IIS를 구성 합니다.

1. Azure portal의 왼쪽된 메뉴에서 클릭 **모든 리소스**합니다. 리소스 목록에서 클릭 **woodgrove-s v r 01**합니다.

1. 개요 페이지에서 클릭 **Connect**합니다.

1. 에 **가상 컴퓨터에 연결** 블레이드에서 클릭 **RDP 파일 다운로드**합니다. 팝업에서 클릭 **열려**합니다.

1. **원격 데스크톱 연결** 창에서 **연결**을 클릭합니다.

1. 에 **Windows 보안** 대화 상자에서 클릭 **더 많은 선택 사항**를 클릭 하 고 **다른 계정을 사용 하 여**.

1. 에 **Windows 보안** 대화 상자에서 Vm을 프로 비전 할 때 사용한 자격 증명을 입력 한 다음 클릭 **확인**합니다.

1. 표시 되 면을 **원격 데스크톱 연결** 인증서 경고를 클릭 **예**합니다.

1. 로컬 컴퓨터에서 스크립트를 포함 하는 폴더를 엽니다.

1. 복사본 **ConfigureIIS.ps1** 클립보드에 있습니다.

1. RDP 세션으로 전환 합니다. 그런 다음 Windows 탐색기를 열고 붙여 **ConfigureIIS.ps1** 하 **c:\\**합니다.

1. RDP 세션에서 클릭 **시작**를 연 다음 **Windows PowerShell**합니다.

1. PowerShell 프롬프트에서 다음 명령을 입력 한 다음 **입력:**

    ```powershell
    cd \
    ```

1. PowerShell 프롬프트에서 다음 명령을 입력 한 다음 **입력:**

    ```powershell
    .\ConfigureIIS.ps1
    ```

1. RDP 연결을 닫습니다.

1. 1-13 단계를 반복 **woodgrove SVR02** 하 고 **woodgrove SVR03**합니다.

## <a name="create-a-back-end-address-pool"></a>백 엔드 주소 풀 만들기

다음으로 공용 부하 분산 장치의 백 엔드 주소 풀을 만들려면 포털을 사용 합니다.

1. Azure portal의 왼쪽된 메뉴에서 클릭 **모든 리소스**합니다. 리소스 목록에서 클릭 **woodgrove LB**합니다.

1. 에 **woodgrove LB** 블레이드 아래에 있는 **설정**, 클릭 **백 엔드 풀**를 클릭 하 고 **추가**합니다.

1. 에 **백 엔드 풀 추가** 블레이드에서 다음 정보를 추가 합니다.
    - 이름: **woodgrove BEP**
    - 에 연결 된: 선택 **가용성 집합**
    - 가용성 집합: **woodgrove-AS**

1. 클릭 **대상 네트워크 IP 구성 추가**합니다. 그런 다음 합니다 **대상 가상 머신의** 목록에서 **woodgrove-s v r 01**합니다. 에 **네트워크 IP 구성** 목록에서 VM의 IP 주소 풀을 선택 합니다.

1. 클릭 **대상 네트워크 IP 구성 추가**합니다. 그런 다음 합니다 **대상 가상 머신의** 목록에서 **woodgrove SVR02**, 및를 **네트워크 IP 구성** 목록에서 VM의 IP 주소 풀을 선택 합니다.

1. 클릭 **대상 네트워크 IP 구성 추가**합니다. 그런 다음 합니다 **대상 가상 머신의** 목록에서 **woodgrove SVR03**, 및를 **네트워크 IP 구성** 목록에서 VM의 IP 주소 풀을 선택 합니다.

1. 에 **백 엔드 풀 추가** 블레이드에서 클릭 **확인**합니다.

1. 연습을 진행 하기 전에 부하 분산 장치 구성이 업데이트 될 때까지 기다립니다.

## <a name="create-a-health-probe-for-the-load-balancer"></a>부하 분산 장치의 상태 프로브 만들기

다음으로 포트 80 통해 HTTP에 대 한 상태 프로브를 추가 합니다.

1. 에 **woodgrovelb** 블레이드 아래에 있는 **설정**, 클릭 **상태 프로브**를 클릭 하 고 **추가**합니다.

1. 에 **상태 프로브 추가** 블레이드에서 다음 정보를 추가 합니다.
    - 이름: **woodgrove-HP**
    - 프로토콜: **HTTP**
    - 포트: **80**
    - 경로: **/**
    - 간격: **15**
    - 비정상 임계값: **2**

1. 에 **상태 프로브 추가** 블레이드에서 클릭 **확인**합니다.

1. 연습을 진행 하기 전에 부하 분산 장치 구성이 업데이트 될 때까지 기다립니다.

## <a name="create-a-load-balancer-rule"></a>부하 분산 장치 규칙 만들기

마지막으로 상태 프로브를 사용 하 여 백 엔드 풀을 연결 하는 포트 80 통해 http 부하 분산 규칙을 만듭니다.

1. 에 **woodgrove LB** 블레이드 아래에 있는 **설정**, 클릭 **부하 분산 규칙**를 클릭 하 고 **추가**합니다.

1. 에 **부하 분산 규칙 추가** 블레이드는 **이름** 상자에 입력 **woodgrove-HTTP-LBRule**합니다. 그런 다음 다음 정보를 자동으로 입력 되어 있는지 확인 합니다.
    - IP 버전: **IPv4**
    - 프런트 엔드 IP 주소: **LoadBalancerFrontEnd**
    - 프로토콜: **TCP**
    - 포트: **80**
    - 백 엔드 포트: **80**
    - 백 엔드 풀: **woodgrove BEP**
    - 상태 프로브: **woodgrove-HP**
    - 세션 지 속성: **없음**
    - 유휴 시간 제한: **4 분**
    - 부동 IP: **사용 안 함**

1. 에 **부하 분산 규칙 추가** 블레이드에서 클릭 **확인**합니다.

1. 연습을 진행 하기 전에 부하 분산 장치 구성이 업데이트 될 때까지 기다립니다.

## <a name="test-the-load-balancer"></a>부하 분산 장치 테스트

1. Azure portal의 왼쪽된 메뉴에서 클릭 **모든 리소스**, 리소스 목록에서 클릭 하 고 **woodgrove-LB-ip**입니다.

1. 에 **개요** 블레이드에서 선택 합니다 **IP 주소**, 클릭 하 고는 **복사** 단추.

1. 새 브라우저 탭에서 IP 주소를 브라우저의 주소 표시줄에 붙여 넣습니다. 서버의 이름을 확인 하 고이 탭을 열어 둡니다.

1. Azure portal의 왼쪽된 메뉴에서 클릭 **모든 리소스**합니다. 그런 다음 리소스 목록에서 앞서 기록한 서버를 클릭 합니다.

1. 에 **개요** 블레이드에서 클릭 **중지**를 클릭 하 고 **예**합니다.

1. VM이 중지 될 때까지 기다린 다음 3 단계에서 본 탭으로 전환 합니다. 페이지를 새로 고칩니다.

1. 이제 부하 분산 장치에서 다른 Vm 중 하나에 HTTP 요청을 보냅니다.

이 연습에서는 백 엔드 Vm 및 부하 분산 장치 배포를 완료 합니다.
