이제 저장소 계정이 있으므로 보류되는 큐 작업을 수행하는 방법을 살펴보겠습니다.

큐에 액세스하려면 다음 세 가지 정보가 필요합니다.

 1. 저장소 계정 이름
 2. 큐 이름
 3. 권한 부여 토큰

이 정보는 큐와 통신하는 두 응용 프로그램(메시지를 추가하는 웹 프런트 엔드 및 메시지를 처리하는 중간 계층)에서 사용됩니다.

## <a name="queue-identity"></a>큐 ID

모든 큐에는 사용자가 만들 때 할당하는 이름이 있습니다. 이 이름은 저장소 계정 내에서 고유해야 하지만 저장소 계정 이름과 달리 전체적으로 고유해야 할 필요는 없습니다.

저장소 계정 이름과 큐 이름의 조합으로 큐를 고유하게 식별합니다.

## <a name="access-authorization"></a>액세스 권한 부여

큐에 대한 모든 요청은 인증되어야 하며, 선택할 수 있는 몇 개의 옵션이 제공됩니다.

| 권한 부여 유형 | 설명 |
|--------------------|-------------|
| **Azure Active Directory** | 역할 기반 인증을 사용하고 AAD 자격 증명을 기준으로 특정 클라이언트를 식별할 수 있습니다. |
| **공유 키** | **계정 키**라고도 하는 이 키는 저장소 계정에 연결된 암호화된 키 서명입니다. 모든 저장소 계정에는 액세스를 인증하기 위해 각 요청과 함께 전달될 수 있는 이러한 두 가지 키가 있습니다. 이 접근 방식을 사용하는 것은 루트 암호를 사용하는 것과 같습니다. 이 방법은 저장소 계정에 대한 _모든 권한_을 제공합니다. |
| **공유 액세스 서명** | SAS(공유 액세스 서명)는 저장소 계정의 개체에 대한 제한된 액세스 권한을 클라이언트에 부여하는 생성되는 URI입니다. 특정 리소스, 권한 및 범위에 대한 액세스를 특정 데이터 범위로 제한하여 일정 기간 후에 액세스 권한을 자동으로 해제할 수 있습니다.  |

> [!NOTE]
> 여기서는 계정 키 권한 부여가 큐 작업을 시작하는 가장 단순한 방법이므로 이를 사용하겠지만, 프로덕션 앱에서는 SAS(공유 액세스 서명) 또는 AAD(Azure Active Directory)를 사용하는 것이 좋습니다.

### <a name="retrieving-the-account-key"></a>계정 키 가져오기
 
계정 키는 Azure Portal에서 저장소 계정의 **설정 > 액세스 키** 섹션에서 사용하거나, 다음 명령줄을 통해 가져올 수 있습니다.

```azurecli
az storage account keys list ...
```

```powershell
Get-AzureRmStorageAccountKey ...
```

## <a name="accessing-queues"></a>큐에 액세스

REST API를 사용하여 큐에 액세스합니다. 이를 수행하려면 저장소 계정에 지정한 이름을 도메인 `queue.core.windows.net` 및 작업할 큐 경로와 결합한 URL을 사용합니다. 예: `http://<storage account>.queue.core.windows.net/<queue name>`. `Authorization` 헤더는 모든 요청에 포함되어야 합니다. 이 값은 세 가지 권한 부여 스타일 중 하나일 수 있습니다.

### <a name="using-the-azure-storage-client-library-for-net"></a>.NET용 Azure Storage 클라이언트 라이브러리 사용

.NET용 Azure Storage 클라이언트 라이브러리는 Microsoft에서 제공하는 라이브러리로, REST 요청을 작성하고 REST 응답을 구문 분석합니다. 이 라이브러리를 사용하면 작성해야 하는 코드 양이 크게 줄어듭니다. 클라이언트 라이브러리를 사용하여 액세스하려면 동일한 정보(저장소 계정 이름, 큐 이름 및 계정 키)가 필요하지만 이러한 정보가 다르게 구성됩니다.

클라이언트 라이브러리는 **연결 문자열**을 사용하여 연결을 설정합니다. 연결 문자열은 Azure Portal에 있는 저장소 계정의 **설정** 섹션 또는 Azure CLI 및 PowerShell을 통해 사용할 수 있습니다.

연결 문자열은 저장소 계정 이름과 계정 키를 결합하는 문자열로, 저장소 계정에 액세스하기 위해 응용 프로그램이 알고 있어야 합니다. 형식은 다음과 유사합니다.

```csharp
string connectionString = "DefaultEndpointsProtocol=https;AccountName=<your storage account name>;AccountKey=<your key>;EndpointSuffix=core.windows.net"
```

> [!WARNING]
> 이 연결 문자열에 대한 액세스 권한이 있는 사용자가 큐를 조작할 수 있으므로 이 문자열 값은 안전한 위치에 보관해야 합니다.

연결 문자열에는 큐 이름이 포함되지 않습니다. 큐에 대한 연결을 설정할 때 큐 이름이 코드에 제공됩니다.

Azure에서 연결 문자열을 가져온 후 새 응용 프로그램에서 사용하도록 설정하세요.