SQL Server 및 사용자 지정 응용 프로그램을 실행하는 Azure VM(Virtual Machines)에 저장된 데이터를 사용하여 사진 공유 사이트를 실행한다고 가정합니다. 다음 조정을 수행하려고 합니다.

- VM에서 디스크 캐시 설정을 변경해야 합니다.
- 캐싱을 사용으로 설정한 VM에 새 데이터 디스크를 추가하려고 합니다.

Azure Portal을 통해 이러한 변경 내용을 적용하기로 했습니다.

이 연습에서는 위에서 설명한 VM을 변경하는 방법을 살펴봅니다. 먼저 포털에 로그인하고 VM을 만듭니다.

## <a name="sign-in-to-the-azure-portal"></a>Azure Portal에 로그인
<!---TODO: Update for sandbox?--->

1. [Azure Portal](https://portal.azure.com/?azure-portal=true)에 로그인합니다.

## <a name="create-a-virtual-machine"></a>가상 머신 만들기

이 단계에서는 다음 속성을 사용하여 VM을 만들려고 합니다.

|속성  |값  |
|---------|---------|
|이미지     |   **Windows Server 2016 Datacenter**      |
|이름     |   **fotoshareVM**     |
|리소스 그룹     |   **fotoshare-rg**      |


1. 포털의 왼쪽 메뉴에서 **가상 머신**을 선택합니다.

1. 이제 **가상 머신** 화면의 왼쪽 위에 있는 **+ 추가**를 선택합니다. 이 작업은 만들기 프로세스를 시작합니다.

1. 사용 가능한 VM 이미지를 나열하는 [계산] 패널에서 검색 상자에 *Windows Server 2016 Datacenter*를 입력합니다.

1. 검색 결과에서 **Windows Server 2016 Datacenter**를 선택한 후 **만들기**를 선택하여 VM 만들기 프로세스를 시작합니다.

1. **기본 사항** 패널의 **이름** 상자에 **fotoshareVM**을 입력합니다.

1. **사용자 이름** 및 **암호** 상자에 이 서버의 관리자 계정 이름과 암호를 입력합니다.

1. **구독** 드롭다운에서 Azure 구독을 선택합니다.

1. **리소스 그룹**에서 **새로 만들기**를 선택하고 상자에 **fotoshare-rg**를 입력합니다.

1. **위치** 드롭다운 목록에서 인근 지역을 선택합니다.

작성 시 **기본 사항** 구성이 다음과 같이 표시될 수 있습니다.

![작성된 VM 기본 사항 구성의 스크린샷입니다.](../media-draft/vm-basics-settings.PNG)

1. **확인**을 선택하여 다음 단계로 이동합니다.

이제 VM의 크기를 선택한 후 배포를 시작해야 합니다.

> [!IMPORTANT]
> L 시리즈 및 B 시리즈 가상 머신에 대한 디스크 캐싱은 변경할 수 없습니다. 다른 크기를 선택하겠습니다.

1. **크기 선택** 섹션에서 **표준** SKU(예: **F1s**)를 선택하고 **선택**을 선택합니다.

1. **설정** 창을 아래로 스크롤하여 디스크 캐싱을 구성할 옵션이 없는지 확인합니다. 이 단계의 기본값을 그대로 사용하고 창의 맨 아래에서 **확인**을 선택합니다.

1. **만들기** 패널에서 요약을 검토한 후 **만들기**를 선택합니다.

1. VM 만들기는 시간이 어느 정도 걸릴 수 있습니다. VM이 배포될 때까지 기다렸다가 연습을 계속 진행합니다. 프로세스가 완료되면 알림 허브에 메시지가 표시됩니다.

> [!IMPORTANT]
> 다음 단원에서는 이 VM을 사용하므로 잠시 동안 유지합니다.

## <a name="view-os-disk-cache-status-in-the-portal"></a>포털에서 OS 디스크 캐시 상태 보기

VM이 배포되면 다음 단계를 사용하여 OS 디스크의 캐싱 상태를 확인할 수 있습니다.

1. 왼쪽 메뉴에서 **모든 리소스**를 클릭한 후 VM **fotoshareVM**을 선택합니다.

1. **가상 머신** 화면의 **설정** 아래에서 **디스크**를 선택합니다.

1. **디스크** 창에서 VM에는 하나의 OS 디스크가 있습니다. 캐시 유형은 현재 기본값 **읽기/쓰기**로 설정되어 있습니다.

![둘 다 읽기 전용 캐싱으로 설정된 OS 및 데이터 디스크의 스크린샷입니다.](../media-draft/os-disk-rw.PNG)

## <a name="change-the-cache-settings-of-the-os-disk-in-the-portal"></a>포털에서 OS 디스크의 캐시 설정 변경

1. **디스크** 창의 화면 왼쪽 위에 있는 **편집**을 선택합니다.

1. 드롭다운을 사용하여 OS 디스크의 **호스트 캐싱** 값을 **읽기 전용**으로 변경한 후 화면 왼쪽 위에서 **저장**을 선택합니다.

1. 이 업데이트는 시간이 오래 걸립니다. 그 이유는 Azure 디스크의 캐시 설정이 변경되면 대상 디스크를 분리하고 다시 연결하기 때문입니다. 운영 체제 디스크인 경우 VM도 다시 시작됩니다. 업데이트가 완료되면 다음 알림과 비슷한 메시지가 표시됩니다.

![캐시 설정 업데이트가 완료될 때 표시되는 알림의 예입니다.](../media-draft/vm-disk-update-complete.PNG)

4. 완료된 후 OS 디스크 캐시 유형이 **읽기 전용**으로 설정됩니다.

데이터 디스크 캐시 구성으로 이동하겠습니다. 디스크를 구성하려면 먼저 디스크를 만들어야 합니다.

## <a name="add-a-data-disk-to-the-vm-and-set-caching-type"></a>VM에 데이터 디스크 추가 및 캐싱 유형 설정

1. 포털에서 VM의 **디스크** 보기로 돌아가서 **데이터 디스크 추가**를 선택합니다. 필드가 비어 있을 수 없음을 알리는 오류가 **이름** 필드에 바로 나타납니다. 아직 데이터 디스크가 없으므로 만들어 보겠습니다.

1. **이름** 목록을 클릭하고 **디스크 만들기**를 클릭합니다.

1. **관리 디스크 만들기** 창의 **이름** 상자에 **fotosharesVM-data**를 입력합니다.

1. **리소스 그룹** 아래에서 **기존 항목 사용**을 선택하고 드롭다운 메뉴에서 **fotoshare-rg**를 선택합니다.

1. 화면 아래쪽에서 **만들기**를 클릭합니다.

1. 디스크가 만들어질 때까지 기다렸다가 계속 진행합니다.

1. 드롭다운을 사용하여 새 데이터 디스크의 **호스트 캐싱** 값을 **읽기 전용**으로 변경한 후 화면 왼쪽 위에서 **저장**을 선택합니다.

1. VM이 업데이트될 때까지 기다립니다. Azure가 이 설정을 변경하기 위해 데이터 디스크를 분리했다가 다시 연결하기 때문에 업데이트는 시간이 오래 걸립니다.

1. 완료된 후 데이터 디스크 캐시 유형이 **읽기 전용**으로 설정됩니다.

이 연습에서는 Azure Portal을 사용하여 새 VM에서 캐싱을 구성하고, 기존 디스크에서 캐시 설정을 변경하고, 새 데이터 디스크에서 캐싱을 구성했습니다. 다음 스크린샷은 최종 구성을 보여 줍니다. 

![둘 다 읽기 전용 캐싱으로 설정된 OS 및 데이터 디스크의 스크린샷입니다.](../media-draft/disks-final-config-portal.PNG)