유지하려는 온-프레미스 데이터 센터가 있지만 Azure에서 호스트된 VM(가상 머신)을 사용하여 급증한 트래픽을 오프로드하기 위해 Azure를 사용하려고 합니다. 기존 IP 주소 지정 스키마 및 네트워크 어플라이언스를 유지할 수 있는지를 알고 데이터 전송이 안전한지 확인해야 합니다.

## <a name="what-is-azure-virtual-networking"></a>Azure Virtual Networking이란?

**Azure Virtual Network**를 사용하면 가상 머신, 웹앱 및 데이터베이스와 Azure 리소스가 서로, 인터넷의 사용자 및 온-프레미스 클라이언트 컴퓨터와 통신할 수 있습니다. Azure 네트워크를 다른 Azure 리소스와 연결되는 리소스 집합으로 생각할 수 있습니다.

Azure Virtual Networks는 다음을 비롯한 주요 네트워킹 기능을 제공합니다.

- 격리 및 구분
- 인터넷 통신
- Azure 리소스 간 통신
- 온-프레미스 리소스와 통신
- 네트워크 트래픽 라우팅
- 네트워크 트래픽 필터링
- 가상 네트워크 연결

### <a name="isolation-and-segmentation"></a>격리 및 구분

Azure를 사용하면 여러 격리된 가상 네트워크를 만들 수 있습니다. Virtual Network를 설정할 때 공용 또는 개인 IP 주소 범위를 사용하여 개인 IP(인터넷 프로토콜) 주소 공간을 정의합니다. 그런 다음, 서브넷에 해당 IP 주소 공간을 분할하고, 각 명명된 서브넷에 정의된 주소 공간의 일부를 할당할 수 있습니다.

이름 확인을 위해 Azure의 기본 제공 이름 확인 서비스를 사용하거나 내부 또는 외부 DNS(Domain Name System) 서버를 사용하도록 가상 네트워크를 구성할 수 있습니다.

### <a name="internet-communications"></a>인터넷 통신

Azure의 VM은 기본적으로 인터넷을 연결할 수 있습니다. 그러나 Azure CLI(명령줄 인터페이스), RDP(원격 데스크톱 프로토콜) 또는 SSH(보안 셸)를 사용하여 해당 VM을 연결하고 제어해야 합니다. 공용 IP 주소 또는 공용 부하 분산 장치를 정의하여 들어오는 통신을 사용하도록 설정할 수 있습니다.

### <a name="communicate-between-azure-resources"></a>Azure 리소스 간 통신

Azure 리소스를 사용하여 서로 안전하게 통신할 수 있도록 하려고 합니다. 다음 두 가지 방법 중 하나를 수행할 수 있습니다.

- **가상 네트워크** 가상 네트워크는 VM뿐만 아니라 App Service Environments, Azure Kubernetes Service 및 Azure Virtual Machine Scale Sets 등 다른 Azure 리소스도 연결할 수 있습니다.

- **서비스 엔드포인트** 서비스 엔드포인트를 사용하여 Azure SQL Databases 및 저장소 계정과 같은 다른 Azure 리소스 형식에 연결할 수 있습니다. 이 방법을 사용하면 가상 네트워크에 여러 Azure 리소스를 연결하여 보안을 개선하고 리소스 간에 최적의 라우팅을 제공할 수 있습니다.

### <a name="communicate-with-on-premises-resources"></a>온-프레미스 리소스와 통신

Azure Virtual Networks를 사용하면 온-프레미스 환경 및 Azure 구독 내에서 리소스를 함께 연결하여 실제로 로컬 및 클라우드 환경에 걸쳐 있는 네트워크를 만들 수 있습니다. 이 연결을 수행하는 세 가지 메커니즘이 있습니다.

- **지점 및 사이트 간 VPN** 이 방법은 반대 방향으로 작동한다는 점을 제외하고 조직 외부의 컴퓨터를 회사 네트워크에 다시 만드는 점에서 VPN 연결과 비슷합니다. 이 경우에 클라이언트 컴퓨터는 Azure에 대한 암호화된 VPN 연결을 시작하여 Azure Virtual Network에 해당 컴퓨터를 연결합니다.

- **사이트 간 VPN** 사이트 간 VPN은 온-프레미스 VPN 장치 또는 게이트웨이를 가상 네트워크의 Azure VPN Gateway에 연결합니다. 실제로 Azure의 장치는 로컬 네트워크에 있는 것으로 나타날 수 있습니다. 연결은 인터넷을 통해 암호화되고 작동합니다.

- **Azure ExpressRoute** 큰 대역폭과 더 높은 수준의 보안이 필요한 환경의 경우 Azure ExpressRoute를 사용하는 것이 좋습니다. Azure ExpressRoute는 Azure에 대한 전용 개인 연결을 제공합니다. 이 연결은 인터넷을 통해 이동하지 않습니다.

### <a name="route-network-traffic"></a>네트워크 트래픽 라우팅

Azure에서는 기본적으로 연결된 가상 네트워크의 서브넷, 온-프레미스 네트워크 및 인터넷 간에 트래픽을 라우팅합니다. 그러나 라우팅을 제어하고 다음과 같이 해당 설정을 재정의할 수 있습니다.

- **경로 테이블** 경로 테이블을 사용하면 트래픽이 전달되어야 하는 방법에 대한 규칙을 정의할 수 있습니다. 서브넷 간에 패킷이 라우팅되는 방법을 제어하는 사용자 지정 경로 테이블을 만들 수 있습니다.

- **Border Gateway Protocol** BGP(Border Gateway Protocol)는 Azure VPN Gateway 또는 ExpressRoute로 작업하여 온-프레미스 BGP 경로를 Azure Virtual Networks로 전파합니다.

### <a name="filter-network-traffic"></a>네트워크 트래픽 필터링

Azure Virtual Networks를 사용하면 다음 방법 중 하나를 사용하여 서브넷 간에 트래픽을 필터링할 수 있습니다.

- **네트워크 보안 그룹** 네트워크 보안 그룹은 여러 인바운드 및 아웃바운드 보안 규칙이 포함될 수 있는 Azure 리소스입니다. 원본 및 대상 IP 주소, 포트 및 프로토콜 등의 요인에 따라 트래픽을 허용하거나 차단하도록 이러한 규칙을 정의할 수 있습니다.

- **네트워크 가상 어플라이언스** 네트워크 가상 어플라이언스는 강화된 네트워크 어플라이언스와 비교할 수 있는 특수 VM입니다. 네트워크 가상 어플라이언스는 방화벽을 실행하는 등 특정 네트워크 기능을 수행하거나 WAN 최적화를 수행합니다.

## <a name="connect-virtual-networks"></a>가상 네트워크 연결

가상 네트워크 _피어링_을 사용하여 가상 네트워크를 함께 연결할 수 있습니다. 피어링을 사용하면 각 가상 네트워크의 리소스가 서로 통신할 수 있습니다. 이러한 가상 네트워크는 별도 지역에 위치할 수 있으며 Azure를 통해 상호 연결된 글로벌 네트워크를 만들 수 있습니다.

## <a name="azure-virtual-network-settings"></a>Azure Virtual Network 설정

Azure Portal, 로컬 컴퓨터의 Azure PowerShell 또는 Azure Cloud Shell을 사용하여 Azure Virtual Networks를 만들고 구성할 수 있습니다.

### <a name="create-a-virtual-network"></a>Virtual Network 만들기

Azure Virtual Network를 만들 때 다양한 기본 설정을 구성합니다. 여러 서브넷, DDoS(배포 서비스 거부) 보호 및 서비스 엔드포인트와 같은 고급 설정을 구성하는 옵션도 있습니다.

![가상 네트워크 만들기](../media-draft/2-create-virtual-network.PNG)

기본 가상 네트워크에 대해 구성해야 하는 설정은 다음과 같습니다.

- **네트워크 이름** 이 이름은 구독에서 고유해야 하지만 전세계에서 고유할 필요는 없습니다. 기억하고 다른 가상 네트워크와 구분하기 쉬운 설명이 포함된 이름을 만듭니다.

- **주소 공간** 가상 네트워크를 설정할 때 CIDR(Classless Interdomain Routing) 형식으로 내부 주소 공간을 정의합니다. 이 주소 공간은 구독 내에서 고유해야 합니다. 따라서 예를 들어, 10.1.0.0/8 네트워크가 10.0.0.0/24와 겹치므로 하나의 가상 네트워크에 10.0.0.0/24 및 다른 가상 네트워크에 10.1.0.0/8이라는 주소 공간을 정의할 수 없습니다. 그러나 10.0.0.0/16 및 10.1.0.0/16 등을 지정할 수 있습니다. 
    > [!NOTE] 
    > 가상 네트워크를 만든 후에 주소 공간을 추가할 수 있습니다.

- **구독** 여러 구독을 선택할 수 있는 경우에만 적용합니다.

- **리소스 그룹** 다른 Azure 리소스와 마찬가지로 가상 네트워크는 리소스 그룹에 존재해야 합니다. 기존 리소스 그룹을 선택하거나 새 리소스 그룹을 만들 수 있습니다.
- **위치** 가상 네트워크를 만들려는 위치를 선택합니다.

- **서브넷** 각 가상 네트워크 주소 범위 내에서 가상 네트워크의 주소 공간을 분할하는 하나 이상의 서브넷을 만들 수 있습니다. 서브넷 간의 라우팅은 기본 트래픽 경로에 따라 다릅니다. 또는 사용자 지정 경로를 정의할 수 있습니다. 또는 모든 가상 네트워크의 주소 범위를 포함하는 하나의 서브넷을 정의할 수 있습니다.

    > [!NOTE]
    >서브넷 이름은 영문, 숫자, 밑줄, 마침표 또는 하이픈만 포함할 수 있습니다. 단 영문 또는 숫자로 시작하고 영문, 숫자 또는 밑줄로 끝나야 합니다.

- **DDoS Protection** 기본 또는 표준 DDoS Protection 중 하나를 선택할 수 있습니다. 표준 DDoS Protection은 프리미엄 서비스입니다. 표준 DDoS Protection에 대한 자세한 내용입니다.

- **서비스 엔드포인트** 여기서는 서비스 엔드포인트를 설정한 다음, 사용할 Azure 서비스 엔드포인트 목록에서 선택합니다. 옵션에는 Azure Cosmos DB, Azure Service Bus, Key Vault 등이 포함됩니다.

이러한 설정을 구성한 경우 **만들기** 단추를 클릭합니다.

### <a name="define-additional-settings"></a>추가 설정 정의

가상 네트워크를 만든 후에 추가 설정을 정의할 수 있습니다. 내용은 다음과 같습니다.

- **네트워크 보안 그룹** 네트워크 보안 그룹에는 가상 네트워크 서브넷 및 네트워크 인터페이스 내외로 이동할 수 있는 네트워크 트래픽 형식을 필터링할 수 있는 보안 규칙이 있습니다. 네트워크 보안 그룹을 별도로 만든 다음, Virtual Network와 연결합니다.

- **경로 테이블** Azure는 Azure Virtual Network 내의 각 서브넷에 대한 경로 테이블을 자동으로 만들고 시스템 기본 경로를 테이블에 추가합니다. 그러나 사용자 지정 경로 테이블을 추가하여 가상 네트워크 간에 트래픽을 수정할 수 있습니다.

서비스 엔드포인트를 수정할 수도 있습니다.

![Virtual Network 설정](../media-draft/2-virtual-network-additional-settings.PNG)

### <a name="configure-virtual-networks"></a>Virtual Networks 구성

가상 네트워크를 만들면 Azure Portal에서 Virtual Networks 블레이드에서 추가 설정을 변경할 수 있습니다. 또는 Cloud Shell에서 PowerShell 명령 또는 CLI 명령을 사용하여 변경할 수 있습니다.

![Virtual Network 구성](../media-draft/2-configure-virtual-network.PNG)

그런 다음, 추가 하위 블레이드에서 설정을 검토하고 변경할 수 있습니다. 이러한 설정에는 다음이 포함됩니다.

- 주소 공간 - 초기 정의에 추가 주소 공백을 추가할 수 있습니다.

- 연결된 장치 - 머신을 연결할 Us2 가상 네트워크

- 서브넷 - 서브넷 추가

- 피어링 - 피어링 배열에서 가상 네트워크 연결

가상 네트워크를 모니터링하고 문제를 해결하거나 자동화 스크립트를 만들어서 현재 가상 네트워크를 생성할 수 있습니다.

## <a name="summary"></a>요약

가상 네트워크는 Azure에서 엔터티를 연결하기 위한 강력하고 구성 가능한 메커니즘입니다. Azure 리소스를 서로 또는 온-프레미스 리소스에 연결할 수 있습니다. 네트워크 트래픽을 격리하고, 필터링하고, 라우팅할 수 있고, Azure를 사용하면 필요에 따라 보안을 강화할 수 있습니다.