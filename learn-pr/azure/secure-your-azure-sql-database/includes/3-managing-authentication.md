웹 사이트 및 데이터베이스에 대 한 액세스를 얻은 공격자를 실행 하는 경우를 가정해 봅니다. 공격자가 공격에서 dbo 계정에 대 한 액세스 권한을 얻은 및 데이터베이스에서 모든 작업을 수행할 수 있습니다. Dbo 계정을 액세스 및 메타 데이터와 같은 정보를 조작 하 고 모든 수준의 액세스를 수행 합니다.

공격자가 일반 사용자 계정에 액세스할 수만 획득 하는 경우 다음 수만 액세스 테이블, 뷰, 저장된 프로시저 및 사용자 계정에 대해 정의 된 다른 개체입니다. 예를 들어 데이터베이스에 액세스 하는 웹 사이트를 SQL 주입 공격으로 인해 손상 된 경우 공격자가에서 수행할 수 제한 것입니다.

보안 위반에 문제가 발생 하더라도 위반의 영향을 줄일 수 있습니다. 사용자 계층에서 SQL Azure 데이터베이스에 대 한 액세스를 제한 하는 방법에 살펴보겠습니다.

## <a name="reduce-the-attack-surface-of-the-database"></a>데이터베이스의 공격 표면을 줄이기

보안 위반의 영향을 줄이려면 공격 노출 영역을 제한할 수 있습니다. Dbo 또는 관리자 계정을 사용 하 여 데이터베이스에 연결 하는 공격자가 데이터베이스에 대 한 액세스를 공격자가 데이터베이스에서 모든 작업을 수행 하는 액세스를 해야 합니다. 데이터베이스 메타 데이터를 쿼리하고 데이터를 사용할 수 있습니다 및/또는 중요 한 결정이 정보를 악용에 대 한 액세스 포함 될 수 있습니다.

제한 된 권한을 포함 하는 데이터베이스 사용자를 만들면 이러한 보안 위험을 방지 합니다. 용어 최소 권한 사용자 테이블, 뷰, 저장된 프로시저 및 해당 작업을 수행 하는 데 필요한 다른 엔터티는 액세스할 수 있어야 하는 대로 여기 사용 하겠습니다.

## <a name="create-a-database-user"></a>데이터베이스 사용자 만들기

축소 된 권한으로 사용자를 만들려면 데이터베이스 사용자를 만들고 데이터베이스를 사용 하 여 해당 사용자를 연결 합니다. SQL Server 사용자를 만들고 데이터베이스에 사용자 권한을 부여 해 보겠습니다.

> [!Note]
> 13 (13) SQL Server의 사용자 유형에 있습니다. 다른 유형의 데이터베이스 사용자를 만들어야 하는 경우 적절 한 링크를 사용 하 여 구문이 올바른지 확인 합니다. 참조 [데이터베이스 사용자를 만들려면](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-2017)합니다.

기본 방법은 데이터베이스 수준에서 사용자를 만들려고 하는 것입니다. 이 단계는 보호 하려는 데이터베이스의 경계 외부로 나가야 사용자 권한을 방지 합니다.

1. 먼저 데이터베이스를 선택 합니다.
2. 그런 후, 다음 쿼리를 사용 하 여 사용자를 만듭니다.

   ```sql
   CREATE USER MyWebAppUser WITH PASSWORD = '<YourSuperStrongPassword>';
   ```

   이전 쿼리는 사용자를 만듭니다 *MyWebUser*합니다. 기본적으로 사용자는 모든 테이블, 뷰 또는 저장된 프로시저에 대 한 액세스를 없습니다 됩니다.

3. 이제 같은 db_datareader 및 db_datawriter 역할을 추가 하 여 사용자에 대 한 적절 한 사용 권한을 만듭니다.

   Db_datareader 역할 데이터베이스 내의 모든 뷰와 사용자 테이블에 대 한 사용자 액세스를 허용 됩니다. 마찬가지로, db_datawriter 역할을 읽기, 쓰기, 업데이트에 대 한 사용자 액세스를 허용 합니다. 데이터베이스의 행을 삭제 합니다.

   ```sql
   ALTER ROLE db_datareader ADD MEMBER MyWebAppUser;
   ALTER ROLE db_datawriter ADD MEMBER MyWebAppUser;
   ```

DENY 연산자를 사용 하 여 데이터베이스 내 다른 요소에 대 한 사용자의 액세스를 거부할 수 있습니다. 여기 Customers 테이블에서 데이터를 선택 하는 기능 MyWebAppUser 사용자를 거부 하 고 있습니다.

```sql
DENY SELECT ON Customers TO MyWebAppUser;
```

또한 명시적으로 사용자 또는 역할에 권한을 부여 하려면 권한 부여를 사용할 수 있습니다.

```sql
GRANT SELECT ON Customers TO MyWebAppUser;
```

필요한 액세스 수준으로 사용자를 가져오기 위해 데이터베이스에서 작업을 구체화를 진행 합니다. 사용자가 아닌 데 필요한 최소 권한을 가진 역할을 만들 수 있으며 사용자 역할에 추가 키를 누릅니다.

여러 사용자가 동일한 권한이 있는 경우 해당 사용자 역할의 일부로 만들 수 있습니다. 사용자 들에 게 필요한 모든 액세스 권한이 부여 되거나 거부 된 후에 액세스를 해야 합니다.
공격자가 새로 만든된 사용자를 통해 데이터베이스에 대 한 액세스를 하는 경우만 참조를 동일한 데이터 및 사용자 작업을 실행 합니다. 크게 대 한 사용자 액세스를 잠그면 데이터베이스에서 공격 노출 영역이 줄어듭니다.
