<span data-ttu-id="9f0d3-101">솔루션 아키텍처를 다시 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-101">Let's look at our solution architecture again.</span></span>

![피드백 정렬 아키텍처의 개념적 다이어그램](../media/proposed-solution.PNG)

<span data-ttu-id="9f0d3-103">이 다이어그램의 오른쪽에 보이는 것처럼 세 개의 큐에 메시지를 보내려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-103">As you can see on the right side of this diagram, we want to send messages to three queues.</span></span> <span data-ttu-id="9f0d3-104">따라서 해당 연결을 함수의 출력 바인딩으로 정의하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-104">So, we'll define those connections as output bindings in our function.</span></span> <span data-ttu-id="9f0d3-105">이러한 바인딩은 **출력 바인딩** UI를 통해 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-105">We could create those bindings through the **Output binding** UI.</span></span> <span data-ttu-id="9f0d3-106">그러나 시간을 절약하기 위해 config 파일을 직접 편집하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-106">However, to save time, we'll edit the config file directly.</span></span>

## <a name="add-output-bindings-to-functionjson"></a><span data-ttu-id="9f0d3-107">function.json에 출력 바인딩 추가</span><span class="sxs-lookup"><span data-stu-id="9f0d3-107">Add output bindings to function.json</span></span>

1. <span data-ttu-id="9f0d3-108">함수 앱 포털에서 [!INCLUDE [func-name-discover](./func-name-discover.md)] 함수를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-108">Select our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], in the Function Apps portal.</span></span>

1. <span data-ttu-id="9f0d3-109">화면 오른쪽에서 **파일 보기** 메뉴를 확장합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-109">Expand the **View files** menu on the right of the screen.</span></span>

1. <span data-ttu-id="9f0d3-110">**파일 보기** 탭 아래에서 **function.json**을 선택하여 편집기에서 config 파일을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-110">Under the **View files** tab, select **function.json** to open the config file in the editor.</span></span>

1. <span data-ttu-id="9f0d3-111">**function.json**의 전체 내용을 다음 JSON으로 바꾸고, **저장**을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-111">Replace the entire contents of **function.json** with the following JSON and select **Save**.</span></span>

[!code-json[](../code/function.json)]

<span data-ttu-id="9f0d3-112">config 파일에 세 개의 바인딩을 새로 추가했습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-112">We've added three new bindings to the config.</span></span>

- <span data-ttu-id="9f0d3-113">각 바인딩은 `queue` 형식입니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-113">Each new binding is of type `queue`.</span></span> <span data-ttu-id="9f0d3-114">본사에서 피드백의 감정을 알게 되면 피드백 메시지로 채울 세 개의 큐에 이러한 바인딩을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-114">These bindings are for the three queues that we'll populate with our feedback messages once we know the sentiment of the feedback.</span></span>
- <span data-ttu-id="9f0d3-115">메시지를 이러한 큐에 게시하게 되므로 각 바인딩에서 방향이 `out`으로 정의되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-115">Each binding has a direction defined as `out`, since we'll post messages to these queues.</span></span>
- <span data-ttu-id="9f0d3-116">각 바인딩은 저장소 계정에 동일한 연결을 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-116">Each binding uses the same connection to our storage account.</span></span>
- <span data-ttu-id="9f0d3-117">각 바인딩에는 고유한 `queueName` 및 `name`이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-117">Each binding has a unique `queueName` and `name`.</span></span>

<span data-ttu-id="9f0d3-118">메시지를 간단하게 큐에 게시할 수 있습니다(예: `context.bindings.negativeFeedbackQueueItem = "<message>"`).</span><span class="sxs-lookup"><span data-stu-id="9f0d3-118">Posting a message to a queue is as easy as saying, for example,  `context.bindings.negativeFeedbackQueueItem = "<message>"`.</span></span>

## <a name="update-the-function-implementation-to-sort-feedback-into-queues-based-on-sentiment-score"></a><span data-ttu-id="9f0d3-119">함수 구현을 업데이트하여 감정 점수를 기준으로 피드백 정렬</span><span class="sxs-lookup"><span data-stu-id="9f0d3-119">Update the function implementation to sort feedback into queues based on sentiment score</span></span>

<span data-ttu-id="9f0d3-120">피드백 분류기는 피드백을 긍정적, 중립적, 부정적이라는 세 가지 버킷으로 분류하기 위해 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-120">The goal of our feedback sorter is to sort feedback into three buckets: positive, neutral, and negative.</span></span> <span data-ttu-id="9f0d3-121">현재까지 입력 큐, 텍스트 분석 API를 호출하는 코드, 출력 큐를 정의했습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-121">So far, we have our input queue, our code to call the Text Analytics API, and we've defined our output queues.</span></span> <span data-ttu-id="9f0d3-122">이 섹션에서는 감정에 따라 메시지를 이러한 큐로 이동하는 논리를 추가하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-122">In this section, we'll add the logic to move messages into those queues based on sentiment.</span></span>

1. <span data-ttu-id="9f0d3-123">[!INCLUDE [func-name-discover](./func-name-discover.md)] 함수로 이동하고, 다시 코드 편집기에서 `index.js`를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-123">Navigate to our function, [!INCLUDE [func-name-discover](./func-name-discover.md)], and open `index.js` in the code editor again.</span></span>

1. <span data-ttu-id="9f0d3-124">구현을 다음 코드로 바꿉니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-124">Replace the implementation with the following code.</span></span>

[!code-javascript[](../code/discover-sentiment+sort.js?highlight=26-48)]

<span data-ttu-id="9f0d3-125">강조 표시된 코드를 구현에 추가했습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-125">We've added the highlighted code to our implementation.</span></span> <span data-ttu-id="9f0d3-126">이 코드는 텍스트 분석 API Cognitive Services의 응답을 구문 분석합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-126">The code parses the response from the Text Analytics API cognitive service.</span></span> <span data-ttu-id="9f0d3-127">감정 점수에 따라 메시지가 세 출력 큐 중 하나로 전달됩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-127">Based on the sentiment score, the message is forwarded to one of our three output queues.</span></span> <span data-ttu-id="9f0d3-128">메시지를 게시하는 코드는 올바른 바인딩 매개 변수를 설정할 뿐입니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-128">The code to post the message is just setting the correct binding parameter.</span></span>

## <a name="try-it-out"></a><span data-ttu-id="9f0d3-129">사용해보기</span><span class="sxs-lookup"><span data-stu-id="9f0d3-129">Try it out</span></span>

<span data-ttu-id="9f0d3-130">업데이트된 구현을 테스트하기 위해 Storage 탐색기로 돌아가겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-130">To test the updated implementation, we'll head back to the Storage Explorer.</span></span>

1. <span data-ttu-id="9f0d3-131">포털의 **리소스 그룹** 섹션에서 리소스 그룹으로 이동합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-131">Navigate to your resource group in the **Resource Groups** section of the portal.</span></span>

1. <span data-ttu-id="9f0d3-132">이 단원에 사용된 리소스 그룹인 <rgn>[샌드박스 리소스 그룹 이름]</rgn>을 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-132">Select <rgn>[sandbox resource group name]</rgn>, the resource group used in this lesson.</span></span>

1. <span data-ttu-id="9f0d3-133">열린 **리소스 그룹** 패널에서 저장소 계정 항목을 찾아 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-133">In the **Resource group** panel that opens, locate the Storage Account entry and select it.</span></span>
    <span data-ttu-id="9f0d3-134">![리소스 그룹 창에서 선택한 저장소 계정의 스크린샷](../media/select-storage-account.png)</span><span class="sxs-lookup"><span data-stu-id="9f0d3-134">![Screenshot of storage account selected in the Resource Group window.](../media/select-storage-account.png)</span></span>

1. <span data-ttu-id="9f0d3-135">저장소 계정 기본 창의 왼쪽 메뉴에서 **Storage 탐색기(미리 보기)** 를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-135">Select **Storage Explorer (preview)** from the left menu of the Storage Account main window.</span></span> <span data-ttu-id="9f0d3-136">이 작업은 포털 내부에서 Azure Storage 탐색기를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-136">This action opens the Azure Storage Explorer inside the portal.</span></span>

    ![현재 큐가 하나 있는 저장소 계정을 보여주는 저장소 탐색기의 스크린샷](../media/storage-explorer-menu-inputq.png)

    <span data-ttu-id="9f0d3-138">**큐** 컬렉션 아래에 큐가 하나 나열되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-138">We have one queue listed under the **Queues** collection.</span></span> <span data-ttu-id="9f0d3-139">이 큐는 이 모듈의 이전 테스트 섹션에서 정의한 입력 큐인 [!INCLUDE [input-q](./q-name-input.md)]입니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-139">This queue is [!INCLUDE [input-q](./q-name-input.md)], the input queue we defined in the preceding test section of the module.</span></span>        

1. <span data-ttu-id="9f0d3-140">왼쪽 메뉴에서 [!INCLUDE [input-q](./q-name-input.md)]를 선택하여 이 큐의 데이터 탐색기를 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-140">Select [!INCLUDE [input-q](./q-name-input.md)] in the left-hand menu to see the data explorer for this queue.</span></span> <span data-ttu-id="9f0d3-141">예상대로 큐에 데이터가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-141">As expected, the queue had no data.</span></span> <span data-ttu-id="9f0d3-142">창 맨 위에 있는 **메시지 추가** 명령을 사용하여 큐에 메시지를 추가해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-142">Let's add a message to the queue using the **Add Message** command at the top of the window.</span></span>

1. <span data-ttu-id="9f0d3-143">**메시지 추가** 대화 상자에서 "이 연습이 즐겁다!"를</span><span class="sxs-lookup"><span data-stu-id="9f0d3-143">In the **Add Message** dialog, enter "I'm having fun with this exercise!"</span></span> <span data-ttu-id="9f0d3-144">**메시지 텍스트** 필드에 입력하고, 대화 상자의 맨 아래에서 **확인**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-144">into the **Message text** field, and click **OK** at the bottom of the dialog.</span></span>

1. <span data-ttu-id="9f0d3-145">[!INCLUDE [input-q](./q-name-input.md)]의 데이터 창에 메시지가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-145">The message is displayed in the data window for [!INCLUDE [input-q](./q-name-input.md)].</span></span> <span data-ttu-id="9f0d3-146">몇 초 후, 데이터 보기 맨 위에서 **새로 고침**을 클릭하여 큐 보기를 새로 고칩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-146">After a few seconds, click **Refresh** at the top of the data view to refresh the view of the queue.</span></span> <span data-ttu-id="9f0d3-147">잠시 후 메시지가 사라집니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-147">Observe that the message disappears after a while.</span></span> <span data-ttu-id="9f0d3-148">이 메시지는 어디로 갔을까요?</span><span class="sxs-lookup"><span data-stu-id="9f0d3-148">So, where did it go?</span></span>

1. <span data-ttu-id="9f0d3-149">왼쪽 메뉴에서 **큐** 컬렉션을 마우스 오른쪽 단추로 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-149">Right-click on the **QUEUES** collection in the left-hand menu.</span></span> <span data-ttu-id="9f0d3-150">*새* 큐가 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-150">Observe that a *new* queue has appeared.</span></span>
    <span data-ttu-id="9f0d3-151">![컬렉션에 새 큐가 만들어진 것을 보여주는 Storage 탐색기의 스크린샷</span><span class="sxs-lookup"><span data-stu-id="9f0d3-151">![Screenshot of Storage Explorer showing that a new queue has been created in the collection.</span></span> <span data-ttu-id="9f0d3-152">큐에 하나의 메시지가 있습니다.](../media/sa-new-output-q.png)</span><span class="sxs-lookup"><span data-stu-id="9f0d3-152">The queue has one message.](../media/sa-new-output-q.png)</span></span>

    <span data-ttu-id="9f0d3-153">[!INCLUDE [positive-q](./q-name-positive.md)] 큐는 메시지가 처음으로 게시될 때 자동으로 생성 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-153">The queue [!INCLUDE [positive-q](./q-name-positive.md)] was automatically created when a message was posted to it for the first time.</span></span> <span data-ttu-id="9f0d3-154">Azure Functions 큐 출력 바인딩을 사용하면 큐에 게시하기 전에 출력 큐를 수동으로 만들 필요가 없습니다!</span><span class="sxs-lookup"><span data-stu-id="9f0d3-154">With Azure Functions queue output bindings, you don't have to manually create the output queue before posting to it!</span></span> <span data-ttu-id="9f0d3-155">들어오는 메시지가 함수에 의해 [!INCLUDE [positive-q](./q-name-positive.md)]로 분류되는 것을 확인했으니, 다음 메시지가 어디로 도착하는지 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-155">Now that we see an incoming message has been sorted by our function into [!INCLUDE [positive-q](./q-name-positive.md)], let's see where the following messages land.</span></span>    

1. <span data-ttu-id="9f0d3-156">위와 동일한 단계를 사용하여 다음 메시지를 [!INCLUDE [input-q](./q-name-input.md)]에 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-156">Using the same steps as above, add the following messages to [!INCLUDE [input-q](./q-name-input.md)].</span></span>

    - <span data-ttu-id="9f0d3-157">"나는 브로콜리를 싫어합니다!"</span><span class="sxs-lookup"><span data-stu-id="9f0d3-157">"I hate broccoli!"</span></span>
    - <span data-ttu-id="9f0d3-158">"Microsoft는 회사입니다."</span><span class="sxs-lookup"><span data-stu-id="9f0d3-158">"Microsoft is a company"</span></span>

1. <span data-ttu-id="9f0d3-159">[!INCLUDE [input-q](./q-name-input.md)]가 다시 비워질 때까지 **새로 고침**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-159">Click **Refresh** until [!INCLUDE [input-q](./q-name-input.md)] is empty once again.</span></span> <span data-ttu-id="9f0d3-160">이 프로세스는 몇 분 정도 걸릴 수 있으며, 새로 고침을 여러 번 수행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-160">This process might take a few moments and require several refreshes.</span></span>

1. <span data-ttu-id="9f0d3-161">**큐** 컬렉션을 마우스 오른쪽 단추로 클릭하고 큐 2개가 더 나타나는 것을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-161">Right-click on the **QUEUES** collection and observe two more queues appearing.</span></span> <span data-ttu-id="9f0d3-162">큐 이름은 [!INCLUDE [neutral-q](./q-name-neutral.md)] 및 [!INCLUDE [negative-q](./q-name-negative.md)]로 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-162">The queues are named [!INCLUDE [neutral-q](./q-name-neutral.md)] and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span> <span data-ttu-id="9f0d3-163">이 작업은 몇 초 정도 걸릴 수 있으므로 새 큐가 나타날 때까지 **큐** 컬렉션을 계속 새로 고칩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-163">This might take a few seconds, so continue refreshing the **QUEUES** collection until new queues appear.</span></span> <span data-ttu-id="9f0d3-164">작업이 완료되면 다음과 비슷한 큐 목록이 나타납니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-164">When complete, your queue list should look like the following.</span></span>

    ![큐 컬렉션에 4개의 큐가 있음을 보여주는 Storage 탐색기의 스크린샷.](../media/sa-final-q-list.png)

1. <span data-ttu-id="9f0d3-166">목록의 각 큐를 클릭하여 메시지가 있는지 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-166">Click on each queue in the list to see whether they have messages.</span></span> <span data-ttu-id="9f0d3-167">제안된 메시지를 추가한 경우 [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)] 및 [!INCLUDE [negative-q](./q-name-negative.md)]에 하나가 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-167">If you added the suggested messages, you should see one in [!INCLUDE [positive-q](./q-name-positive.md)], [!INCLUDE [neutral-q](./q-name-neutral.md)], and [!INCLUDE [negative-q](./q-name-negative.md)].</span></span>

<span data-ttu-id="9f0d3-168">축하합니다!</span><span class="sxs-lookup"><span data-stu-id="9f0d3-168">Congratulations!</span></span> <span data-ttu-id="9f0d3-169">작동하는 피드백 분류기가 완성되었습니다!</span><span class="sxs-lookup"><span data-stu-id="9f0d3-169">We now have a working feedback sorter!</span></span> <span data-ttu-id="9f0d3-170">입력 큐에 메시지가 도착하면 함수에서 텍스트 분석 API 서비스를 사용하여 감정 점수를 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-170">As messages arrive in the input queue, our function uses the Text Analytics API service to get a sentiment score.</span></span> <span data-ttu-id="9f0d3-171">이 점수에 따라 함수가 메시지를 적절한 큐에 전달합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-171">Based on that score, the function forwards the messages to the appropriate queue.</span></span> <span data-ttu-id="9f0d3-172">함수가 큐 항목을 한 번에 하나씩 처리하는 것처럼 보이지만, Azure Functions 런타임은 큐 항목의 일괄 처리를 읽고 함수의 다른 인스턴스를 스핀업하여 병렬로 처리합니다.</span><span class="sxs-lookup"><span data-stu-id="9f0d3-172">While it seems like the function processes only one queue item at a time, the Azure Functions runtime will actually read batches of queue items and spin up other instances of our function to process them in parallel.</span></span>