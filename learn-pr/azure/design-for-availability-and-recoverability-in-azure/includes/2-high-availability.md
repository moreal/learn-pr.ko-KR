HA(고가용성)는 아키텍처가 오류를 처리할 수 있게 합니다. 책임을 완벽 하 게 작동 항상 해야 하는 시스템을 가정해 보겠습니다. 오류는 발생할 수 있고 발생할 수 밖에 없습니다. 무언가 잘못되더라도 시스템이 온라인 상태를 유지하려면 어떻게 해야 할까요? 유지 관리 이벤트 처리 방법 

여기서는 고가용성의 필요성을 학습하고 응용 프로그램 고가용성 요구 사항을 평가하며 Azure 플랫폼이 가용성 목표에 부합하는 솔루션을 수용 및 제공하는 방식에 대해 알아봅니다.

## <a name="what-is-high-availability"></a>고가용성이란?

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yEvc]

항상 사용 가능한 서비스는은 가용성, 부하 및 종속 서비스 및 하드웨어에서 임시 오류의 변동 폭을 완화 하는 서비스입니다. 응용 프로그램이 만족스럽게 수행되면서 온라인 및 사용 가능한 상태로 유지됩니다(또는 그렇게 보이는 상태 유지). 이 가용성은 종종 비즈니스 요구 사항, 서비스 수준 목표 또는 서비스 수준 계약에 의해 정의 됩니다.

고가용성은 궁극적으로 시스템 구성 요소의 손실이나 심각한 성능 저하를 처리하는 능력에 관한 것입니다. 호스트 실패 오프 라인으로 전환 하는 응용 프로그램을 호스팅하는 가상 머신을 때문일 수 있습니다. 시스템 업그레이드를 위해 계획된 유지 관리 때문일 수 있습니다. 클라우드에서의 서비스 실패 때문에도 발생할 수 있습니다. 시스템의 실패 위치를 파악하고 실패를 처리하는 기능을 구축하면 고객에게 제공하는 서비스가 온라인 상태를 유지하도록 할 수 있습니다.

서비스 고가용성에는 일반적으로 서비스를 구성하는 구성 요소의 고가용성이 필요합니다. 항목을 구매할 수 있는 온라인 마켓플레이스를 제공 하는 웹 사이트 생각할 수 있습니다. 고객에 게 제공 되는 서비스를 나열 하 고, 구입, 온라인 항목을 판매 하는 기능. 이 서비스를 제공하려면 데이터베이스, 웹 서버, 응용 프로그램 서버 등 여러 구성 요소가 있어야 합니다. 오류 지점에 있는 방법과 식별 해야 하므로 실패 하 고 이러한 오류 지점 아키텍처에서를 해결 하는 방법을 결정 수 이러한 각 구성이 요소.

## <a name="evaluate-high-availability-for-your-architecture"></a>아키텍처에 대한 고가용성 평가

고가용성에 대한 응용 프로그램 평가는 세 단계로 이루어집니다. 

1. 응용 프로그램의 서비스 수준 계약 판단
1. 응용 프로그램 HA 기능 평가
1. 종속 응용 프로그램의 HA 기능 평가

이 단계를 상세히 살펴보겠습니다.

### <a name="determine-the-service-level-agreement-of-your-application"></a>응용 프로그램의 서비스 수준 계약 판단

SLA(서비스 수준 계약)는 서비스 공급자가 측정 가능한 지표와 정의된 책임을 근거로 서비스 표준으로 약속한 서비스 공급자와 서비스 소비자 간 계약입니다. SLA는 엄격하거나, 법적 구속력이 있거나, 계약서로 작성한 것이거나, 고객의 가용성 기대치가 될 수 있습니다. 서비스 지표는 일반적으로 서비스 처리량, 용량, 가용성에 초점을 맞추며 모두 다양한 방법으로 측정할 수 잇습니다. SLA를 구성하는 특정 지표에 관계없이 SLA이 부합하지 못하면 서비스 공급자 측에 심각한 재정상의 결과를 초래할 수 있습니다. 서비스 계약의 일반적인 구성 요소는 SLA 위반에 대한 재정적 보상을 통해 보증됩니다.

서비스 수준 목표 SLO ()은 성능, 안정성 또는 가용성을 측정 하는 데 사용 되는 대상 메트릭 값입니다. 메트릭 요청 시간 (밀리초), 월별, 몇 분 안에 서비스의 가용성 또는 시간당 처리 된 요청 수가 처리의 성능을 정의 될 수 있습니다. 응용 프로그램 품질의 측정값으로 사용 하 여 고객 이해를 제공 하는 메트릭을 평가 하 여 이러한 Slo에 대 한 허용 범위를 정의할 수 있습니다. 이러한 목표를 정의 하면 명확 하 게 설정한 목표 및 예상과 서비스와 이러한 서비스를 사용 하는 고객을 지 원하는 두 팀 모두를 사용 하 여 합니다. 이러한 Slo 전체 SLA 충족 되는 확인 됩니다.

다음 표는 다양한 SLA 수준의 잠재적인 누적 가동 중지 시간을 보여 줍니다. 

| SLA | 주간 가동 중지 시간 | 월간 가동 중지 시간 | 연간 가동 중지 시간 |
| --- | --- | --- | --- |
| 99% |1.68시간 |7.2시간 |3.65일 |
| 99.9% |10.1분 |43.2분 |8.76시간 |
| 99.95% |5분 |21.6분 |4.38시간 |
| 99.99% |1.01분 |4.32분 |52.56분 |
| 99.999% |6초 |25.9초 |5.26분 |

다른 요소가 전부 동일하다면 당연히 가용성이 높을수록 좋습니다. 그러나 9의 수를 늘리려면 그에 따른 비용과 복잡성도 함께 증가합니다. 작동 시간이 99.99%이면 총 월간 가동 중지 시간이 약 5분입니다. 99.999%를 달성하기 위해 추가적인 복잡성과 비용을 감수할 가치가 있습니까? 대답은 비즈니스 요구 사항에 따라 다릅니다. 

다음은 SLA를 정의할 때 고려해야 할 다른 사항입니다.

* 4개의 9(99.99%)를 달성하려면 아마도 수동 개입에 의존한 오류 복구로는 불가능할 것입니다. 응용 프로그램이 자체적으로 진단하고 자체적으로 복구해야 합니다. 
* 9의 수가 4개를 넘어가면 SLA를 충족할 만큼 신속하게 가동 중단을 감지하기가 쉽지 않습니다.
* SLA가 측정되는 시간을 생각해 보세요. 시간이 짧을수록 허용 오차도 작습니다. SLA를 시간별 또는 일별 작동 시간으로 정의할 수가 없습니다. 

아키텍처 요구 하는 고가용성 기능을 결정 하는 경우 중요 한 첫 번째 단계는 Sla를 식별 합니다. 이렇게 하면 응용 프로그램의 고가용성을 보장하는 방법을 그리는 데 도움이 됩니다.

### <a name="evaluate-the-ha-capabilities-of-the-application"></a>응용 프로그램 HA 기능 평가

응용 프로그램의 HA 기능을 평가하려면 오류 분석을 수행합니다. 연결할 수 없거나 잘못 구성되었거나 예기치 않게 작동하면 응용 프로그램에 큰 영향을 미칠 수 있는 중요 구성 요소와 단일 오류 지점에 초점을 맞춥니다. 중복 구성이 없는 영역의 경우 응용 프로그램이 오류 조건을 탐지하고 자가 복구가 가능한지 판단합니다.

부하 분산 장치 등, HA 기능을 제공하도록 설계된 부분을 포함하여 응용 프로그램의 모든 구성 요소를 세심히 평가해야 합니다. 단일 실패 지점은 HA 기능을 통합하도록 수정하거나, HA 기능을 제공할 수 있는 서비스로 교체되어야 합니다.

### <a name="evaluate-the-ha-capabilities-of-dependent-applications"></a>종속 응용 프로그램의 HA 기능 평가

응용 프로그램의 SLA 요구 사항 뿐 아니라 소비자에 게 뿐만 아니라 응용 프로그램이 종속 된 리소스의 제공 된 Sla를 이해 해야 합니다. 가동 시간 99.9%의 고객에 게 커밋하는 하지만 응용 프로그램이 종속 된 서비스에 99%의 월간 작동 시간 약정을 하는 경우 고객에 게 SLA를 충족 하지 위험이 있습니다를 둘 수이 있습니다. 종속 서비스가 충분한 SLA를 제공할 수 없는 경우 자체 SLA를 수정하거나, 대체 항목으로 종속성을 대체하거나, 종속성이 사용 불가능한 동안 SLA를 이행할 방법을 찾아야 합니다. 시나리오와 종속성의 특성에 따라, 실패한 종속성은 캐시, 작업 큐 같은 솔루션을 통해 임시 방편으로 해결할 수 있습니다.

## <a name="azures-highly-available-platform"></a>Azure의 고가용성 플랫폼

Azure 클라우드 플랫폼은 모든 서비스에서 고가용성을 제공하도록 설계되었습니다. 다른 시스템처럼 응용 프로그램도 하드웨어와 소프트웨어 플랫폼 이벤트의 영향을 받을 수 있습니다. 오류를 처리 하도록 응용 프로그램 아키텍처를 설계 해야 것이 중요 한 Azure 클라우드 플랫폼 응용 프로그램을 항상 사용할 수 있도록 기능과 도구를 사용 하면 메시지를 표시 합니다. Azure에서 아키텍처에 HA를 고려할 때 몇 가지 핵심 개념은 다음과 같습니다.

* 가용성 집합
* 가용성 영역
* 부하 분산
* 서비스 (PaaS) HA 기능으로는 플랫폼

### <a name="availability-sets"></a>가용성 집합

가용성 집합은 예약 유지 관리의 동시 영향을 방지하기 위해 하드웨어 장애 및 동일한 응용 프로그램 워크로드에 속한 VM이 배포되어야 함을 Azure에 알리는 방식입니다. 가용성 집합은 *업데이트 도메인*과 *장애 도메인*으로 구성됩니다.

![가용성 집합](../media/AzAvailSets.png)

업데이트 도메인은 Azure 데이터센터에서 호스트되는 가상 머신이 유지 관리를 위해 가동 중지 시간이 필요할 때 응용 프로그램 서버의 하위 집합이 실행 상태를 유지하도록 합니다. 실행 되는 Vm에 영향을 주지는 대부분의 업데이트를 수행할 수 있습니다 하지만 하는 경우 이것이 불가능 한 경우가 있습니다. 업데이트가 한 번에 전체 데이터 센터에 발생 하지 되도록 Azure 데이터 센터는 업데이트 도메인 (UD)에 단면화 논리적으로 합니다. 업데이트 도메인을 통한 업데이트 시퀀스는 호스트에 적용 해야 하는 중요 한 보안 패치 및 성능 업데이트와 같은 유지 관리 이벤트를 될 때입니다. 업데이트 도메인을 사용 하 여 업데이트를 시퀀싱을 사용 하면 전체 데이터 센터 플랫폼 업데이트 하는 동안 사용 불가 및 패치는 없습니다.

업데이트 도메인을 데이터 센터의 논리적 섹션 나타냅니다, 장애 도메인 (FD) 데이터 센터의 물리적 섹션을 나타내고 랙 다양 한 가용성 집합에는 서버를 확인 합니다. 장애 도메인은 데이터 센터에서 공유 하드웨어의 물리적 분리에 맞춥니다. 여기에는 서버 랙에 위치한 물리적 서버를 지원하는 전원, 냉방, 네트워크 하드웨어가 포함됩니다. 서버 랙을 지원하는 하드웨어를 사용할 수 없는 경우 서버의 랙만 중단의 영향을 받게 됩니다. 가용성 집합의 Vm에 배치 하 여 Vm에는 자동으로 분산할 수 여러 Fd 하드웨어 오류가 발생할 경우 Vm의 일부만 영향을 받을 수 있도록 합니다.

가용성 집합을 사용하면 영향이 큰 유지 관리 이벤트가 필요하거나 하드웨어 장애가 발생한 경우 응용 프로그램이 온라인 상태를 유지하게 할 수 있습니다.

### <a name="availability-zones"></a>가용성 영역

가용성 영역은 자체 전원, 냉각 및 네트워킹을 포함하는 지역의 독립적인 물리적 데이터센터 위치입니다. 리소스 배포에서 가용성 영역을 고려하면 데이터센터 중단으로부터 워크로드를 보호하고 특정 지역에서 서비스 상태를 유지할 수 있습니다. 가상 머신은 같은 서비스는 *영역별 서비스*로, 지역 내 특정 영역에 배포할 수 있습니다. 다른 서비스는 *영역 중복 서비스*로, 특정 Azure 지역에서 가용성 영역에 걸쳐 복제합니다. 두 유형 모두 Azure 지역 내에서 단일 실패 지점이 없게 합니다.

![가용성 영역](../media/AzAvailZones.png)

지원되는 지역에는 최소 3개 가용성 영역이 포함됩니다. 해당 지역에서 영역 서비스 리소스를 만들 때 리소스를 만들 영역을 선택 하는 기능을 해야 합니다. 이렇게 하면 영역 중단을 견디고 다른 Azure 지역으로 이동하기 전에 Azure 지역에서 지속적으로 작동하는 응용 프로그램을 설계할 수 있습니다.

가용성 영역은 Azure 지역을 위한 더 새로운 고가용성 구성 서비스로, 현재 특정 지역에서 제공됩니다. 이 기능을 고려해 야 할 경우 응용 프로그램을 배포 하려는 지역에서이 서비스의 가용성을 확인 하는 것이 반드시 합니다. 가용성 영역은 가상 머신과, 여러 PaaS 서비스를 사용할 때 지원됩니다. 가용성 영역은 가용성 집합과 함께 사용할 수 없습니다. 가용성 영역을 사용 하는 경우 더 이상 시스템을 위해 가용성 집합을 정의 해야 합니다. 업데이트 수행 되지 않게 됩니다 여러 가용성 영역에 동시에 및 데이터 센터 수준에서 다양성을 해야 합니다.

### <a name="load-balancing"></a>부하 분산

부하 분산 장치는 응용 프로그램 간에 네트워크 트래픽이 분산되는 방식을 관리합니다. 부하 분산 장치는 복원 력 있는 응용 프로그램을 응용 프로그램을 요청을 처리 하는 데 사용할 수 있도록 개별 구성 요소 실패를 유지 하는 데 반드시 필요 합니다. 기본 제공 서비스 검색 되지 않은 응용 프로그램 부하 분산 가용성 집합과 가용성 영역에 대 한 필요 합니다.

Azure에는 네트워크 트래픽 전달 기능으로 구분할 수 있는 3가지 부하 분산 기술 서비스가 있습니다.

* **Azure Traffic Manager**는 글로벌 DNS 부하 분산을 제공합니다. Azure 지역 내 또는 지역 간 DNS 엔드포인트의 부하 분산을 제공하는 데 Traffic Manager를 사용하는 것이 좋습니다.
* **Azure Application Gateway** 계층 7 부하 분산 기능을 라운드 로빈 배포 들어오는 트래픽을, 쿠키 기반 세션 선호도, URL 경로 기반 라우팅 및 단일 뒤에 여러 웹 사이트를 호스트 하는 기능 등을 제공 합니다. 응용 프로그램 게이트웨이입니다.
* **Azure Load Balancer**는 계층 4 부하 분산 장치입니다. 서비스 가용성 관리 옵션을 검색하는 TCP 및 HTTP 상태를 사용하여 공용 및 내부 부하 분산된 엔드포인트를 구성하고 백 엔드 풀 대상에 인바운드 연결을 매핑하는 규칙을 정의할 수 있습니다.

하나 또는 모든 세 가지 Azure 부하 분산 기술 조합 해야 사용 가능한 응용 프로그램을 통해 네트워크 트래픽 라우팅하는 데 항상 사용 가능한 솔루션을 설계 하 고 필요한 옵션을 확인할 수 있습니다.

![Azure 부하 분산 옵션](../media/AzLBOptions.png)

### <a name="paas-ha-capabilities"></a>PaaS HA 기능

PaaS 서비스는 고가용성과 함께 기본 제공됩니다. Azure SQL Database, Azure App Service 및 Azure Service Bus와 같은 서비스 고가용성 기능을 포함 하 고 서비스의 개별 구성 요소의 실패는 응용 프로그램에 원활 하 게 발생 하지 않을 것을 확인 합니다. PaaS 서비스 사용은 아키텍처의 고가용성을 보장하는 가장 좋은 방법 중 하나입니다.

고가용성에 대 한 아키텍처를 설계할 때 고객에 게 커밋하는 SLA를 이해 하는 것이 좋습니다. 그런 다음이 응용 프로그램에 HA 기능 및 HA 기능와 종속 시스템의 Sla를 평가 합니다. 이러한 설정 된 후 가용성 집합과 가용성 영역을 다양 한 부하 분산 기술을 같은 Azure 기능을 사용 하 여 HA 기능 응용 프로그램을 추가 하 합니다. 사용하도록 선택하는 모든 PaaS 서비스는 기본 제공된 HA 기능이 있습니다.
