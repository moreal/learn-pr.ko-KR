고가용성을 위한 디자인은 부정적인 이벤트 및 불리한 조건에도 불구하고 응용 프로그램 또는 프로세스의 실행을 지속하는 데 도움이 됩니다. 그러나 위중한 어떤 일이 발생하여 데이터를 잃었고 앱과 프로세스의 다운을 막을 수 없다면 어떻게 해야 할까요? 재해가 발생하면 계획이 필요합니다. 사용자 목표 및 예상과 이란 복구에 대 한 비용 및 사용자의 계획의 제한 사항 이란 무엇 이며 여기에서 실행 하는 방법을 알아야 합니다.

## <a name="what-is-disaster-recovery"></a>재해 복구란 무엇인가요?

에 대 한 재해 복구는 *영향력이 높은 이벤트에서 복구* 가동 중지 시간 및 손실 또는 데이터 결과입니다. 재해는 응용 프로그램이 디자인의 고가용성 부분을 통해 완화할 수 있는 것보다 훨씬 크고 오래 지속되는 영향을 갖는 단일 중대 이벤트입니다.

단어 "재해"의 생각을 종종 evokes *자연 스러운* 재해 및 (지진, 홍수, tropical 스톰 및 등) 외부 이벤트 하지만 다양 한 유형의 재해도 존재 합니다. 매우 잘못된 배포나 업그레이드는 앱을 인식할 수 없는 상태로 만들 수 있습니다. 악의적인 해커 암호화 또는 데이터 삭제 및 앱 오프 라인으로 전환 하거나 해당 기능 중 일부를 제거 하는 다른 유형의 손상 입힐 수 있습니다.

원인에 관계없이 재해 발생 후 유일한 해결 방법은 잘 정의되어 테스트된 재해 복구 계획과, 디자인을 통해 재해 복구 업무를 적극 지원하는 응용 프로그램입니다.

## <a name="how-to-create-a-disaster-recovery-plan"></a>재해 복구 계획을 만드는 방법

재해 복구 계획을 단일 문서 해당 세부 정보 데이터 손실 및 재해를 야기 하는 가동 중지 시간에서 복구 하는 데 필요한 절차 이며는 누가 이러한 프로시저를 전송 하 게 식별 합니다. 운영자는 이 계획을 매뉴얼로 활용하여 재해 발생 후 응용 프로그램 연결을 복원하고 데이터를 복구할 수 있어야 합니다. 재해 복구 전용 자세 하 고 작성 된 계획을 편리 하 게 결과 데 필수적입니다. 계획을 만드는 과정은 응용 프로그램의 전체적인 그림을 조합 하는 데 도움이 됩니다. 재해 이벤트의 당황한을 해소해 줍니다 여파에서 적절 한 의사 결정 및 사후 조치 결과 단계의 올라갑니다.

재해 복구 계획을 만들려면 응용 프로그램의 워크플로, 데이터, 인프라 및 종속성에 대한 정확한 지식이 필요합니다.

### <a name="risk-assessment-and-process-inventory"></a>위험 평가 및 프로세스 인벤토리

재해 복구 계획을 만드는 첫 단계는 응용 프로그램에서 다양한 재해 종류가 미치는 영향을 조사하는 위험 분석 수행입니다. 위험 분석에서 재해의 정확한 특성은 데이터 손실 및 응용 프로그램 가동 중지 시간을 통한 잠재적인 영향만큼 중요하지 않습니다. 다양 한 유형의 가상 재해를 탐색 하 고 해당 효과 고려할 때 특정 수 해 보세요. 예를 들어 대상된 악의적인 공격 코드 또는 다른 종류의 네트워크 연결 및 데이터 센터의 가용성을 중단 시키는 지진 보다 영향 초래 하는 데이터를 수정할 수 있습니다.

위험 평가에서는 끝도 없는 가동 중지 시간을 감당할 수 없는 *모든* 프로세스와, 무한 손실을 용인할 수 없는 모든 데이터 범주를 고려해야 합니다. 여러 응용 프로그램 구성 요소에 영향을 미치는 재해가 발생하면 계획 소유자가 계획을 사용하여 주의가 필요한 요소와 각 항목의 우선 순위 지정 방법을 완벽하게 확보하는 것이 중요합니다. 

일부 앱은 단일 프로세스나 데이터 분류만 구성할 수도 있습니다. 여기서도 역시 주의가 필요합니다. 응용 프로그램은 구성에 여러 응용 프로그램을 포함하는 더 큰 재해 복구 계획의 한 구성 요소일 수 있기 때문입니다.

### <a name="recovery-objectives"></a>복구 목표

전체 계획에서는 응용 프로그램이 구현하는 각 프로세스에 대한 두 가지 중요 비즈니스 요구 사항을 지정해야 합니다.

* **RPO(복구 지점 목표)**: 용인되는 최대 데이터 손실 기간입니다. RPO 시간을 하지 볼륨 단위로 측정 됩니다: "30 분간의 데이터", "데이터 4 시간" 등입니다. RPO는 데이터 *도난*이 아닌 데이터 *손실*로부터의 제한 및 복구에 관한 것입니다.
* **RTO(복구 시간 목표)**: 용인되는 최대 중단 시간으로, "가동 중지 시간"은 사양에서 정의해야 합니다. 예를 들어 경우 허용 가능한 가동 중지 시간은 8 시간 재해 발생 시 RPO은 8 시간입니다.

![RTO 및 RPO](../media/rto-rpo.png)

각 주요 프로세스 또는 응용 프로그램에서 구현 되는 워크 로드 별도 RPO 및 RTO 값이 있어야 합니다. 서로 다른 프로세스에서 동일한 값에 이른다 하더라도 각각의 값은 각각의 관련 프로세스에 대해 재해 시나리오 위험과 잠재적 복구 전략을 모색하는 별도의 분석을 통해 생성되어야 합니다.

RPO 및 RTO를 지정하는 프로세스는 응용 프로그램에 필요한 재해 복구 요구 사항을 효과적으로 만들어냅니다. 각 워크 로드의 우선 순위 및 데이터의 범주를 설정 하 고 비용 효율성 분석을 수행 해야 합니다. 분석 문제를 구현 및 유지 관리 비용, 운영 비용, 오버 헤드가 프로세스, 성능 영향 및 가동 중지 시간 및 손실된 데이터의 영향 등을 포함합니다. 응용 프로그램에 대해 어떤 "가동 중지 시간"을 의미 하는 정확 하 게 정의 해야 하 고 경우에 따라 서로 다른 수준의 기능에 대 한 별도 RTO 및 RPO 값을 설정할 수 있습니다. RPO 및 RTO 지정은 단순히 임의의 값을 선택하는 것 이상이 일입니다. 재해 복구 계획에서 대부분의 값은 재해의 잠재적인 영향과 위험 완화의 비용을 모색하는 연구 및 분석을 통해 도출됩니다.

### <a name="detailing-recovery-steps"></a>상세 복구 단계

최종 계획은 손실된 데이터와 응용 프로그램 연결을 복원하기 위해 수행할 정확한 단계를 상세히 설명해야 합니다. 단계에는 보통 다음에 대한 정보가 포함됩니다.

* **백업을**: 만들어지는 빈도,을 위치한, 및에서 데이터를 복원 하는 방법입니다.
* **데이터 복제본**: 복제본, 복제 된 데이터의 특성 및 일관성 특성 및 다른 복제본으로 전환 하는 방법의 위치와 수 있습니다.
* **배포**: 배포를 실행 하는 방법, 롤백을 수행 하는 방법 및 배포에 대 한 오류 시나리오입니다.
* **인프라**: 온-프레미스 및 클라우드 리소스, 네트워크 인프라 및 하드웨어 인벤토리 합니다.
* **종속성**: 연락처 정보 및 Sla를 포함 하 여 응용 프로그램에서 사용 되는 외부 서비스입니다.
* **구성 및 알림**: 플래그 또는 응용 프로그램을 정상적으로 저하 되도록 설정할 수 있는 옵션 및 응용 프로그램에 미치는 사용자에 게 알리는 데 사용 되는 서비스입니다.

필요한 정확한 단계는 중요 한 업데이트 계획을 유지할 수 있도록 앱의 구현 세부 정보에 크게 달라 집니다. 정기적인 계획 테스트는 차이가 있고 오래된 부분을 파악하는 데 도움이 됩니다.

## <a name="designing-for-disaster-recovery"></a>재해 복구를 위한 디자인

재해 복구는 자동 기능이 아닙니다. 설계, 구축 및 테스트가 필요합니다. 견고한 재해 복구 전략을 지원해야 하는 앱은 처음부터 재해 복구를 염두에 두고 구축되어야 합니다. Azure는 재해 복구를 지원하는 앱을 만드는 데 도움이 되는 서비스, 기능 및 지침을 제공하지만 디자인에 이를 포함하는 것은 사용자에게 달려 있습니다.

재해 복구를 위한 디자인에서는 다음과 같이 두 가지를 고려해야 합니다.

* **데이터 복구**: 백업 및 복제를 사용하여 손실된 데이터를 복원합니다.
* **프로세스 복구**: 서비스 복구 및 코드 배포를 통해 가동 중단으로부터 복구합니다.

### <a name="data-recovery-and-replication"></a>데이터 복구 및 복제

복제는 여러 데이터 저장소 복제본 사이에서 저장된 데이터를 복제합니다. 복구 시 사용하기 위해 장기 지속되는 읽기 전용 스냅숏을 만드는 *백업*과는 달리 복제는 실시간 또는 거의 실시간에 가까운 라이브 데이터의 사본을 만듭니다. 복제의 목표는 응용 프로그램 응답성은 유지하면서도 가능한 최소한의 대기 시간으로 복제본을 동기 상태로 유지하는 것입니다. 복제는 고가용성 및 재해 복구를 위한 디자인의 핵심 구성 요소로, 프로덕션급 응용 프로그램의 일반적인 기능입니다.

복제는 *장애 조치*를 실행하여 실패 또는 접근 불가 데이터 저장소를 완화하는 데 사용됩니다. 즉 데이터 요청을 작동하는 복제본으로 전달하도록 응용 프로그램 구성을 변경합니다. 장애 조치는 데이터 저장소 제품에 기본 제공되는 오류 탐지나, 모니터링 솔루션을 통해 구현되는 탐지를 통해 자동으로 트리거되는 경우가 많습니다. 구현 및 시나리오에 따라 장애 조치(failover)는 시스템 운영자가 수동으로 실행해야 할 수 있습니다.

복제는 처음부터 구현하는 사항이 아닙니다. 대부분의 기능을 갖춘 데이터베이스 시스템과 기타 데이터 저장소 제품 및 서비스의 경우, 기능 및 성능 요구 사항이기 때문에 긴밀하게 통합된 기능으로 어떤 종류의 복제를 포함합니다. 그러나 이러한 기능을 응용 프로그램 디자인에 포함시키고 적합하게 사용하는 것은 사용자에게 달려 있습니다.

다양한 Azure 서비스에서는 다양한 복제 수준과 개념을 지원합니다. 예: 

* **Azure Storage** 저장소 계정에 대해 선택한 복제 유형에 따라 달라 집니다 복제 기능입니다. 이 복제 데이터 센터) (내 로컬 될 수 있습니다 (데이터 센터 간에 지역 내에서), 영역, 지역 (지역) 사이입니다. 응용 프로그램이나 운영자가 직접 상호 작용하지 않습니다. 장애 조치(failover)는 자동이고 투명하며, 비용과 위험의 적절한 균형을 이루는 복제 수준을 선택하기만 하면 됩니다.
* **Azure SQL Database** 복제는 소규모에서는 자동이지만 전체 Azure 데이터센터나 지역 가동 중단으로부터의 복구에는 지역 복제가 필요합니다.  지역에서 복제를 설정 하는 것은 수동 이지만 설명서 지 잘 확인 하 고 서비스의 고급 기능입니다.
* **Cosmos DB**는 글로벌 분산형 데이터베이스 시스템으로, 복제가 구현의 핵심입니다. Azure Cosmos DB를 사용 하 여 직접 복제를 구성 하는 대신 구성한 분할 및 데이터 일관성에 관련 된 옵션입니다.

많은 다양한 복제 디자인에서 데이터 일관성, 성능 및 비용에 다양한 우선 순위를 둡니다. *활성* 복제에서는 동시에 여러 복제본에 대한 업데이트가 필요하며 처리량보다는 일관성을 보장합니다. 반대로 *수동* 복제는 응용 프로그램 성능에 제약 조건으로 복제를 제거 하지만 RPO를 늘리면 백그라운드에서 동기화를 수행 합니다. *활성-활성* 또는 *다중 마스터* 복제에서는 동시에 여러 복제본을 사용할 수 있어 데이터 일관성은 복잡해지지만 부하 분산이 가능하고, *활성-수동* 복제에서는 장애 조치(failover) 중에만 실시간 사용을 위해 복제본을 유지합니다. 

![Azure SQL Database 지역 복제](../media/geo-replication.png)

> [!IMPORTANT]
> **복제나 백업은 그 자체만으로는 완벽한 재해 복구 솔루션이 아닙니다**. 데이터 복구는 재해 복구의 한 구성 요소에 불과하며 복제는 수많은 재해 복구 시나리오를 완전히 만족하지는 못합니다. 예를 들어, 데이터 손상 시나리오에서는 손상의 근본적 특성상 기본 데이터 저장소에서 복제본까지 확산되어 모든 복제본이 쓸모 없게 되어 복구를 위해 백업 복사본이 필요할 수 있습니다.

### <a name="process-recovery"></a>프로세스 복구

재해 후 복구가 필요한 자산은 비즈니스 데이터뿐이 아닙니다. 재해 시나리오에서는 일반적으로 네트워크 연결 문제, 데이터센터 중단, 손상된 VM 인스턴스, 소프트웨어 배포 등, 다양한 문제에 따른 가동 중지 시간이 발생합니다. 응용 프로그램 디자인을 통해 이것을 작동하는 상태로 복원할 수 있어야 합니다.

대부분의 경우 복원 프로세스에는 정상 작동하는 다른 배포로의 장애 조치(failover)가 포함됩니다. 시나리오에 따라 지리적 위치는 중요 한 측면을 수 있습니다. 예를 들어, 오프 라인으로 전체 Azure 지역을 제공 하는 대규모 자연 재해 다른 지역에 서비스를 복원 해야 합니다. 응용 프로그램의 재해 복구 요구 사항, 특히 RTO를 결정할 수 있어야를 찾을 수 있어야 하 고 실행 준비 상태에서를 유지 해야 합니다 또는 몇 개의 복제 된 환경을 확인 하 고 디자인 이끌어내야 재해 발생 시 배포에 적용할 수 있습니다.

응용 프로그램의 디자인에 따라는 몇 가지 전략 및 Azure 서비스와의 이점은 재해 후 복구 프로세스에 대 한 앱의 지원을 개선 하기 위해 수행할 수 있는 기능입니다.

#### <a name="azure-site-recovery"></a>Azure Site Recovery

Azure Site Recovery는 전용 물리적 서버에서 실행 중인 Vm을 Azure에 배포 된 Vm에서 실행 중인 워크 로드 및 물리적 서버에서 직접 실행 하는 워크 로드에 대 한 프로세스 복구를 관리 하는 서비스입니다. Site Recovery는 대체 위치에 워크로드를 복제하며, 중단 발생 시의 장애 조치(failover)와 재해 복구 계획의 테스트를 지원합니다.

![Azure Site Recovery](../media/asr.png)

Site Recovery는 개별 *워크로드*뿐 아니라 전체 VM 및 물리적 서버 이미지의 복제를 지원합니다. 여기서 워크로드는 개별 응용 프로그램, 전체 VM 또는 응용 프로그램을 포함한 운영 체제가 될 수 있습니다. 모든 응용 프로그램 워크로드를 복제할 수 있지만 Site Recovery는 SQL Server 및 SharePoint 등의 Microsoft 서버 응용 프로그램과 SAP 등, 여러 타사 응용 프로그램을 위한 최고 수준의 통합 지원을 제공합니다.

Vm 또는 물리적 서버에서 실행 되는 모든 앱의 Azure Site Recovery를 사용 하 여를 조사 이상 해야 합니다. 검색 시나리오 및 복구 프로세스에 대 한 가능성을 탐색 하는 훌륭한 방법입니다.

#### <a name="service-specific-features"></a>서버 특정 기능

App Service처럼 Azure PaaS에서 실행되는 앱의 경우 대부분의 서비스가 재해 복구 지원을 위한 기능과 지침을 제공합니다. 특정 시나리오의 경우 서버 특정 기능을 통해 빠른 복구를 지원할 수 있습니다. 예를 들어, Azure SQL Server는 다른 지역에서 서비스를 신속하게 복원하기 위해 지역 복제를 지원합니다. Azure App Service에는 백업 및 복원 기능이 있고 설명서에는 Azure Traffic Manager를 사용한 보조 지역으로의 트래픽 전달을 지원하는 지침이 포함되어 있습니다.

![지역 쌍](../media/AzRegionPairs.png)

## <a name="testing-a-disaster-recovery-plan"></a>재해 복구 계획 테스트

재해 복구 계획을 마련하면 거기서 끝난 게 아닙니다. 명확하며 최신인 방향과 설명 유지를 위해서는 계획 테스트가 재해 복구의 중요한 부분입니다.

매달 백업 및 장애 조치(failover) 메커니즘 테스트, 6개월마다 전체 범위 재해 복구 시뮬레이션 수행 등, 다양한 테스트 유형 및 범위를 수행하는 간격을 선택합니다. 항상의 단계 및 세부 정보는 계획에 설명 되어 있는 것 처럼 정확 하 게 수행 하 고 계획을 사용 하 여 알 수 없는 사람이 명확 하 게 수행 될 수 있는 항목 큐브 뷰를 제공 하는 것이 좋습니다. 테스트를 실행 하는 대로 차이 향상 및 자동화 하 고 계획에 이러한 향상 된이 기능을 추가 하는 위치를 식별 합니다.

모니터링 시스템에서 테스트도 포함 해야 합니다. 예를 들어, 응용 프로그램이 자동화된 장애 조치(failover)를 지원한다면 이 응용 프로그램이 장애 탐지 및 자동 장애 조치(failover) 트리거를 망라하여 처음부터 끝까지 정확하게 작동하는지 확인하기 위해 종속성이나 기타 중요 구성 요소에 장애를 적용합니다.

 요구 사항을 신중하게 파악하고 계획을 배포하면 복구 목표에 부합하기 위해 사용해야 하는 서비스의 유형을 판단할 수 있습니다. Azure는 이러한 목표를 충족하는 데 유용한 여러 서비스와 기능을 제공합니다.
