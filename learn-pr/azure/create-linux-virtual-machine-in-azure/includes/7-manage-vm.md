서버 구성을 조정하는 작업은 일반적으로 온-프레미스 환경의 장비를 사용하여 수행됩니다. 이러한 의미에서 Azure VM을 해당 환경의 확장으로 간주할 수 있습니다. 구성 변경, 관리 네트워크, open 또는 트래픽 차단 등 Azure portal, Azure CLI 또는 Azure PowerShell 도구를 통해 수 있습니다.

서버를 실행 중이고, Apache가 설치되어 페이지를 제공하고 있습니다. 보안 팀에는 모든 서버를 잠그는 것을 하지 수행한 아무 것도이 VM에 아직 한다고 규정 합니다. 아무 작업도 수행하지 않아서 Apache가 포트 80에 대해 수신 대기 중입니다. Azure 네트워크 구성을 살펴보고 기본 제공되는 보안 지원을 사용하여 서버를 강화하는 방법을 살펴보겠습니다.

## <a name="opening-ports-in-azure-vms"></a>Azure VM에서 포트 열기

기본적으로 새 Vm은 잠겨 있습니다. 

앱에 보내는 요청의 경우 가능 합니다. 이지만 허용 된 인바운드 트래픽만 가상 네트워크 (예를 들어, 동일한 로컬 네트워크에 다른 리소스)에서 Azure Load Balancer 프로브를 검사 합니다.

네트워크에서 다른 프로토콜을 지원하도록 구성을 조정하는 단계는 두 가지입니다. 새 VM을 만드는 경우에는 몇 가지 공통 포트(RDP, HTTP, HTTPS 및 SSH)를 열 수 있습니다. 그러나 방화벽에 다른 변경이 필요하면 수동으로 조정해야 합니다.

이 프로세스는 두 단계로 이루어집니다.

1. 네트워크 보안 그룹을 만듭니다.
2. 필요한 포트에서 트래픽을 허용 하는 인바운드 규칙을 만듭니다.

### <a name="what-is-a-network-security-group"></a>네트워크 보안 그룹 이란?

VNet(가상 네트워크)은 Azure 네트워킹 모델의 기초이며 격리 및 보호 기능을 제공합니다. 네트워크 보안 그룹 (Nsg)은 적용 및 네트워킹 수준에서 네트워크 트래픽 규칙 제어를 사용 하는 기본 도구입니다. NSG는 VNet에서 인바운드 및 아웃바운드 트래픽을 필터링하여 소프트웨어 방화벽을 제공하는 선택적 보안 계층입니다. 

보안 그룹을 네트워크 인터페이스에 연결 될 수 있습니다 (에 대 한 호스트 규칙에 따라), (여러 리소스에 적용 됨)를 가상 네트워크의 서브넷 또는 두 수준입니다. 

#### <a name="security-group-rules"></a>보안 그룹 규칙

NSG는 _규칙_을 사용하여 네트워크를 통해 이동하는 트래픽을 허용하거나 거부합니다. 각 규칙은 원본 및 대상 주소(또는 범위), 프로토콜, 포트(또는 범위), 방향(인바운드 또는 아웃바운드), 숫자 우선 순위 및 규칙과 일치하는 트래픽의 허용 또는 거부를 식별합니다.

![두 개의 다른 서브넷에서 네트워크 보안 그룹의 아키텍처를 보여주는 그림. 한 서브넷에 각각 고유한 네트워크 인터페이스 규칙을 사용하는 두 개의 가상 머신이 있습니다.  서브넷 자체에는 두 가상 머신에 모두 적용되는 규칙 집합이 있습니다. ](../media/7-nsg-rules.png)

각 보안 그룹에는 위에서 설명한 기본 네트워크 규칙을 적용하는 기본 보안 규칙 집합이 있습니다. 이러한 기본 규칙을 수정할 수 없습니다 하지만 _수_ 재정의할 수 있습니다.

#### <a name="how-azure-uses-network-rules"></a>Azure가 네트워크 규칙을 사용하는 방법

인바운드 트래픽용 서브넷 및 보안 그룹에 연결 된 보안 그룹을 Azure 프로세스 네트워크 인터페이스에 적용 합니다. 아웃바운드 트래픽은 반대 순서로 처리됩니다(네트워크 인터페이스를 먼저 처리한 다음, 서브넷이 처리됨).

> [!WARNING]  
> 보안 그룹은 두 수준 모두에서 선택 사항임을 유의하세요. 보안 그룹이 적용 되는 경우 다음 **모든 트래픽이 허용 됩니다.** Azure에서. VM에 공용 IP가 있으면 OS 기본 제공 방화벽을 제공 하지 않는 경우에 특히 심각한 위험을 수 있습니다.

평가 되는 _우선 순위_부터 시작 하 여 합니다 **가장 낮은 우선 순위** 규칙입니다. 거부 규칙은 항상 평가를 **중지**합니다. 예를 들어 네트워크 인터페이스 규칙이 아웃바운드 요청을 차단하면 서브넷에 적용된 모든 규칙이 검사되지 않습니다. 트래픽이 보안 그룹을 통해 허용되려면 적용된 _모든_ 그룹을 통과해야 합니다.

마지막 규칙은 항상 **모두 거부** 규칙입니다. 이 규칙은 우선 순위가 65500인 인바운드 및 아웃바운드 트래픽 모두의 모든 보안 그룹에 추가되는 기본 규칙입니다. 즉, 보안 그룹을 통과 하는 트래픽이 있음 _허용 규칙을 사용 하도록 해야_, 또는 최종 기본 규칙에서 차단 됩니다.

> [!NOTE]  
> SMTP 포트 25는 특별 한 경우입니다. 구독 수준 및 사용자 계정을 만든 경우에 따라 아웃 바운드 SMTP 트래픽이 차단 될 수 있습니다. 비즈니스 타당성에 따라 이 제한을 제거하도록 요청할 수 있습니다.

이 VM에 대한 보안 그룹을 만들지 않았으므로 이 단계를 수행하고 적용해 보겠습니다.

## <a name="creating-network-security-groups"></a>네트워크 보안 그룹 만들기

보안 그룹은 Azure의 거의 대부분을 차지하는 관리되는 리소스이며, Azure Portal이나 명령줄 스크립팅 도구를 통해 만들 수 있습니다. 중요한 부분은 규칙을 정의하는 것입니다. HTTP 액세스를 허용하고 다른 모든 항목을 차단하는 새 규칙을 정의하는 방법을 살펴보겠습니다.