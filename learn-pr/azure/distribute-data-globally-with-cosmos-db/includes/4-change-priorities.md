<span data-ttu-id="7ca6f-101">여러 지역에서 데이터를 복제하면 Azure Cosmos DB에서 제공하는 자동화된 장애 조치 솔루션을 활용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-101">Once you've replicated your data in multiple regions, you can take advantage of the automated failover solutions Azure Cosmos DB provides.</span></span> <span data-ttu-id="7ca6f-102">자동화된 장애 조치는 재해 또는 읽기 또는 쓰기 지역 중 하나를 오프라인 상태로 전환하는 다른 이벤트가 발생한 경우 작동하는 기능입니다. 이 기능은 오프라인 상태인 지역에서 다음 우선 순위가 지정된 지역으로 요청을 리디렉션합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-102">Automated failover is a feature that comes into play when there's a disaster or other event that takes one of your read or write regions offline, and it redirects requests from the offline region to the next most prioritized region.</span></span> 

<span data-ttu-id="7ca6f-103">미국 동부, 미국 서부, 영국 서부에 복제한 온라인 의류 사이트의 경우 미국 동부가 오프라인 상태로 전환되면 우선 순위를 지정하고, 영국 서부 대신 미국 서부로 읽기를 리디렉션하여 대기 시간을 제한할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-103">For your online clothing site, which you just replicated into East US, West US, and West UK, you can prioritize that if the East US goes offline, you can redirect reads to West US instead of West UK, to limit latency.</span></span> 

<span data-ttu-id="7ca6f-104">이 단원에서는 회사의 데이터가 복제된 지역에서 장애 조치가 작동하고 우선 순위를 설정하는 방법을 알아보세요.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-104">In this unit you'll learn about how failover works and set the priority for the regions in which your company's data has been replicated.</span></span>

## <a name="failover-basics"></a><span data-ttu-id="7ca6f-105">장애 조치 기본 사항</span><span class="sxs-lookup"><span data-stu-id="7ca6f-105">Failover basics</span></span>

<span data-ttu-id="7ca6f-106">드물게 발생하는 Azure 지역 가동 중단 또는 데이터 센터 가동 중단의 경우 Azure Cosmos DB는 영향을 받은 지역에 있는 모든 Azure Cosmos DB 계정의 장애 조치를 자동으로 트리거합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-106">In the rare event of an Azure regional outage or data center outage, Azure Cosmos DB automatically triggers failovers of all Azure Cosmos DB accounts with a presence in the affected region.</span></span>

<span data-ttu-id="7ca6f-107">**읽기 지역에 가동 중단이 발생하면 어떻게 되나요?**</span><span class="sxs-lookup"><span data-stu-id="7ca6f-107">**What happens if a read region has an outage?**</span></span>

<span data-ttu-id="7ca6f-108">영향을 받은 지역 중 하나에 읽기 지역이 있는 Azure Cosmos DB 계정은 자동으로 쓰기 지역과의 연결이 끊어지고 오프라인으로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-108">Azure Cosmos DB accounts with a read region in one of the affected regions are automatically disconnected from their write region and marked offline.</span></span> <span data-ttu-id="7ca6f-109">Cosmos DB SDK에서는 지역 검색 프로토콜을 구현하여 지역을 사용할 수 있는 시기를 자동으로 감지하고 기본 설정 지역 목록에서 사용 가능한 다음 지역으로 읽기 호출을 리디렉션합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-109">The Cosmos DB SDKs implement a regional discovery protocol that allows them to automatically detect when a region is available and redirect read calls to the next available region in the preferred region list.</span></span> <span data-ttu-id="7ca6f-110">기본 설정 지역 목록의 어느 지역도 사용할 수 없는 경우 호출은 현재 쓰기 지역으로 자동으로 대체됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-110">If none of the regions in the preferred region list is available, calls automatically fall back to the current write region.</span></span> <span data-ttu-id="7ca6f-111">지역 장애 조치를 처리하기 위해 응용 프로그램 코드를 변경할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-111">No changes are required in your application code to handle regional failovers.</span></span> <span data-ttu-id="7ca6f-112">이 프로세스 전체에서 Azure Cosmos DB를 통해 일관성이 계속 보장됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-112">During this entire process, consistency guarantees continue to be honored by Azure Cosmos DB.</span></span>

<span data-ttu-id="7ca6f-113">영향을 받은 지역이 가동 중단에서 복구되면 해당 지역에서 영향을 받은 모든 Azure Cosmos DB 계정이 서비스를 통해 자동으로 복구됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-113">Once the affected region recovers from the outage, all the affected Azure Cosmos DB accounts in the region are automatically recovered by the service.</span></span> <span data-ttu-id="7ca6f-114">영향을 받은 지역에 읽기 지역이 있는 Azure Cosmos DB 계정은 자동으로 현재 쓰기 지역과 동기화되고 온라인 상태가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-114">Azure Cosmos DB accounts that had a read region in the affected region will then automatically sync with current write region and turn online.</span></span> <span data-ttu-id="7ca6f-115">Azure Cosmos DB SDK에서는 새로운 지역의 가용성을 검색하고 응용 프로그램에서 구성한 기본 설정 지역 목록을 기반으로 하여 해당 지역을 현재 읽기 지역으로 선택해야 하는지 평가합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-115">The Azure Cosmos DB SDKs discover the availability of the new region and evaluate whether the region should be selected as the current read region based on the preferred region list configured by the application.</span></span> <span data-ttu-id="7ca6f-116">후속 읽기는 응용 프로그램 코드를 변경하지 않고도 복구된 지역으로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-116">Subsequent reads are redirected to the recovered region without requiring any changes to your application code.</span></span>

<span data-ttu-id="7ca6f-117">**쓰기 지역에 가동 중단이 발생하면 어떻게 되나요?**</span><span class="sxs-lookup"><span data-stu-id="7ca6f-117">**What happens if a write region has an outage?**</span></span>

<span data-ttu-id="7ca6f-118">영향을 받은 지역이 현재 쓰기 지역이고 Azure Cosmos DB 계정에 대해 자동 장애 조치(Failover)가 사용되도록 설정되면 해당 지역은 자동으로 오프라인으로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-118">If the affected region is the current write region and automatic failover is enabled for the Azure Cosmos DB account, then the region is automatically marked as offline.</span></span> <span data-ttu-id="7ca6f-119">그런 다음, 대체 지역이 영향을 받은 Azure Cosmos DB 계정의 쓰기 지역으로 승격됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-119">Then, an alternative region is promoted as the write region for the affected Azure Cosmos DB account.</span></span>

<span data-ttu-id="7ca6f-120">자동 장애 조치(Failover) 중에 Azure Cosmos DB는 지정된 우선 순위에 따라 지정된 Azure Cosmos DB 계정의 다음 쓰기 지역을 자동으로 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-120">During automatic failovers, Azure Cosmos DB automatically chooses the next write region for a given Azure Cosmos DB account based on the specified priority order.</span></span> <span data-ttu-id="7ca6f-121">응용 프로그램은 DocumentClient 클래스의 WriteEndpoint 속성을 사용하여 쓰기 지역의 변경 내용을 검색할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-121">Applications can use the WriteEndpoint property of DocumentClient class to detect the change in write region.</span></span>

<span data-ttu-id="7ca6f-122">영향을 받은 지역이 가동 중단에서 복구되면 해당 지역에서 영향을 받은 모든 Cosmos DB 계정이 서비스에서 자동으로 복구됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-122">Once the affected region recovers from the outage, all the affected Cosmos DB accounts in the region are automatically recovered by the service.</span></span>

<span data-ttu-id="7ca6f-123">이제 데이터베이스에 대한 읽기 지역을 수정하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-123">Now let's modify the read region for your database.</span></span>

## <a name="set-read-region-priorities"></a><span data-ttu-id="7ca6f-124">읽기 지역 우선 순위 설정</span><span class="sxs-lookup"><span data-stu-id="7ca6f-124">Set read region priorities</span></span>

1. <span data-ttu-id="7ca6f-125">Azure Portal의 **글로벌 데이터 복제** 화면에서 **자동 장애 조치(failover)** 를 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-125">In the Azure portal, on the **Replicate data globally** screen, click **Automatic Failover**.</span></span> <span data-ttu-id="7ca6f-126">데이터베이스가 이미 둘 이상의 지역에 복제된 경우에만 자동 장애 조치(failover)가 활성화됩니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-126">Automatic failover is only enabled if the database has already been replicated to more than one region.</span></span>
2. <span data-ttu-id="7ca6f-127">**자동 장애 조치(failover)** 화면에서 **자동 장애 조치(failover) 사용**을 **켜기**로 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-127">On the **Automatic Failover** screen, change **Enable Automatic Failover** to **ON**.</span></span>
3. <span data-ttu-id="7ca6f-128">**읽기 지역** 섹션에서 **미국 동부** 행의 왼쪽 부분을 클릭한 다음, 최상위 위치에 끌어다 놓습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-128">In the **Read regions** section, click the left portion of the **East US** row, and then drag and drop at the top position.</span></span>
4. <span data-ttu-id="7ca6f-129">**일본 동부** 행의 왼쪽 부분을 클릭한 다음, 두 번째 위치에 끌어다 놓습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-129">Click the left portion of the **Japan East** row, and then drag and drop to the second position.</span></span>
5. <span data-ttu-id="7ca6f-130">**확인**을 클릭합니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-130">Click **OK**.</span></span>

    ![포털에서 읽기 지역 변경](../media/4-change-priorities/change-read-priorities.gif)

## <a name="summary"></a><span data-ttu-id="7ca6f-132">요약</span><span class="sxs-lookup"><span data-stu-id="7ca6f-132">Summary</span></span>

<span data-ttu-id="7ca6f-133">이 단원에서는 자동 장애 조치(failover)에서 제공하는 기능, 예기치 않은 가동 중단으로부터 보호하는 방법 및 읽기 지역 우선 순위를 수정하는 방법을 알아보았습니다.</span><span class="sxs-lookup"><span data-stu-id="7ca6f-133">In this unit, you've learned what automatic failover provides, how you can use it to protect against unforeseen outages, and how to modify read region priorities.</span></span>